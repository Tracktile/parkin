var un=Object.create;var mt=Object.defineProperty;var ln=Object.getOwnPropertyDescriptor;var pn=Object.getOwnPropertyNames;var mn=Object.getPrototypeOf,fn=Object.prototype.hasOwnProperty;var hn=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),dn=(r,n)=>{for(var s in n)mt(r,s,{get:n[s],enumerable:!0})},qr=(r,n,s,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of pn(n))!fn.call(r,u)&&u!==s&&mt(r,u,{get:()=>n[u],enumerable:!(i=ln(n,u))||i.enumerable});return r};var T=(r,n,s)=>(s=r!=null?un(mn(r)):{},qr(n||!r||!r.__esModule?mt(s,"default",{value:r,enumerable:!0}):s,r)),gn=r=>qr(mt({},"__esModule",{value:!0}),r);var w=hn((ft,zr)=>{(function(r,n){typeof ft=="object"&&typeof zr<"u"?n(ft):typeof define=="function"&&define.amd?define(["exports"],n):n((r=typeof globalThis<"u"?globalThis:r||self).jsutils={})})(ft,function(r){"use strict";let n={SHOULD_LOG:!0,SHOULD_THROW:!1,LOG_PREFIX:null},s=()=>!0,i=(t,e={},o={})=>{let{logs:c=n.SHOULD_LOG,throws:a=n.SHOULD_THROW,prefix:p=n.LOG_PREFIX}=o,h=Object.entries(t).map(([$,G])=>u($,G,e[$]||e.$default||s)),{success:g,cases:y}=h.reduce(($,G)=>l($,G,{logs:c,throws:a,prefix:p}),{success:!0,cases:{}});return[g,y]};i.setOptions=({logs:t,throws:e,prefix:o})=>{t!==void 0&&(n.SHOULD_LOG=t),e!==void 0&&(n.SHOULD_THROW=e),o!==void 0&&(n.LOG_PREFIX=o)},i.resetOptions=()=>{n.SHOULD_LOG=!0,n.SHOULD_THROW=!1,n.LOG_PREFIX=null};let u=(t,e,o)=>{let c=o(e),a=!o.name||o.name===t||o.name==="$default"?o.toString():o.name;return{success:c,key:t,value:e,validator:o,reason:c?null:[`Argument "${t}" with value `,e,` failed validator: ${a}.`]}},l=(t,e,{logs:o,throws:c,prefix:a})=>(!e.success&&f(e,o,c,a),{success:t.success&&e.success,cases:{...t.cases,[e.key]:e}}),f=(t,e,o,c)=>{let a=c?[c,...t.reason]:t.reason;if(o)throw new Error(a.join());e&&console.error(...a)},m=t=>Array.isArray(t),R=t=>{let e=new Map;for(let c=0;c<t.length;c++){var o;let a=t[c],p=(o=e.get(a))!==null&&o!==void 0?o:0;e.set(a,p+1)}return e},A=(t,e)=>{if(t.size!==e.size)return!1;for(let[o,c]of t)if(e.get(o)!==c)return!1;return!0},x=t=>typeof t=="object"&&!Array.isArray(t)&&t!==null,b=t=>m(t)?t:[t],d=t=>typeof t=="function",v=t=>(Object.freeze(t),Object.getOwnPropertyNames(t).map(e=>{t.hasOwnProperty(e)&&t[e]!==null&&(typeof t[e]=="object"||d(t[e]))&&!Object.isFrozen(t[e])&&v(t[e])}),t),ut=Object.freeze({}),D=v({content:{}}),tn=v([]),tt=t=>t==t&&t!=null,ar=(t,e,o)=>{for(let c=0;c<t.length;c++){let a=t[c];m(a)?ar(a,e,o):o.exists&&!tt(a)||o.truthy&&!a||e.push(a)}return o.mutate?(Object.assign(t,e).splice(e.length),t):e},ur=(t,e)=>ar(t,[],x(e)?e:ut),lr=(t,e)=>{if(m(e)){let[o,...c]=e;return o(t,...c)}return d(e)?e(t):(console.error("Pipeline expected either a function or an array (for function expressions). Found "+typeof e),t)},Tt=(t,...e)=>e.reduce((o,c)=>lr(o,c),t),O=t=>typeof t=="string",pr=(t,e)=>{if(!O(t)||!d(e))return t;let o="";for(let c of t)o+=e(c);return o},mr=t=>t===t.toLowerCase(),fr=t=>t===t.toUpperCase(),hr=(t,e,o=["-","_"," "])=>{if(!O(t))return t;let c=p=>o.some(h=>h===p),a="_";return pr(t,p=>c(p)?(a=e,e):fr(p)&&mr(a)&&!c(a)?(a=p,e+p):(a=p,p))},lt=(t,e=!0)=>{if(!O(t)||!t[0])return t;let o=e?t.slice(1).toLowerCase():t.slice(1);return`${t[0].toUpperCase()}${o}`},dr=t=>{let e=t.indexOf(".")===0?t.slice(1):t;return e.indexOf(".")===e.length-1?e.slice(0,-1):e},jt=t=>t&&dr(t).replace(/[-_]/gm," ")||t,gr=(t,e)=>t&&jt(t).split(/[\s_-]/gm).reduce((o,c,a)=>c?o+=(a>0||e)&&lt(c)||c.toLowerCase():o,"")||t,B=t=>t==null?"":O(t)?t:JSON.stringify(t),rn=/[A-Z]/g,en=/^ms-/,Pt={},nn=t=>"-"+t.toLowerCase(),q=t=>typeof t=="number"&&t!=t,E=t=>typeof t=="number"&&!q(t),Lt=t=>E(t)&&t>=0,Or=t=>O(t)&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")||t,P=t=>typeof t=="object"&&t!==null,Ft=(t,e,o,c)=>{let a=t;if(!P(t)||!t||!e)return o!=="set"&&c||void 0;let p=m(e)?Array.from(e):e.split("."),h=p.pop(),g,y;for(;g=p.shift();){let $=t[g];if(P($)||d($)?t=$:(o==="set"?t[g]={}:y=!0,t=t[g]),y)return c}return o==="get"?h in t?t[h]:c:o==="unset"?delete t[h]:(t[h]=c)&&a||a},rt=(t,e,o)=>Ft(t,e,"get",o),xr=(t,e,o="")=>{e=P(e)&&e||{};let c=xr.regex||/\${(.*?)\}/g;return O(t)?t.replace(c,(a,p)=>{let h=(p||a.substr(2,a.length-3)).trim(),g=rt(e,h,o);return d(g)?g(e,h,o):g}):console.error("template requires a string as the first argument")||t},on=['"',"'"],It=t=>{if(!O(t))return;let e="";for(let o of t)e=o+e;return e},Rr=(t,e,o)=>o.map(c=>t.indexOf(c,e)).sort().find(c=>c>=0),yr=(t,e,o=[" "])=>{let c=Rr(t,e,o);return t.substring(e,c===-1?t.length:c)},pt=t=>typeof t=="boolean",Ct=t=>t==="false"||t==="true",_r=t=>pt(t)?B(t):t&&t!=="false"&&t!=="0"?"true":"false",br=t=>Boolean(t||t===""||t===0),vt=t=>Ct(t)?t==="true":_r(t)==="true",et=t=>B(t).replace(/([^.\d])/gm,""),Mt=t=>E(t)?t:t&&!q(t)&&Number(et(t))||0,Ar=t=>O(t)||E(t)||pt(t),Nt=(t,e)=>{let[o]=i({x:t,y:e},{$default:Ar});return o?O(t)?t.localeCompare(e):t-e:null},Xt=t=>t,Er=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Dt=t=>{let e=function(...o){return t instanceof e||rt(t.prototype,"constructor.name")?new t(...o):t.apply(t,o)};for(let o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return Object.defineProperty(e,"name",{value:t.name,configurable:!0}),e.toString=()=>t.toString(),e},M=(t,e=new WeakMap)=>{if(Object(t)!==t)return t;if(t instanceof Set)return new Set(t);if(e.has(t))return e.get(t);if(m(t))return t.map(c=>M(c));if(d(t))return Dt(t);let o=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t.constructor?null:Object.create(null);return o===null?$r(t):(e.set(t,o),t instanceof Map?Array.from(t,([c,a])=>o.set(c,M(a,e))):Object.assign(o,...Object.keys(t).map(c=>({[c]:M(t[c],e)}))))},$r=t=>{if(!t)return t;let e=Object.getPrototypeOf(t),o=Object.getOwnPropertyDescriptors(t);for(let[a,p]of Object.entries(o))p.value&&(o[a].value=M(p.value));let c=Object.create(e,o);return Object.isFrozen(t)&&Object.freeze(c),Object.isSealed(t)&&Object.seal(c),c},wr=t=>t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,wr),Sr=t=>Object.prototype.toString.call(t).slice(8,-1),Tr=(t,...e)=>{if(!e.length)return null;for(let o of e){if(!m(o)){console.error(`Matching case must be an entry (a 2-element array). Found: ${Sr(o)}`,o);break}let[c,a]=o;if(d(c)&&c(t)||c===t)return a}return null};Tr.default=()=>!0;let jr=t=>x(t)?Object.keys(t).length===0:m(t)?t.length===0:O(t)?t.trim().length===0:!!E(t)&&t<1,kt=(t,e)=>{let[o]=i({arr:t,comparator:e},{arr:m,$default:d});return o&&t.length?t.reduce((c,a)=>e(c,a)>0?c:a):null},Pr=t=>m(t)?t.filter((e,o,c)=>c.indexOf(e)==o):t,Lr=(t,e)=>{if(!e)return Pr(t);let{unique:o}=t.reduce((c,a)=>{let p=e(a);return!c.set.has(p)&&c.unique.push(a),c.set.add(p),c},{unique:[],set:new Set});return o},Fr=(t,e=!0)=>P(t)?Object.keys(t).reduce((o,c)=>{let a=t[c];return a==null||(o[c]=e&&P(a)?Fr(a):a),o},x(t)&&{}||[]):console.error("cleanColl requires a collection as the first argument")||t,Ut=(t,e,o)=>Ft(t,e,"set",o),Ir=Array.isArray,Cr=Object.keys,sn=Object.prototype.hasOwnProperty,Wt=(t,e)=>{if(t===e)return!0;if(!t||!e||typeof t!="object"||typeof e!="object")return t!=t&&e!=e;let o=Ir(t),c=Ir(e),a,p,h;if(o&&c){if(p=t.length,p!=e.length)return!1;for(a=p;a--!=0;)if(!Wt(t[a],e[a]))return!1;return!0}if(o!=c)return!1;let g=t instanceof Date,y=e instanceof Date;if(g!=y)return!1;if(g&&y)return t.getTime()==e.getTime();let $=t instanceof RegExp,G=e instanceof RegExp;if($!=G)return!1;if($&&G)return t.toString()==e.toString();let qt=Cr(t);if(p=qt.length,p!==Cr(e).length)return!1;for(a=p;a--!=0;)if(!sn.call(e,qt[a]))return!1;for(a=p;a--!=0;)if(h=qt[a],!Wt(t[h],e[h]))return!1;return!0},vr=t=>t&&O(t)?Ct(t)?vt(t):E(t)?Mt(t):(()=>{try{return JSON.parse(t)}catch{return t}})():t,Ht,nt="dir",z="type",cn=["error","info","log","dir","warn"],Mr=(...t)=>{if(!t.length)return;let e=t.length===1?nt:t.pop();(Ht||e==="error")&&(typeof t[0]=="string"&&(z==="type"?t[0]=`[ ${e.toUpperCase()} ] ${t[0]}`:z&&(t[0]=`${z} ${t[0]}`)),cn.indexOf(e)!==-1?console[e](...t):console[nt](...t,e))},Nr=(t,e)=>{t&&Object.entries(t).map(([o,c])=>{e&&e.indexOf(o)!==-1||(typeof c=="object"&&Nr(c),t[o]=void 0,delete t[o])})},Xr=(...t)=>t.reduce((e,o)=>{let c=M(o);return m(c)?[...m(e)&&e||[],...c]:x(c)?Object.entries(c).reduce((a,[p,h])=>({...a,[p]:d(h)?Dt(h):P(h)&&p in a?Xr(a[p],h):M(h)}),e):e},m(t[0])&&[]||{}),Dr=t=>m(t)&&t.length===2&&(E(t[0])||O(t[0])),kr=(t,e)=>{if(!m(t)&&!x(t))return console.error(t,"Expected array or object for obj. Found "+typeof t),t;if(!d(e))return console.error("Expected function for cb. Found "+typeof e),t;let o=Object.entries(t),c=m(t)?[]:{};return o.reduce((a,[p,h])=>{let g=e(p,h);return Dr(g)?Ut(a,g[0],g[1]):(console.error(`Callback function must return entry. Found: ${g}. Using current entry instead.`),Ut(a,p,h))},c)},ot=(t,e,o={})=>x(t)&&d(e)&&Object.entries(t).reduce((c,[a,p])=>e(a,p,c),o)||o,Bt=t=>{if(!d(t))throw"Argument must be a function";return(...e)=>new Promise((o,c)=>d(e[e.length-1])?(e.pop(),e.push((...a)=>a&&a[0]?c(...a):o(...a)),t(...e)):o(t(...e)))},an=Array.from(["caller","callee","arguments","apply","bind","call","toString","__proto__","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","valueOf","toLocaleString"]).concat(Object.getOwnPropertyNames(Object.prototype)).reduce((t,e)=>(t[e]=!0,t),{}),Ur=t=>{if(!t.__IS_PROMISIFIED__){for(let e of Object.getOwnPropertyNames(t))if(!(e.indexOf("Async")!==-1||t[`${e}Async`])&&!an[e])if(d(t[e]))t[`${e}Async`]=Bt(t[e]);else{let o=Object.getOwnPropertyDescriptor(t,e).get;d(o)&&(t[`${e}Async`]=Bt(o))}t.__IS_PROMISIFIED__=!0}return t},Wr=t=>Boolean(t&&t instanceof RegExp),Hr=t=>Wr(t)?t.source:O(t)?t:null,Br=t=>{let e={},o=t.split("?"),c=o[o.length-1];if(!c)return e;let a=c.split("&");return a.length&&a.map(p=>{let h=p.split("=");if(h.length<=1)return e;let g=[h.shift(),h.join("=")];if(g.length===2){let y=decodeURIComponent(g[1]).split(",");if(y&&y.length>1)e[g[0]]=y;else if(g[0]in e){let $=e[g[0]];e[g[0]]=m($)?$.push(decodeURIComponent(g[1])):[$,decodeURIComponent(g[1])]}else e[g[0]]=decodeURIComponent(g[1])}}),e};r.applyToCloneOf=(t,e)=>{let o;if(t||(o="object (Argument 1) in applyToCloneOf, must be defined!"),x(t)||(o="object (Argument 1) in applyToCloneOf, must be an object!"),e||(o="mutator (Argument 2) in applyToCloneOf, must be defined!"),d(e)||(o="mutator (Argument 2) arg in applyToCloneOf, must be a function!"),o)return console.warn(o)||t;let c=M(t);return e(c),c},r.applyToFunc=lr,r.areCountMapsEqual=A,r.areFrequencyEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;if(t.length!==e.length)return!1;let c=R(t),a=R(e);return A(c,a)},r.areSetEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;let[c,a]=t.length>e.length?[t,e]:[e,t],p=new Set(a);for(let h=0;h<c.length;h++){let g=c[h];if(!p.has(g))return!1}return!0},r.buildElementCountMap=R,r.buildPath=(...t)=>t.reduce((e,o)=>{let c=toStr(o);return`${e}${c&&"/"+c||""}`},"").replace(/([^:\/]|^)\/{2,}/g,"$1/"),r.camelCase=gr,r.camelCasePath=t=>{let e=t.split(".").map((o,c)=>c>0?lt(o,!1):o);return e.length>1?e.join(""):t},r.capitalize=lt,r.checkCall=(t,...e)=>d(t)?t(...e):void 0,r.cleanColl=Fr,r.cleanStr=jt,r.clearObj=Nr,r.cloneArr=t=>Array.from([...m(t)&&t||x(t)&&Object.entries(t)||[]]),r.cloneFunc=Dt,r.cloneJson=t=>{try{return JSON.parse(JSON.stringify(t))}catch(e){return Mr(e.message,"error"),null}},r.cloneObjWithPrototypeAndProperties=$r,r.compareTo=Nt,r.complement=t=>{let[e]=i({predicate:t},{predicate:d});return e?(...o)=>!t(...o):null},r.containsStr=(t,e,o)=>(t=!O(t)&&B(t)||t,e=!O(e)&&B(e)||e,t.indexOf(e,o)!==-1),r.convertToStrBool=_r,r.debounce=(t,e=250,o=!1)=>{let c;return function(...a){if(!d(t))return null;let p=this,h=o&&!c;return clearTimeout(c),c=setTimeout(()=>{c=null,!o&&t.apply(p,a)},e),h?d(t)&&t.apply(p,a):void 0}},r.deepClone=M,r.deepEqual=Wt,r.deepFreeze=v,r.deepMerge=Xr,r.delimitString=hr,r.doIt=(...t)=>{let e=t.slice(),o=e.shift(),c=e.shift(),a=e.pop();if(!E(o)||!d(a))return[];let p=new Array(o),h=[];for(let g=0;g<p.length;g++){let y=a.call(c,g,...e);if(y===!1)break;h.push(y)}return h},r.either=(t,e,o)=>d(o)?o(t,e)&&t||e:br(t)&&t||e,r.eitherArr=(t,e)=>m(t)?t:e,r.eitherFunc=(t,e)=>d(t)&&t||e,r.eitherObj=(t,e)=>x(t)&&t||e,r.eitherStr=(t,e)=>O(t)&&t||e,r.ensureArr=b,r.equalsNaN=q,r.everyEntry=(t,e)=>t?x(t)?d(e)?Tt(t,Object.entries,o=>o.every(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into everyEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`everyEntry expects argument obj [${t}] to be defined.`),!1),r.exists=tt,r.filterObj=(t,e)=>t&&(x(t)?d(e)?ot(t,(o,c,a)=>(e(o,c)&&(a[o]=c),a),{}):(console.error(`Argument 'predicate' passed into filterObject must a function. Found: ${e}`),t):(console.error(`Object ${t} was not an object. It must be for filterObject`),t)),r.findExtrema=kt,r.findMax=(t=[],e=Xt)=>kt(t,(o,c)=>Nt(e(o),e(c))),r.findMin=(t=[],e=Xt)=>kt(t,(o,c)=>Nt(e(c),e(o))),r.flatArr=ur,r.flatMap=(t,e)=>{let[o]=i({arr:t,mapFn:e},{arr:m,mapFn:d});return o?t.reduce((c,a)=>{let p=e(a);return m(p)?p.map(h=>c.push(h)):c.push(p),c},[]):t},r.flatUnion=(...t)=>{let e=t.pop(),o={exists:!0},c=d(e)?e:t.push(e)&&void 0;return t.reduce((a,p)=>m(p)?Lr(ur([...a,...p],o),c):a,[])},r.get=rt,r.getNearestDelimiterIndex=Rr,r.getNums=et,r.getRegexSource=Hr,r.getURLParam=t=>{var e,o,c;let[a]=i({paramKey:t},{paramKey:O});if(!a)return null;let p=typeof document<"u"?document:null,h=p==null||(e=p.location)===null||e===void 0?void 0:e.search;return O(h)&&(o=(c=Br(h))===null||c===void 0?void 0:c[t])!==null&&o!==void 0?o:null},r.getWordEndingAt=(t,e,o=[" "])=>{let c=It(t),a=t.length-e;return It(yr(c,a,o))},r.getWordStartingAt=yr,r.hasDomAccess=()=>{try{return!(typeof window>"u"||!window.document||!window.document.createElement)}catch{return!1}},r.hasOwn=Er,r.hashString=(t,e)=>{if(!O(t)||t.length==0)return 0;t=t.split("").reverse().join("");let o=0;for(let c=0;c<t.length;c++)o=(o<<5)-o+t.charCodeAt(c),o=`${Math.abs(o&o)}`;return Lt(e)?o.slice(0,e):o},r.hyphenator=t=>{if(Pt.hasOwnProperty(t))return Pt[t];let e=t.replace(rn,nn);return Pt[t]=en.test(e)?"-"+e:e},r.identity=Xt,r.isArr=m,r.isArrMap=t=>{if(!x(t))return!1;let e=Object.values(t);return vt(e.length&&e.every(m))},r.isBool=pt,r.isColl=P,r.isEmail=t=>!t||!O(t)?!1:Boolean(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(t)),r.isEmpty=jr,r.isEmptyColl=t=>m(t)?t.length===0:P(t)&&Object.getOwnPropertyNames(t).length===0,r.isEntry=Dr,r.isFloat=t=>E(t)&&t%1!=0,r.isFunc=d,r.isInt=t=>E(t)&&t%1==0,r.isLowerCase=mr,r.isNegative=t=>E(t)&&t<0,r.isNonNegative=Lt,r.isNum=E,r.isObj=x,r.isOrderable=Ar,r.isPhone=t=>!t||!O(t)?!1:Boolean(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(t))&&t.replace(/\D/g,"").length<11,r.isPositive=t=>E(t)&&t>0,r.isQuoted=(t,e=on)=>O(t)&&e.some(o=>t.startsWith(o)&&t.endsWith(o)),r.isRegex=Wr,r.isSame=(t,e)=>t===e?t!==0||1/t==1/e:t!=t&&e!=e,r.isStr=O,r.isStrBool=Ct,r.isUpperCase=fr,r.isUrl=t=>Boolean(/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(t)),r.isUuid=t=>!t||!O(t)?!1:Boolean(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(t)),r.isValidDate=t=>!isNaN((t instanceof Date&&t||new Date(t)).getTime()),r.isValidUrl=t=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-/]))?/.test(t),r.joinRegex=(...t)=>{let[e,o]=(a=>{if(m(a[0]))return[a[0],a[1]];let p=a[a.length-1],h=O(p)?p:void 0;return[h?a.splice(0,a.length-1):a,h]})(t),c=e.reduce((a,p)=>{let h=Hr(p);return h?a===""?h:`${a}|${h}`:a},"");return new RegExp(`(${c})`,o)},r.jsonEqual=(t,e)=>{try{return JSON.stringify(t)===JSON.stringify(e)}catch{return!1}},r.keyMap=(t,e)=>m(t)&&t.reduce((o,c)=>{if(!O(c))return o;let a=e&&c.toUpperCase()||c;return o[a]=a,o},{})||{},r.limbo=t=>t&&d(t.then)?t.then(e=>[null,e]).catch(e=>[e,void 0]):[new Error("A promise or thenable is required as the first argument!"),null],r.logData=Mr,r.mapColl=(t,e)=>d(e)&&P(t)?Object.keys(t).map(o=>e(o,t[o],t)):m(t)?[]:{},r.mapEntries=kr,r.mapFind=(t,e,o=tt)=>{let[c]=i({coll:t,mapper:e,test:o},{coll:P,$default:d});if(c)return x(t)?((a,p,h)=>{let g=0;for(let y in a){if(!a.hasOwnProperty(y))continue;let $=p(a[y],y,g);if(h($,y,g))return $;g++}return null})(t,e,o):((a,p,h)=>{for(let g=0;g<a.length;g++){let y=p(a[g],g,g);if(h(y,g,g))return y}return null})(t,e,o)},r.mapKeys=(t,e)=>x(t)&&d(e)?kr(t,(o,c)=>[e(o),c]):t,r.mapObj=(t,e)=>x(t)&&d(e)&&Object.entries(t).map(([o,c])=>e(o,c))||t,r.mapString=pr,r.match=Tr,r.memorize=(t,e,o=1)=>{if(!d(t)||e&&!d(e))return console.error("Error: Expected a function",t,e);let c=function(){let a=c.cache,p=e?e.apply(this,arguments):arguments[0];if(Er(a,p))return a[p];let h=t.apply(this,arguments);return E(o)&&Object.keys(a).length<o?a[p]=h:c.cache={[p]:h},h};return c.cache={},c.destroy=()=>{e=void 0,c.cache=void 0,c.destroy=void 0,c=void 0},c},r.mod=(t,e)=>(t%e+e)%e,r.noOp=()=>{},r.noOpObj=ut,r.noPropArr=tn,r.noPropObj=D,r.nth=t=>{if(!E(t)&&(!(t=et(t))||(t=Mt(t),q(t))))return"";let e=t%100;if(e>=10&&e<=20)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},r.objToQuery=t=>{let e;return ot(t,(o,c,a)=>{if(!c)return a;let p=O(c)||E(c)||pt(c)?c:P(c)?m(c)?c.join(","):JSON.stringify(c):null;return p&&(a=e?`${a}&${encodeURIComponent(o)}=${encodeURIComponent(p)}`:`?${encodeURIComponent(o)}=${encodeURIComponent(p)}`,e=!0),a},"")},r.omitKeys=(t={},e=[])=>x(t)&&ot(t,(o,c,a)=>(e.indexOf(o)===-1&&(a[o]=t[o]),a),{})||{},r.omitRange=(t,e,o)=>{let[c]=i({arr:t,startIndex:e,count:o},{arr:m,$default:Lt});if(!c)return t;let a=[...t];return a.splice(e,o),a},r.parseErrorMessage=t=>O(t)&&!jr(t)?t:x(t)?t.message:null,r.parseJSON=(t,e=!0)=>{try{return JSON.parse(t)}catch(o){return e&&console.error(o.message),null}},r.pickKeys=(t={},e=[])=>x(t)&&e.reduce((o,c)=>(c in t&&(o[c]=t[c]),o),{})||{},r.pipeline=Tt,r.plural=t=>t&&t.length&&t[t.length-1]!=="s"?t+"s":t,r.promisify=Bt,r.promisifyAll=t=>{if(!x(t))return t;Ur(t);let e=Object.getPrototypeOf(t);return e&&Object.getPrototypeOf(e)!==null&&Ur(e),t},r.queryToObj=Br,r.randomArr=(t,e)=>{if(!m(t))return t;let o=e||1,c=[];for(let a=0;a<o;a++)c.push(t[Math.floor(Math.random()*t.length)]);return e?c:c[0]},r.randomizeArr=t=>!m(t)&&t||t.sort(()=>.5-Math.random()),r.reduceColl=(t,e,o)=>d(e)&&P(t)?Object.keys(t).reduce((c,a)=>e(a,t[a],t,c),o):m(t)?[]:{},r.reduceObj=ot,r.removeDot=dr,r.repeat=(t,e,o=!1)=>{if(!e||e<=0)return[];if(!E(e))return console.error("Times argument must be a number"),[];let c=[];for(let a=0;a<e;a++){let p=d(t)?t():o?M(t):t;c.push(p)}return c},r.resetLogs=()=>{Ht=void 0,nt="log",z="type"},r.reverseStr=It,r.runSeq=async(t=[],e={})=>{let[o]=i({asyncFns:t},{asyncFns:m});if(!o)return[];let{cloneResults:c=!1,returnOriginal:a=!0}=e,p=[];for(let h of t){let g=d(h)?await h(p.length,c?M(p):p):a?h:void 0;p.push(g)}return p},r.sanitize=Or,r.sanitizeCopy=t=>JSON.parse(Or(JSON.stringify(t))),r.set=Ut,r.setLogs=(t,e,o)=>{Ht=t,nt=e||nt||"log",z=o||z||"type"},r.shallowEqual=(t,e,o)=>{if(o&&(m(o)||O(o))&&(t=rt(t,o),e=rt(e,o)),t===e)return!0;if(!(t&&P(t)&&e&&P(e))||Object.keys(t).length!==Object.keys(e).length)return!1;for(let c in t)if(t[c]!==e[c])return!1;return!0},r.singular=t=>t&&t.length&&t[t.length-1]==="s"?t.slice(0,t.length-1):t,r.snakeCase=t=>hr(t,"_").toLowerCase(),r.softFalsy=br,r.someEntry=(t,e)=>t?x(t)?d(e)?Tt(t,Object.entries,o=>o.some(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into someEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`someEntry expects argument obj [${t}] to be defined.`),!1),r.spaceJoin=(t,e)=>(e=m(e)?e:[e]).reduce((o,c)=>O(c)?`${o?o+" ":""}${c}`.trim():o,O(t)?t:""),r.splitByKeys=(t={},e)=>{if(!e)return[{},{...t}];let o=[{},{}],c=b(e);return x(t)?ot(t,(a,p,h)=>(tt(c.find(g=>tt(g)&&B(g)===a))?h[0][a]=t[a]:h[1][a]=t[a],h),o):o},r.strToType=vr,r.styleCase=t=>{if(!O(t))return t;let e=gr(t);return`${e[0].toLowerCase()}${e.slice(1)}`},r.template=xr,r.throttle=(t,e=100)=>{let o=!1;return function(...c){if(!o)return o=!0,t.apply(this,c),setTimeout(()=>{o=!1},e)}},r.throttleLast=(t,e,o=100)=>{let c;return function(...a){c&&clearTimeout(c),c=setTimeout(()=>{t.apply(this,a),clearTimeout(c)},o),typeof e=="function"&&e()}},r.timedRun=async(t,...e)=>{let[o]=i({fn:t},{fn:d});if(!o)return[void 0,-1];let c=new Date;return[await t(...e),new Date-c]},r.toBool=vt,r.toFloat=t=>t&&!q(t)&&parseFloat(E(t)&&t||et(t))||0,r.toInt=t=>t&&!q(t)&&parseInt(E(t)&&t||et(t))||0,r.toNum=Mt,r.toObj=(t,e,o)=>m(t)?Object.keys(t).reduce((c,a)=>(c[a]=t[a],c),{}):O(str)?(e=e||"=",o=o||"&",str.split(o).reduce((c,a)=>{let p=a.split(e);return c[p[0].trim()]=vr(p[1].trim()),c},{})):{},r.toStr=B,r.trainCase=t=>O(t)&&t.split(/(?=[A-Z])|[\s_-]/gm).join("-").toLowerCase()||t,r.trimStringFields=t=>Object.entries(t).reduce((e,[o,c])=>(e[o]=O(c)?c.trim():c,e),t),r.typeOf=Sr,r.uniqArr=Lr,r.uniqArrByReference=Pr,r.unset=(t,e)=>Ft(t,e,"unset"),r.uuid=wr,r.validFilename=t=>t?!(/[<>:"/\\|?*\u0000-\u001F]/g.test(t)||/^(con|prn|aux|nul|com\d|lpt\d)$/i.test(t)||/^\.\.?$/.test(t)):!1,r.validate=i,r.wait=t=>new Promise(e=>setTimeout(()=>e(!0),t)),r.wordCaps=t=>O(t)?jt(t).split(" ").map(e=>e&&lt(e)||"").join(" "):t})});var jo={};dn(jo,{setParkinGlobals:()=>To});module.exports=gn(jo);var Gr=T(w()),L=(0,Gr.deepFreeze)({ALIAS_REF:"$$",ALIAS_WORLD_KEY:"$alias",ALIAS_REF_AT_RUNTIME:"$$:",REGEX_VARIANT:"regex",WORLD_REF:"$",WORLD_KEY:"$world",WORLD_AT_RUNTIME:"$:",EXPRESSION_VARIANT:"expression",STEP_TYPES:["given","when","then","and","but"],HOOK_TYPES:["beforeAll","afterAll","beforeEach","afterEach"],FEATURE_META:["feature","perspective","desire","reason","comments"],LOG_JEST_SPEC_ENV:"PARKIN_LOG_JEST_SPEC",SPEC_RESULT_LOG:"------- PARKIN SPEC RESULT LOG -------"});var Ee=T(w());var xt=T(w());var N=(r,n,s)=>{let i=r.match(n)[s];return i?i.trim():" "},F=(r,n)=>{let s=r&&r.trim()&&r.trim().toLowerCase().replace(/[\s\/\\\(\)\+=_&%\$#@!\*~`\|\?:;"'<>,.{}]/g,"-");return s?`${s}-${r.length}`:`${n}-${n.length}`},Kr=r=>{let n=r.match.toString();return n[0]==="/"&&(n=n.substr(1)),n[0]==="^"&&(n=n.substr(1)),n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1)),n.charAt(n.length-1)==="$"&&(n=n.slice(0,-1)),n.replace(/\(\?:([^\|]+)+\|+([^\)]+)?\)/,"$1")},Jr=(r,n)=>n.reduce((s,i)=>!s||i.content===s.content?!1:(i.uuid===s.uuid&&(s.uuid=`${s.uuid}-${s.content.length}`),s),{...r}),ht=r=>r.trim().replace(/^("|')/,"").replace(/("|')$/,"");var _=T(w());var Vr=T(w()),st=/\w*\([^)]*?\)/,dt=/\s*\S*\/\S*\s*/,ct=/\s*{(.*?)}\s*/,Yr=(0,Vr.joinRegex)(ct,st,"g"),zt=/(.*)/,gt=/{|}/g,Qr=/"[^"]+"/,Zr=/'[^']+'/,te=/-?[0-9]+[.][0-9]+/,re=/-?[0-9]+/,ee=/^["]?\$world\.\S+["]?/,ne=/^\$world\./,oe=/(\$:world|\$world)+\.[^"'\s]*/gm,se=/^["]?\$\$\S+["]?/,ce=/^\$\$/,ie=/(\$\$:\w+|\$\$\w+)[^"'\s]*/gm;var ae=r=>()=>{throw new Error(`Test method ${r} does not exist on the global scope.
Please ensure ${r} exists before calling the run method!
`)},ue=()=>{throw new Error("Runner class constructor requires an instance of the Steps class")};var le=()=>{throw new Error("Runner class requires feature text when calling the run method")},pe=r=>{throw new ReferenceError(r)},me=()=>{throw new Error(`Cannot register param type "${name}". It already exists!`)},fe=r=>{throw new Error("Assemble feature requires an object matching the feature model spec!",r)},he=(r,n)=>{throw new Error(`Can not replace ${r} with value from $world, it does not exist on the world object`,n,r)},de=(r,n)=>{throw new Error([`Expected client hook type to be one of ', ${r}.`,`Found: ${n}`].join(`
`))},ge=(r,n)=>{throw console.error(`Error replacing $world value in feature text. Current match was ${n}`),r},Oe=(r,n)=>{throw console.error(`Error replacing $$alias ( $world.$alias ) in feature text. Current match was ${n}`),r};var{WORLD_KEY:On,ALIAS_WORLD_KEY:xn,ALIAS_REF:Rn}=L,K=(r,n)=>(s,i)=>{let u=s.match(ee),l=s.match(se);if(!(0,_.isObj)(i)||!u&&!l)return Gt(r(s),n);let f=u?(0,_.get)(i,ht(s).replace(`${On}.`,"")):(0,_.get)(i,ht(s).replace(`${Rn}`,`${xn}.`));return(0,_.exists)(f)?Gt(f,n):u?he(s,i):Gt(r(s),n)},Gt=(r,n)=>typeof r===n?r:null,k={name:"",regex:"",type:"string",useForSnippets:!0,preferForRegexpMatch:!1,transformer:K(r=>r,"string")},U={any:{...k,name:"any",regex:zt},word:{...k,name:"word",regex:zt,transformer:K(r=>(0,_.isQuoted)(r)?void 0:(0,_.toStr)(r),k.type)},float:{...k,name:"float",type:"number",regex:te,transformer:K(r=>{let n=parseFloat(r);return(0,_.equalsNaN)(n)?void 0:n},"number")},int:{...k,name:"int",type:"number",regex:re,transformer:K(r=>{let n=parseInt(r);return(0,_.equalsNaN)(n)||r.includes(".")?void 0:n},"number")},string:{...k,name:"string",regex:(0,_.joinRegex)(Qr,Zr),transformer:K(r=>(0,_.isQuoted)(r)?ht(r):void 0,k.type)}},J=()=>U,Ot=(r=_.noOpObj,n=r.name)=>U[n]?me(n):(U[n]={...k,...r},U[n].transformer=K(U[n].transformer,U[n].type),U),xe=(r,n,s)=>r.map((i,u)=>{let l=n[u]||U.any;return(0,_.checkCall)(l.transformer,i,s)}).filter(_.exists);var V=(r,n)=>{let s=n.match(new RegExp(r.match));return s?{definition:r,match:s.slice(1,s.length).filter(Boolean)}:xt.noOpObj},Jt=r=>{let n=r.split(/(\(|\))/),[s,,i,,u]=n;return s===""&&u===""?r+"?":s===""?`(${i}|${i}${u})`:u===""?`(${s}|${s}${i})`:`(${s}${u}|${s}${i}${u})`},yn=r=>{let n=r.input;return(0,xt.getWordEndingAt)(n,r.index)+r[0]},_n=r=>{let n=yn(r);return Jt(n)},Vt=r=>{let n=J();return(n[r]||n.any).regex.source},Yt=r=>`(${r.trim().replace(/\//g,"|")})`,bn=(r,n)=>{let[s,i]=n;switch(r){case"parameter":return new RegExp(Vt(i));case"optional":return new RegExp(_n(n));case"alternate":return new RegExp(Yt(s));default:return null}},Kt=(r,n="other")=>{let s=r[0],i=s.trimStart(),u=s.length-i.length;return{text:s.trim(),input:r.input,index:r.index+u,regex:bn(n,r),type:n,...n==="parameter"&&{paramType:s.trim().replace(gt,"")}}},Rt=r=>{let n=[...r.matchAll(new RegExp(ct,"gi"))].map(l=>Kt(l,"parameter")),s=[...r.matchAll(new RegExp(st,"gi"))].map(l=>Kt(l,"optional")),i=[...r.matchAll(new RegExp(dt,"gi"))].map(l=>Kt(l,"alternate"));return[...n,...s,...i].sort((l,f)=>l.index-f.index)};var I=T(w()),Qt=Boolean(typeof window<"u"),Re=Boolean(typeof global<"u"),An=Boolean(typeof module=="object"),En=Boolean(typeof require=="function"),Zt=Boolean(Re&&typeof global.jasmine<"u"),ye=()=>Zt?(0,I.checkCall)(()=>global.jasmine):{getEnv:()=>I.noOpObj},_e=()=>An?(0,I.checkCall)(()=>module):{exports:{}},be=()=>En?(0,I.checkCall)(()=>require):I.noOp,yt=()=>{try{return Qt?(0,I.checkCall)(()=>window):Re?(0,I.checkCall)(()=>global):I.noOpObj}catch{return I.noOpObj}};var Y=T(w());var $n=r=>Qt?r.replace(/[|\\[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"):r.replace(/[|\\[\]^$+*?.]/g,"\\$&"),Ae=(r,n,s)=>{if(!n.test(r))return r;let i=r;return r.replace(n,(...u)=>{let l=u[0].trim(),[f,...m]=i.split(l),R=(0,Y.isFunc)(s)?s(...u):s;i=`${f}${R}${m.join(l)}`}),i},wn=r=>{let n=J(),s=[];return{regex:Ae(r,Yr,(u,...l)=>{let f=u.trim().replace(gt,""),m=u.match(ct),R=u.match(st);return m&&s.push(n[f]||n.any),m?Vt(f):R?Jt(u):u}),transformers:s}},Sn=r=>{let n=[];return{regex:Ae(r,new RegExp(dt,"g"),Yt),altIndexes:n}},Tn=r=>{let n=r;return r.startsWith("^")||(n="^"+n),r.endsWith("$")||(n+="$"),{regex:n}},tr=(r,n,s)=>{let i=Rt(n),u=i.filter(f=>f.type==="parameter").length,l=i.reduce((f,m)=>{let{params:R,textIndex:A,wordMatchIndex:x}=f,b=r.substring(A),d=m.paramType==="word",v=b.match(m.regex),ut={0:s[x],index:b.indexOf(s[x])},D=d?ut:v;return D?(m.type==="parameter"&&D&&R.push(D[0]),{params:R,textIndex:A+(D&&D.index+D[0].length),wordMatchIndex:x+(d&&1)}):f},{params:[],textIndex:0,wordMatchIndex:0});return u===l.params.length?l.params:null},rr=(r,n)=>{let s=$n(r.match),{regex:i}=Sn(s),{transformers:u,regex:l}=wn(i),{regex:f}=Tn(l);return{found:V({...r,match:f},n),escaped:s,regexAlts:i,transformers:u,regexAnchors:f,regexConverted:l}},_t=(r,n,s)=>{if(r.match===n)return{definition:r,match:[]};let{found:i,transformers:u}=rr(r,n);if(!i||!i.definition||!i.match)return Y.noOpObj;let l=tr(n,r.match,i.match);if(!l)return Y.noOpObj;let f=xe(l,u,s);return f.length!==l.length?Y.noOpObj:{definition:r,match:f}};var{REGEX_VARIANT:jn}=L,bt=class{find=er;regex=V;parts=Rt;types=J;extract=tr;expression=_t;expressionFind=rr;register=Ot},er=(r,n,s)=>r.reduce((i,u)=>i.match||!u.match?i:u.variant!==jn?_t(u,n,s):V(u,n,s),Ee.noOpObj);var X=T(w());var{REGEX_VARIANT:$e,EXPRESSION_VARIANT:Pn,STEP_TYPES:Ln}=L,Fn=r=>{let n=r.variant===$e?r.match.toString():`"${r.match}"`;return`${(0,X.capitalize)(r.type)}(${n}, ${r.method.toString()})`},In=function(r,n,s,i,u=X.noOpObj){let l={type:n,meta:u,match:s,method:i,tokens:[],variant:s.toString().indexOf("/")===0?$e:Pn};l.name=Kr(l),l.uuid=F(`${n}-${l.name}`),l.content=Fn(l);let f=this.list(),m=Jr(l,f);return m&&this[r].push(m),m},Cn=(r,n,s)=>(...i)=>{let u=r[n](...i);return s[n].push(u),u},vn=function(r){let n=this.types.map(i=>(0,X.capitalize)(i)),s=n.reduce((i,u)=>(i[u]=[],i),{});return(0,X.eitherArr)(r,[r]).map(i=>{Function(`return (global, require, module, ${n.join(",")}) => {
          return (function(global) { ${i} }).call(global, global)
        }`)()(yt(),be(),_e(),...n.map(u=>Cn(this,u,s)))}),s},Mn=r=>r.types.reduce((n,s)=>n.concat(r[`_${s}`]),[]),At=class{types=Ln;constructor(n){this._world=n||{};let s=this;this.types.map(i=>{let u=`_${i}`;this[u]=[],this[(0,X.capitalize)(i)]=(l,f,m)=>s.register(u,i,l,f,m)})}list=()=>Mn(this);typeList=()=>this.types.reduce((n,s)=>{let i=`_${s}`;return n[i]=[...this[i]],n},{});match=n=>{let s=this.list(),i=er(s,n,this._world);return!i.match||!i.definition?!1:(i.match.push(this._world),i)};resolve=n=>{let s=this.match(n);return s?s.definition.method(...s.match):pe(`Matching definition could not be found for step: "${n}"`)};register=(...n)=>(0,X.isStr)(n[0])?In.apply(this,n):vn.apply(this,n);clear=()=>{this.types.map(n=>this[`_${n}`]=[])}};var Q=T(w());var{HOOK_TYPES:we}=L,Et=class{types=we;instance=void 0;constructor(n,s){this._registeredHooks={},this.instance=s,this.types.map(i=>{this[i]=u=>{(0,Q.isFunc)(u)&&(this._registeredHooks[i]=this._registeredHooks[i]||[],this._registeredHooks[i].push(u))}})}getRegistered=n=>{let s=this.types.includes(n)?this._registeredHooks[n]||Q.noPropArr:de(we.join(", "),n);return s.length?async()=>s.reduce(async(i,u)=>(await i,await u(this.instance)),Promise.resolve()):Q.noOp}};var Nn=/^\s*Given (.*)$/,Xn=/^\s*When(.*)$/,Dn=/^\s*Then (.*)$/,kn=/^\s*And (.*)$/,Un=/^\s*But (.*)$/,Wn=/^\s*\* (.*)$/,Hn=/^\s*?"""\s*?/;var Bn=/^\s*?```\s*?/;var Se=/^\s*?\|/;var qn=[{regex:Nn,type:"given"},{regex:Xn,type:"when"},{regex:Dn,type:"then"},{regex:kn,type:"and"},{regex:Un,type:"but"},{regex:Wn,type:"and"}],zn=(r,n,s,i)=>{if(!Se.test(s))return r;let u;return r.table={index:i,content:n.reduce((l,f)=>(u=u||!Se.test(f),!u&&l.push(f.split("|").reduce((m,R)=>{let A=R.trim();return A&&m.push(A),m},[])),l),[])},r},Gn=(r,n,s,i)=>{let u=Hn.test(s)&&'"""';if(u=u||Bn.test(s)&&"```",!u)return r;let l=s.split(u)[0],f=new Array(l.length).fill("\\s").join(""),m=new RegExp(`^${f}`);return r.doc={index:i,whiteSpace:l,type:u==='"""'?"quote":"tick",content:n.split(u).slice(1).shift().trim().split(`
`).reduce((R,A)=>(R.push(A.replace(m,"").trim()),R),[]).join(`
`)},r},Kn=(r,n,s,i)=>{let u={type:r,index:i,step:n,uuid:F(`${r}-${n}`)},l=i+1,f=s[l],m=s.slice(l);return u=zn(u,m,f,l),u=Gn(u,m.join(`
`),f,l),u},Te=(r,n,s,i)=>qn.reduce((u,l)=>{if(u)return u;let f=l.regex.test(s);return f&&r.steps.push(Kn(l.type,N(s,l.regex,1),n,i)),f},!1);var ve=T(w());var Z=T(w());var{ALIAS_REF:Jn,WORLD_REF:Vn,ALIAS_WORLD_KEY:Yn,WORLD_AT_RUNTIME:je,ALIAS_REF_AT_RUNTIME:Pe}=L,Le=(r,n,s)=>{let i=(0,Z.get)(n,s);return(0,Z.isFunc)(i)?i(n,s):(0,Z.exists)(i)?i:r},Qn=(r,n)=>{let s;try{return r.replace(ie,i=>{s=i;let u=i.trim();return u.indexOf(Pe)===0?u.replace(Pe,`$${Jn}`):Le(i,n,u.replace(ce,`${Yn}.`))})}catch(i){Oe(i,s)}},Zn=(r,n)=>{let s;try{return r.replace(oe,i=>{s=i;let u=i.trim();return u.indexOf(je)===0?u.replace(je,Vn):Le(i,n,u.replace(ne,""))})}catch(i){ge(i,s)}},Fe=(r,n)=>Zn(Qn(r,n),n);var to=/\r?\n/g,Ie=/^\s*@(.*)$/,Ce=/^\s*#(.*)$/,nr=/^\s*Feature:(.*)$/,or=/^\s*Rule:(.*)$/,ro=/^\s*As (.*)$/,eo=/^\s*I want (.*)$/,no=/^\s*So that (.*)$/,oo=/^\s*In order (.*)$/,sr=/^\s*Scenario:(.*)$/,cr=/^\s*Example:(.*)$/,Me=/^\s*Background:(.*)$/,so=[{regex:ro,key:"perspective"},{regex:eo,key:"desire"},{regex:no,key:"reason"},{regex:oo,key:"reason"}],Ne=(r,n,s)=>({index:s,content:n,feature:r,tags:[],rules:[],reason:[],comments:[],scenarios:[],...r&&{uuid:F(r,s)}}),Xe=(r,n)=>({index:n,rule:r,tags:[],scenarios:[],...r&&{uuid:F(r,n)}}),De=(r,n)=>({index:n,scenario:r,tags:[],steps:[],...r&&{uuid:F(r,n)}}),ke=(r,n)=>({index:n,steps:[],background:r,...r&&{uuid:F(r,n)}}),co=(r,n,s)=>{n&&r.reason.push({content:n,index:s})},io=(r,n,s)=>{let i=!1;return so.reduce((u,l)=>{if(u)return u;let f=l.regex.test(n);return!i&&f&&(i=!0),f&&(l.key==="reason"?co(r,N(n,l.regex,0),s):r[l.key]={content:N(n,l.regex,0),index:s})},!1),i},ao=(r,n,s,i)=>{if(!Ie.test(s))return!1;let u=r.background?n:r,l=N(s,Ie,0);return u.tags=(u.tags||[]).concat(l.split(" ")),!0},uo=(r,n,s)=>{if(!Ce.test(n))return!1;let i=n.match(Ce)[0];return r.comments.push({content:i,index:s}),!0},lo=(r,n,s,i,u)=>{if(!nr.test(s))return n;let l=N(s,nr,1);if(!n.feature)return n.feature=l,n.index||(n.index=u),n.uuid||(n.uuid=F(n.feature,u)),!r.includes(n)&&r.push(n),n;let f=Ne(l,i,u);return r.push(f),f},po=(r,n,s,i)=>{if(!or.test(s))return n;let u=N(s,or,1);return n.rule?n=Xe(u,i):n.rule=u,!n.index&&(n.index=i),!n.uuid&&(n.uuid=F(n.rule,i)),!r.rules.includes(n)&&r.rules.push(n),n},mo=(r,n,s,i,u)=>{let l=sr.test(i);if(!l&&!cr.test(i))return s;let f=l&&N(i,sr,1);f=f||N(i,cr,1),s.scenario?s=De(f,u):s.scenario=f,!s.index&&(s.index=u),!s.uuid&&(s.uuid=F(s.scenario,u));let m=n.uuid?n:r;return!m.scenarios.includes(s)&&m.scenarios.push(s),s},fo=(r,n,s,i,u)=>{if(!Me.test(i))return s;let l=n.uuid?n:r,f=`${l.uuid}-background`;return s.background?s=ke(f,u):s.background=f||"",!s.index&&(s.index=u),!s.uuid&&(s.uuid=F(s.background,u)),l.background=s,s},ho=(r,n,s,i,u,l)=>sr.test(l)||cr.test(l)?i:nr.test(l)?n:or.test(l)?s:Me.test(l)?u:r,$t=function(r,n){n=n||this&&this.world||ve.noOpObj;let s=[],u=Fe((r||"").toString(),n).split(to),l=Xe(!1),f=De(!1),m=ke(!1),R=Ne(!1,r),A=R;return u.reduce((x,b,d)=>(R=lo(x,R,b,r,d),uo(R,b,d)||io(R,b,d)||(l=po(R,l,b,d),f=mo(R,l,f,b,d),m=fo(R,l,m,b,d),!A.feature&&Te(A,u,b,d))||(A=ho(A,R,l,f,m,b),ao(A,R,b,d)),x),s)};var Ue=function(r){return this.steps.register([r])};var it=T(w());var{SPEC_RESULT_LOG:We,LOG_JEST_SPEC_ENV:go}=L,wt=r=>{let n=new Date().getTime();(0,it.get)(process,`env.${go}`)&&process.stdout.write([We,JSON.stringify({...r,timestamp:n}),We].join(""))},He=r=>{let n=(0,it.get)(r,"description"),s=n?n.startsWith("Scenario >")?"Scenario":n.startsWith("Background >")?"Background":n.startsWith("Rule >")?"Rule":"Feature":"Feature";return{type:s.toLowerCase(),...s!=="Feature"&&{description:n.replace(`${s} >`,`${s}:`)}}},W=(r,n)=>n?it.noOp:global[r]||ae(r),Oo=r=>{let n=[],s=r.describe;return r.describe=(...i)=>{let u=s.apply(null,i);return n.push(u),u},{suiteStarted:i=>{wt({...i,...He(i),action:"start"})},specStarted:i=>{wt({...i,type:"step",action:"start"})},specDone:i=>{if(wt({...i,type:"step",action:"end"}),i.status!=="failed")return;let u=n.find(l=>l.children.find(f=>f.result===i));u&&u.children.map(l=>l.disable())},suiteDone:i=>{wt({...i,...He(i),action:"end"})}}},Be=r=>{if(!Zt)return;let n=ye().getEnv();n&&n.describe&&n.addReporter(Oo(n,r))};var j=T(w()),ir=(r,n)=>`${(0,j.capitalize)(n)} > ${r}`,Ge=(r,n)=>(0,j.isStr)(r)?$t(r,n):(0,j.isObj)(r)?[r]:(0,j.isArr)(r)?r.reduce((s,i)=>s.concat(Ge(i,n)),[]):le(),xo=async(r,n,s)=>{W("test",s)(`${(0,j.capitalize)(n.type)} ${n.step}`,async()=>await r.resolve(n.step))},qe=(r,n,s,i)=>{let u=W("describe",i),l=[];return u(n,()=>{let f=r.steps.map(m=>xo(s,m,i));Promise.all(f)}),l},Ke=(r,n,s,i)=>(s&&qe(s,ir(n.scenario,"Background"),r,i),qe(n,ir(n.scenario,"Scenario"),r,i)),Ro=(r,n,s,i)=>{let u=[];return describe(`Rule > ${n.rule}`,()=>{u=n.scenarios.map(l=>Ke(r,l,s||n.background,i)),Promise.all(u)}),u},yo=r=>(0,j.isStr)(r)&&r.match(/[@]\w*/g),ze=(r="",n=[],s={})=>{let{name:i,tags:u}=s,l=(0,j.isStr)(u)?yo(u):(0,j.eitherArr)(u,[]),f=!i||r.includes(i),m=!l.length||l.every(R=>n.includes(R));return f&&m},_o=(r,n={})=>r.reduce((s,i)=>{if(ze(i.feature,i.tags,n))return s.push(i),s;let l=i.scenarios.filter(f=>ze(f.scenario,[...f.tags||[],...i.tags||[]],n));return l.length&&s.push({...i,scenarios:l}),s},[]),St=class{constructor(n,s,i){!n&&ue(),!s&&throwMissingHooks(),this.steps=n,this.hooks=s,this._world=i}getFeatures=(n,s)=>{let i=Ge(n,this._world);return _o(i,s)};run=async(n,s=j.noOpObj)=>{let i=this.run.PARKIN_TEST_MODE;Be(i);let u=W("describe",i),l=W("beforeAll",i),f=W("afterAll",i),m=W("beforeEach",i),R=W("afterEach",i),A=this.getFeatures(n,s);if(!A.length)return!1;let x=await A.map(async b=>{let d=[];return l(this.hooks.getRegistered("beforeAll")),f(this.hooks.getRegistered("afterAll")),m(this.hooks.getRegistered("beforeEach")),R(this.hooks.getRegistered("afterEach")),u(ir(b.feature,"Feature"),()=>{d=b.rules.map(v=>Ro(this.steps,v,b.background,i)),d.concat(b.scenarios.map(v=>Ke(this.steps,v,b.background,i))),Promise.all(d)}),d});return await Promise.all(x),!0}};var S=T(w()),{FEATURE_META:bo}=L,H=(r,n,s)=>{(0,S.exists)(s)?(0,S.exists)(r[s])?r.splice(s,0,n):r[s]=n:r.push(n)},Je=(r,n,s="")=>{(0,S.isArr)(n)&&n.length&&H(r,`${s}${n.join(" ")}`)},Ao=(r,n)=>{bo.map(s=>{switch(s){case"feature":H(r,`Feature: ${n[s]}`,n.index);break;case"comments":(0,S.isArr)(n[s])&&n[s].map(i=>H(r,i.content,i.index));break;case"reason":(0,S.isArr)(n[s])&&n[s].map(i=>H(r,`  ${i.content}`,i.index));break;case"desire":case"perspective":n[s]&&H(r,`  ${n[s].content}`,n[s].index);break}})},Eo=(r,n)=>{(0,S.isArr)(n.steps)&&n.steps.length&&n.steps.map(s=>H(r,`    ${(0,S.capitalize)(s.type)} ${s.step}`,s.index))},$o=(r,n)=>{n.scenarios&&n.scenarios.map(s=>{Je(r,s.tags,"  "),H(r,`  Scenario: ${s.scenario}`,s.index),Eo(r,s)})},wo=(r,n,s)=>{let i=r[s+1],u=r[s-1],l=(0,S.exists)(i)?i:u;if(!l)return`${n}
`;let f=n.split("#").pop();return`${Array(l.length-l.trimStart().length).join(" ")} # ${f}
`},So=r=>Array.from(r,(n,s)=>(0,S.exists)(n)?n.startsWith("#")?wo(r,n,s):`${n}
`:`
`).join("").trim(),Ve=r=>(0,S.eitherArr)(r,[r]).map(n=>{let s=[];return!(0,S.isObj)(n)&&fe(n),Je(s,n.tags),Ao(s,n),$o(s,n),So(s)});var Ye={feature:Ve};var C=T(w()),at=class{constructor(n,s){(0,C.isObj)(n)&&this.init(n,s)}#t=!1;init=(n=C.noOpObj,s)=>{if(this.#t)return console.warn("This instance of parkin has already been initialized!");(0,C.isObj)(n.$alias)||(n.$alias={}),this.#t=!0,this.world=n,this.steps=new At(this.world),this.hooks=new Et(this.world),this.runner=new St(this.steps,this.hooks,this.world),this.run=this.runner.run,this.parse={feature:$t.bind(this),definition:Ue.bind(this)},this.assemble=Ye,this.paramTypes={register:Ot},this.matcher=new bt,(0,C.isObj)(s)&&this.registerSteps(s),this.steps.types.map(i=>{this[(0,C.capitalize)(i)]=(u,l,f)=>this.steps.register(`_${i}`,i,u,l,f)})};registerSteps=n=>{Object.entries(n).map((s,i)=>Object.entries(i).map((u,l)=>this.steps[(0,C.capitalize)(s)](u,...(0,C.eitherArr)(l,[l]))))}},Qe=new at;var Ze=r=>{let n=yt(),s=r||process.env.PARKIN_TEST_GLOBALS_OVERRIDE;(!n.Parkin||s)&&(n.Parkin=at),(!n.PK||s)&&(n.PK=Qe)};Ze();var To=(r=!0)=>Ze(r);0&&(module.exports={setParkinGlobals});
//# sourceMappingURL=global.js.map
