var cn=Object.create;var pt=Object.defineProperty;var an=Object.getOwnPropertyDescriptor;var un=Object.getOwnPropertyNames;var ln=Object.getPrototypeOf,pn=Object.prototype.hasOwnProperty;var mn=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),fn=(r,n)=>{for(var s in n)pt(r,s,{get:n[s],enumerable:!0})},Br=(r,n,s,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of un(n))!pn.call(r,u)&&u!==s&&pt(r,u,{get:()=>n[u],enumerable:!(i=an(n,u))||i.enumerable});return r};var T=(r,n,s)=>(s=r!=null?cn(ln(r)):{},Br(n||!r||!r.__esModule?pt(s,"default",{value:r,enumerable:!0}):s,r)),hn=r=>Br(pt({},"__esModule",{value:!0}),r);var w=mn((mt,qr)=>{(function(r,n){typeof mt=="object"&&typeof qr<"u"?n(mt):typeof define=="function"&&define.amd?define(["exports"],n):n((r=typeof globalThis<"u"?globalThis:r||self).jsutils={})})(mt,function(r){"use strict";let n={SHOULD_LOG:!0,SHOULD_THROW:!1,LOG_PREFIX:null},s=()=>!0,i=(t,e={},o={})=>{let{logs:c=n.SHOULD_LOG,throws:a=n.SHOULD_THROW,prefix:p=n.LOG_PREFIX}=o,h=Object.entries(t).map(([$,G])=>u($,G,e[$]||e.$default||s)),{success:g,cases:R}=h.reduce(($,G)=>l($,G,{logs:c,throws:a,prefix:p}),{success:!0,cases:{}});return[g,R]};i.setOptions=({logs:t,throws:e,prefix:o})=>{t!==void 0&&(n.SHOULD_LOG=t),e!==void 0&&(n.SHOULD_THROW=e),o!==void 0&&(n.LOG_PREFIX=o)},i.resetOptions=()=>{n.SHOULD_LOG=!0,n.SHOULD_THROW=!1,n.LOG_PREFIX=null};let u=(t,e,o)=>{let c=o(e),a=!o.name||o.name===t||o.name==="$default"?o.toString():o.name;return{success:c,key:t,value:e,validator:o,reason:c?null:[`Argument "${t}" with value `,e,` failed validator: ${a}.`]}},l=(t,e,{logs:o,throws:c,prefix:a})=>(!e.success&&f(e,o,c,a),{success:t.success&&e.success,cases:{...t.cases,[e.key]:e}}),f=(t,e,o,c)=>{let a=c?[c,...t.reason]:t.reason;if(o)throw new Error(a.join());e&&console.error(...a)},m=t=>Array.isArray(t),y=t=>{let e=new Map;for(let c=0;c<t.length;c++){var o;let a=t[c],p=(o=e.get(a))!==null&&o!==void 0?o:0;e.set(a,p+1)}return e},b=(t,e)=>{if(t.size!==e.size)return!1;for(let[o,c]of t)if(e.get(o)!==c)return!1;return!0},O=t=>typeof t=="object"&&!Array.isArray(t)&&t!==null,A=t=>m(t)?t:[t],d=t=>typeof t=="function",v=t=>(Object.freeze(t),Object.getOwnPropertyNames(t).map(e=>{t.hasOwnProperty(e)&&t[e]!==null&&(typeof t[e]=="object"||d(t[e]))&&!Object.isFrozen(t[e])&&v(t[e])}),t),at=Object.freeze({}),D=v({content:{}}),Qe=v([]),tt=t=>t==t&&t!=null,ir=(t,e,o)=>{for(let c=0;c<t.length;c++){let a=t[c];m(a)?ir(a,e,o):o.exists&&!tt(a)||o.truthy&&!a||e.push(a)}return o.mutate?(Object.assign(t,e).splice(e.length),t):e},ar=(t,e)=>ir(t,[],O(e)?e:at),ur=(t,e)=>{if(m(e)){let[o,...c]=e;return o(t,...c)}return d(e)?e(t):(console.error("Pipeline expected either a function or an array (for function expressions). Found "+typeof e),t)},St=(t,...e)=>e.reduce((o,c)=>ur(o,c),t),x=t=>typeof t=="string",lr=(t,e)=>{if(!x(t)||!d(e))return t;let o="";for(let c of t)o+=e(c);return o},pr=t=>t===t.toLowerCase(),mr=t=>t===t.toUpperCase(),fr=(t,e,o=["-","_"," "])=>{if(!x(t))return t;let c=p=>o.some(h=>h===p),a="_";return lr(t,p=>c(p)?(a=e,e):mr(p)&&pr(a)&&!c(a)?(a=p,e+p):(a=p,p))},ut=(t,e=!0)=>{if(!x(t)||!t[0])return t;let o=e?t.slice(1).toLowerCase():t.slice(1);return`${t[0].toUpperCase()}${o}`},hr=t=>{let e=t.indexOf(".")===0?t.slice(1):t;return e.indexOf(".")===e.length-1?e.slice(0,-1):e},Tt=t=>t&&hr(t).replace(/[-_]/gm," ")||t,dr=(t,e)=>t&&Tt(t).split(/[\s_-]/gm).reduce((o,c,a)=>c?o+=(a>0||e)&&ut(c)||c.toLowerCase():o,"")||t,B=t=>t==null?"":x(t)?t:JSON.stringify(t),Ze=/[A-Z]/g,tn=/^ms-/,jt={},rn=t=>"-"+t.toLowerCase(),q=t=>typeof t=="number"&&t!=t,E=t=>typeof t=="number"&&!q(t),Ft=t=>E(t)&&t>=0,gr=t=>x(t)&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")||t,F=t=>typeof t=="object"&&t!==null,Lt=(t,e,o,c)=>{let a=t;if(!F(t)||!t||!e)return o!=="set"&&c||void 0;let p=m(e)?Array.from(e):e.split("."),h=p.pop(),g,R;for(;g=p.shift();){let $=t[g];if(F($)||d($)?t=$:(o==="set"?t[g]={}:R=!0,t=t[g]),R)return c}return o==="get"?h in t?t[h]:c:o==="unset"?delete t[h]:(t[h]=c)&&a||a},rt=(t,e,o)=>Lt(t,e,"get",o),xr=(t,e,o="")=>{e=F(e)&&e||{};let c=xr.regex||/\${(.*?)\}/g;return x(t)?t.replace(c,(a,p)=>{let h=(p||a.substr(2,a.length-3)).trim(),g=rt(e,h,o);return d(g)?g(e,h,o):g}):console.error("template requires a string as the first argument")||t},en=['"',"'"],Pt=t=>{if(!x(t))return;let e="";for(let o of t)e=o+e;return e},Or=(t,e,o)=>o.map(c=>t.indexOf(c,e)).sort().find(c=>c>=0),yr=(t,e,o=[" "])=>{let c=Or(t,e,o);return t.substring(e,c===-1?t.length:c)},lt=t=>typeof t=="boolean",It=t=>t==="false"||t==="true",Rr=t=>lt(t)?B(t):t&&t!=="false"&&t!=="0"?"true":"false",_r=t=>Boolean(t||t===""||t===0),Ct=t=>It(t)?t==="true":Rr(t)==="true",et=t=>B(t).replace(/([^.\d])/gm,""),vt=t=>E(t)?t:t&&!q(t)&&Number(et(t))||0,Ar=t=>x(t)||E(t)||lt(t),Mt=(t,e)=>{let[o]=i({x:t,y:e},{$default:Ar});return o?x(t)?t.localeCompare(e):t-e:null},Xt=t=>t,br=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Nt=t=>{let e=function(...o){return t instanceof e||rt(t.prototype,"constructor.name")?new t(...o):t.apply(t,o)};for(let o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return Object.defineProperty(e,"name",{value:t.name,configurable:!0}),e.toString=()=>t.toString(),e},M=(t,e=new WeakMap)=>{if(Object(t)!==t)return t;if(t instanceof Set)return new Set(t);if(e.has(t))return e.get(t);if(m(t))return t.map(c=>M(c));if(d(t))return Nt(t);let o=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t.constructor?null:Object.create(null);return o===null?Er(t):(e.set(t,o),t instanceof Map?Array.from(t,([c,a])=>o.set(c,M(a,e))):Object.assign(o,...Object.keys(t).map(c=>({[c]:M(t[c],e)}))))},Er=t=>{if(!t)return t;let e=Object.getPrototypeOf(t),o=Object.getOwnPropertyDescriptors(t);for(let[a,p]of Object.entries(o))p.value&&(o[a].value=M(p.value));let c=Object.create(e,o);return Object.isFrozen(t)&&Object.freeze(c),Object.isSealed(t)&&Object.seal(c),c},$r=t=>t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,$r),wr=t=>Object.prototype.toString.call(t).slice(8,-1),Sr=(t,...e)=>{if(!e.length)return null;for(let o of e){if(!m(o)){console.error(`Matching case must be an entry (a 2-element array). Found: ${wr(o)}`,o);break}let[c,a]=o;if(d(c)&&c(t)||c===t)return a}return null};Sr.default=()=>!0;let Tr=t=>O(t)?Object.keys(t).length===0:m(t)?t.length===0:x(t)?t.trim().length===0:!!E(t)&&t<1,Dt=(t,e)=>{let[o]=i({arr:t,comparator:e},{arr:m,$default:d});return o&&t.length?t.reduce((c,a)=>e(c,a)>0?c:a):null},jr=t=>m(t)?t.filter((e,o,c)=>c.indexOf(e)==o):t,Fr=(t,e)=>{if(!e)return jr(t);let{unique:o}=t.reduce((c,a)=>{let p=e(a);return!c.set.has(p)&&c.unique.push(a),c.set.add(p),c},{unique:[],set:new Set});return o},Lr=(t,e=!0)=>F(t)?Object.keys(t).reduce((o,c)=>{let a=t[c];return a==null||(o[c]=e&&F(a)?Lr(a):a),o},O(t)&&{}||[]):console.error("cleanColl requires a collection as the first argument")||t,kt=(t,e,o)=>Lt(t,e,"set",o),Pr=Array.isArray,Ir=Object.keys,nn=Object.prototype.hasOwnProperty,Ut=(t,e)=>{if(t===e)return!0;if(!t||!e||typeof t!="object"||typeof e!="object")return t!=t&&e!=e;let o=Pr(t),c=Pr(e),a,p,h;if(o&&c){if(p=t.length,p!=e.length)return!1;for(a=p;a--!=0;)if(!Ut(t[a],e[a]))return!1;return!0}if(o!=c)return!1;let g=t instanceof Date,R=e instanceof Date;if(g!=R)return!1;if(g&&R)return t.getTime()==e.getTime();let $=t instanceof RegExp,G=e instanceof RegExp;if($!=G)return!1;if($&&G)return t.toString()==e.toString();let Bt=Ir(t);if(p=Bt.length,p!==Ir(e).length)return!1;for(a=p;a--!=0;)if(!nn.call(e,Bt[a]))return!1;for(a=p;a--!=0;)if(h=Bt[a],!Ut(t[h],e[h]))return!1;return!0},Cr=t=>t&&x(t)?It(t)?Ct(t):E(t)?vt(t):(()=>{try{return JSON.parse(t)}catch{return t}})():t,Wt,nt="dir",z="type",on=["error","info","log","dir","warn"],vr=(...t)=>{if(!t.length)return;let e=t.length===1?nt:t.pop();(Wt||e==="error")&&(typeof t[0]=="string"&&(z==="type"?t[0]=`[ ${e.toUpperCase()} ] ${t[0]}`:z&&(t[0]=`${z} ${t[0]}`)),on.indexOf(e)!==-1?console[e](...t):console[nt](...t,e))},Mr=(t,e)=>{t&&Object.entries(t).map(([o,c])=>{e&&e.indexOf(o)!==-1||(typeof c=="object"&&Mr(c),t[o]=void 0,delete t[o])})},Xr=(...t)=>t.reduce((e,o)=>{let c=M(o);return m(c)?[...m(e)&&e||[],...c]:O(c)?Object.entries(c).reduce((a,[p,h])=>({...a,[p]:d(h)?Nt(h):F(h)&&p in a?Xr(a[p],h):M(h)}),e):e},m(t[0])&&[]||{}),Nr=t=>m(t)&&t.length===2&&(E(t[0])||x(t[0])),Dr=(t,e)=>{if(!m(t)&&!O(t))return console.error(t,"Expected array or object for obj. Found "+typeof t),t;if(!d(e))return console.error("Expected function for cb. Found "+typeof e),t;let o=Object.entries(t),c=m(t)?[]:{};return o.reduce((a,[p,h])=>{let g=e(p,h);return Nr(g)?kt(a,g[0],g[1]):(console.error(`Callback function must return entry. Found: ${g}. Using current entry instead.`),kt(a,p,h))},c)},ot=(t,e,o={})=>O(t)&&d(e)&&Object.entries(t).reduce((c,[a,p])=>e(a,p,c),o)||o,Ht=t=>{if(!d(t))throw"Argument must be a function";return(...e)=>new Promise((o,c)=>d(e[e.length-1])?(e.pop(),e.push((...a)=>a&&a[0]?c(...a):o(...a)),t(...e)):o(t(...e)))},sn=Array.from(["caller","callee","arguments","apply","bind","call","toString","__proto__","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","valueOf","toLocaleString"]).concat(Object.getOwnPropertyNames(Object.prototype)).reduce((t,e)=>(t[e]=!0,t),{}),kr=t=>{if(!t.__IS_PROMISIFIED__){for(let e of Object.getOwnPropertyNames(t))if(!(e.indexOf("Async")!==-1||t[`${e}Async`])&&!sn[e])if(d(t[e]))t[`${e}Async`]=Ht(t[e]);else{let o=Object.getOwnPropertyDescriptor(t,e).get;d(o)&&(t[`${e}Async`]=Ht(o))}t.__IS_PROMISIFIED__=!0}return t},Ur=t=>Boolean(t&&t instanceof RegExp),Wr=t=>Ur(t)?t.source:x(t)?t:null,Hr=t=>{let e={},o=t.split("?"),c=o[o.length-1];if(!c)return e;let a=c.split("&");return a.length&&a.map(p=>{let h=p.split("=");if(h.length<=1)return e;let g=[h.shift(),h.join("=")];if(g.length===2){let R=decodeURIComponent(g[1]).split(",");if(R&&R.length>1)e[g[0]]=R;else if(g[0]in e){let $=e[g[0]];e[g[0]]=m($)?$.push(decodeURIComponent(g[1])):[$,decodeURIComponent(g[1])]}else e[g[0]]=decodeURIComponent(g[1])}}),e};r.applyToCloneOf=(t,e)=>{let o;if(t||(o="object (Argument 1) in applyToCloneOf, must be defined!"),O(t)||(o="object (Argument 1) in applyToCloneOf, must be an object!"),e||(o="mutator (Argument 2) in applyToCloneOf, must be defined!"),d(e)||(o="mutator (Argument 2) arg in applyToCloneOf, must be a function!"),o)return console.warn(o)||t;let c=M(t);return e(c),c},r.applyToFunc=ur,r.areCountMapsEqual=b,r.areFrequencyEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;if(t.length!==e.length)return!1;let c=y(t),a=y(e);return b(c,a)},r.areSetEqual=(t,e)=>{let[o]=i({arr:t,otherArr:e},{$default:m});if(!o)return null;if(t===e)return!0;let[c,a]=t.length>e.length?[t,e]:[e,t],p=new Set(a);for(let h=0;h<c.length;h++){let g=c[h];if(!p.has(g))return!1}return!0},r.buildElementCountMap=y,r.buildPath=(...t)=>t.reduce((e,o)=>{let c=toStr(o);return`${e}${c&&"/"+c||""}`},"").replace(/([^:\/]|^)\/{2,}/g,"$1/"),r.camelCase=dr,r.camelCasePath=t=>{let e=t.split(".").map((o,c)=>c>0?ut(o,!1):o);return e.length>1?e.join(""):t},r.capitalize=ut,r.checkCall=(t,...e)=>d(t)?t(...e):void 0,r.cleanColl=Lr,r.cleanStr=Tt,r.clearObj=Mr,r.cloneArr=t=>Array.from([...m(t)&&t||O(t)&&Object.entries(t)||[]]),r.cloneFunc=Nt,r.cloneJson=t=>{try{return JSON.parse(JSON.stringify(t))}catch(e){return vr(e.message,"error"),null}},r.cloneObjWithPrototypeAndProperties=Er,r.compareTo=Mt,r.complement=t=>{let[e]=i({predicate:t},{predicate:d});return e?(...o)=>!t(...o):null},r.containsStr=(t,e,o)=>(t=!x(t)&&B(t)||t,e=!x(e)&&B(e)||e,t.indexOf(e,o)!==-1),r.convertToStrBool=Rr,r.debounce=(t,e=250,o=!1)=>{let c;return function(...a){if(!d(t))return null;let p=this,h=o&&!c;return clearTimeout(c),c=setTimeout(()=>{c=null,!o&&t.apply(p,a)},e),h?d(t)&&t.apply(p,a):void 0}},r.deepClone=M,r.deepEqual=Ut,r.deepFreeze=v,r.deepMerge=Xr,r.delimitString=fr,r.doIt=(...t)=>{let e=t.slice(),o=e.shift(),c=e.shift(),a=e.pop();if(!E(o)||!d(a))return[];let p=new Array(o),h=[];for(let g=0;g<p.length;g++){let R=a.call(c,g,...e);if(R===!1)break;h.push(R)}return h},r.either=(t,e,o)=>d(o)?o(t,e)&&t||e:_r(t)&&t||e,r.eitherArr=(t,e)=>m(t)?t:e,r.eitherFunc=(t,e)=>d(t)&&t||e,r.eitherObj=(t,e)=>O(t)&&t||e,r.eitherStr=(t,e)=>x(t)&&t||e,r.ensureArr=A,r.equalsNaN=q,r.everyEntry=(t,e)=>t?O(t)?d(e)?St(t,Object.entries,o=>o.every(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into everyEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`everyEntry expects argument obj [${t}] to be defined.`),!1),r.exists=tt,r.filterObj=(t,e)=>t&&(O(t)?d(e)?ot(t,(o,c,a)=>(e(o,c)&&(a[o]=c),a),{}):(console.error(`Argument 'predicate' passed into filterObject must a function. Found: ${e}`),t):(console.error(`Object ${t} was not an object. It must be for filterObject`),t)),r.findExtrema=Dt,r.findMax=(t=[],e=Xt)=>Dt(t,(o,c)=>Mt(e(o),e(c))),r.findMin=(t=[],e=Xt)=>Dt(t,(o,c)=>Mt(e(c),e(o))),r.flatArr=ar,r.flatMap=(t,e)=>{let[o]=i({arr:t,mapFn:e},{arr:m,mapFn:d});return o?t.reduce((c,a)=>{let p=e(a);return m(p)?p.map(h=>c.push(h)):c.push(p),c},[]):t},r.flatUnion=(...t)=>{let e=t.pop(),o={exists:!0},c=d(e)?e:t.push(e)&&void 0;return t.reduce((a,p)=>m(p)?Fr(ar([...a,...p],o),c):a,[])},r.get=rt,r.getNearestDelimiterIndex=Or,r.getNums=et,r.getRegexSource=Wr,r.getURLParam=t=>{var e,o,c;let[a]=i({paramKey:t},{paramKey:x});if(!a)return null;let p=typeof document<"u"?document:null,h=p==null||(e=p.location)===null||e===void 0?void 0:e.search;return x(h)&&(o=(c=Hr(h))===null||c===void 0?void 0:c[t])!==null&&o!==void 0?o:null},r.getWordEndingAt=(t,e,o=[" "])=>{let c=Pt(t),a=t.length-e;return Pt(yr(c,a,o))},r.getWordStartingAt=yr,r.hasDomAccess=()=>{try{return!(typeof window>"u"||!window.document||!window.document.createElement)}catch{return!1}},r.hasOwn=br,r.hashString=(t,e)=>{if(!x(t)||t.length==0)return 0;t=t.split("").reverse().join("");let o=0;for(let c=0;c<t.length;c++)o=(o<<5)-o+t.charCodeAt(c),o=`${Math.abs(o&o)}`;return Ft(e)?o.slice(0,e):o},r.hyphenator=t=>{if(jt.hasOwnProperty(t))return jt[t];let e=t.replace(Ze,rn);return jt[t]=tn.test(e)?"-"+e:e},r.identity=Xt,r.isArr=m,r.isArrMap=t=>{if(!O(t))return!1;let e=Object.values(t);return Ct(e.length&&e.every(m))},r.isBool=lt,r.isColl=F,r.isEmail=t=>!t||!x(t)?!1:Boolean(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(t)),r.isEmpty=Tr,r.isEmptyColl=t=>m(t)?t.length===0:F(t)&&Object.getOwnPropertyNames(t).length===0,r.isEntry=Nr,r.isFloat=t=>E(t)&&t%1!=0,r.isFunc=d,r.isInt=t=>E(t)&&t%1==0,r.isLowerCase=pr,r.isNegative=t=>E(t)&&t<0,r.isNonNegative=Ft,r.isNum=E,r.isObj=O,r.isOrderable=Ar,r.isPhone=t=>!t||!x(t)?!1:Boolean(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(t))&&t.replace(/\D/g,"").length<11,r.isPositive=t=>E(t)&&t>0,r.isQuoted=(t,e=en)=>x(t)&&e.some(o=>t.startsWith(o)&&t.endsWith(o)),r.isRegex=Ur,r.isSame=(t,e)=>t===e?t!==0||1/t==1/e:t!=t&&e!=e,r.isStr=x,r.isStrBool=It,r.isUpperCase=mr,r.isUrl=t=>Boolean(/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(t)),r.isUuid=t=>!t||!x(t)?!1:Boolean(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(t)),r.isValidDate=t=>!isNaN((t instanceof Date&&t||new Date(t)).getTime()),r.isValidUrl=t=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-/]))?/.test(t),r.joinRegex=(...t)=>{let[e,o]=(a=>{if(m(a[0]))return[a[0],a[1]];let p=a[a.length-1],h=x(p)?p:void 0;return[h?a.splice(0,a.length-1):a,h]})(t),c=e.reduce((a,p)=>{let h=Wr(p);return h?a===""?h:`${a}|${h}`:a},"");return new RegExp(`(${c})`,o)},r.jsonEqual=(t,e)=>{try{return JSON.stringify(t)===JSON.stringify(e)}catch{return!1}},r.keyMap=(t,e)=>m(t)&&t.reduce((o,c)=>{if(!x(c))return o;let a=e&&c.toUpperCase()||c;return o[a]=a,o},{})||{},r.limbo=t=>t&&d(t.then)?t.then(e=>[null,e]).catch(e=>[e,void 0]):[new Error("A promise or thenable is required as the first argument!"),null],r.logData=vr,r.mapColl=(t,e)=>d(e)&&F(t)?Object.keys(t).map(o=>e(o,t[o],t)):m(t)?[]:{},r.mapEntries=Dr,r.mapFind=(t,e,o=tt)=>{let[c]=i({coll:t,mapper:e,test:o},{coll:F,$default:d});if(c)return O(t)?((a,p,h)=>{let g=0;for(let R in a){if(!a.hasOwnProperty(R))continue;let $=p(a[R],R,g);if(h($,R,g))return $;g++}return null})(t,e,o):((a,p,h)=>{for(let g=0;g<a.length;g++){let R=p(a[g],g,g);if(h(R,g,g))return R}return null})(t,e,o)},r.mapKeys=(t,e)=>O(t)&&d(e)?Dr(t,(o,c)=>[e(o),c]):t,r.mapObj=(t,e)=>O(t)&&d(e)&&Object.entries(t).map(([o,c])=>e(o,c))||t,r.mapString=lr,r.match=Sr,r.memorize=(t,e,o=1)=>{if(!d(t)||e&&!d(e))return console.error("Error: Expected a function",t,e);let c=function(){let a=c.cache,p=e?e.apply(this,arguments):arguments[0];if(br(a,p))return a[p];let h=t.apply(this,arguments);return E(o)&&Object.keys(a).length<o?a[p]=h:c.cache={[p]:h},h};return c.cache={},c.destroy=()=>{e=void 0,c.cache=void 0,c.destroy=void 0,c=void 0},c},r.mod=(t,e)=>(t%e+e)%e,r.noOp=()=>{},r.noOpObj=at,r.noPropArr=Qe,r.noPropObj=D,r.nth=t=>{if(!E(t)&&(!(t=et(t))||(t=vt(t),q(t))))return"";let e=t%100;if(e>=10&&e<=20)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},r.objToQuery=t=>{let e;return ot(t,(o,c,a)=>{if(!c)return a;let p=x(c)||E(c)||lt(c)?c:F(c)?m(c)?c.join(","):JSON.stringify(c):null;return p&&(a=e?`${a}&${encodeURIComponent(o)}=${encodeURIComponent(p)}`:`?${encodeURIComponent(o)}=${encodeURIComponent(p)}`,e=!0),a},"")},r.omitKeys=(t={},e=[])=>O(t)&&ot(t,(o,c,a)=>(e.indexOf(o)===-1&&(a[o]=t[o]),a),{})||{},r.omitRange=(t,e,o)=>{let[c]=i({arr:t,startIndex:e,count:o},{arr:m,$default:Ft});if(!c)return t;let a=[...t];return a.splice(e,o),a},r.parseErrorMessage=t=>x(t)&&!Tr(t)?t:O(t)?t.message:null,r.parseJSON=(t,e=!0)=>{try{return JSON.parse(t)}catch(o){return e&&console.error(o.message),null}},r.pickKeys=(t={},e=[])=>O(t)&&e.reduce((o,c)=>(c in t&&(o[c]=t[c]),o),{})||{},r.pipeline=St,r.plural=t=>t&&t.length&&t[t.length-1]!=="s"?t+"s":t,r.promisify=Ht,r.promisifyAll=t=>{if(!O(t))return t;kr(t);let e=Object.getPrototypeOf(t);return e&&Object.getPrototypeOf(e)!==null&&kr(e),t},r.queryToObj=Hr,r.randomArr=(t,e)=>{if(!m(t))return t;let o=e||1,c=[];for(let a=0;a<o;a++)c.push(t[Math.floor(Math.random()*t.length)]);return e?c:c[0]},r.randomizeArr=t=>!m(t)&&t||t.sort(()=>.5-Math.random()),r.reduceColl=(t,e,o)=>d(e)&&F(t)?Object.keys(t).reduce((c,a)=>e(a,t[a],t,c),o):m(t)?[]:{},r.reduceObj=ot,r.removeDot=hr,r.repeat=(t,e,o=!1)=>{if(!e||e<=0)return[];if(!E(e))return console.error("Times argument must be a number"),[];let c=[];for(let a=0;a<e;a++){let p=d(t)?t():o?M(t):t;c.push(p)}return c},r.resetLogs=()=>{Wt=void 0,nt="log",z="type"},r.reverseStr=Pt,r.runSeq=async(t=[],e={})=>{let[o]=i({asyncFns:t},{asyncFns:m});if(!o)return[];let{cloneResults:c=!1,returnOriginal:a=!0}=e,p=[];for(let h of t){let g=d(h)?await h(p.length,c?M(p):p):a?h:void 0;p.push(g)}return p},r.sanitize=gr,r.sanitizeCopy=t=>JSON.parse(gr(JSON.stringify(t))),r.set=kt,r.setLogs=(t,e,o)=>{Wt=t,nt=e||nt||"log",z=o||z||"type"},r.shallowEqual=(t,e,o)=>{if(o&&(m(o)||x(o))&&(t=rt(t,o),e=rt(e,o)),t===e)return!0;if(!(t&&F(t)&&e&&F(e))||Object.keys(t).length!==Object.keys(e).length)return!1;for(let c in t)if(t[c]!==e[c])return!1;return!0},r.singular=t=>t&&t.length&&t[t.length-1]==="s"?t.slice(0,t.length-1):t,r.snakeCase=t=>fr(t,"_").toLowerCase(),r.softFalsy=_r,r.someEntry=(t,e)=>t?O(t)?d(e)?St(t,Object.entries,o=>o.some(([c,a])=>e(c,a))):(console.error(`Argument 'predicate' passed into someEntry must a function. Found: ${e}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`someEntry expects argument obj [${t}] to be defined.`),!1),r.spaceJoin=(t,e)=>(e=m(e)?e:[e]).reduce((o,c)=>x(c)?`${o?o+" ":""}${c}`.trim():o,x(t)?t:""),r.splitByKeys=(t={},e)=>{if(!e)return[{},{...t}];let o=[{},{}],c=A(e);return O(t)?ot(t,(a,p,h)=>(tt(c.find(g=>tt(g)&&B(g)===a))?h[0][a]=t[a]:h[1][a]=t[a],h),o):o},r.strToType=Cr,r.styleCase=t=>{if(!x(t))return t;let e=dr(t);return`${e[0].toLowerCase()}${e.slice(1)}`},r.template=xr,r.throttle=(t,e=100)=>{let o=!1;return function(...c){if(!o)return o=!0,t.apply(this,c),setTimeout(()=>{o=!1},e)}},r.throttleLast=(t,e,o=100)=>{let c;return function(...a){c&&clearTimeout(c),c=setTimeout(()=>{t.apply(this,a),clearTimeout(c)},o),typeof e=="function"&&e()}},r.timedRun=async(t,...e)=>{let[o]=i({fn:t},{fn:d});if(!o)return[void 0,-1];let c=new Date;return[await t(...e),new Date-c]},r.toBool=Ct,r.toFloat=t=>t&&!q(t)&&parseFloat(E(t)&&t||et(t))||0,r.toInt=t=>t&&!q(t)&&parseInt(E(t)&&t||et(t))||0,r.toNum=vt,r.toObj=(t,e,o)=>m(t)?Object.keys(t).reduce((c,a)=>(c[a]=t[a],c),{}):x(str)?(e=e||"=",o=o||"&",str.split(o).reduce((c,a)=>{let p=a.split(e);return c[p[0].trim()]=Cr(p[1].trim()),c},{})):{},r.toStr=B,r.trainCase=t=>x(t)&&t.split(/(?=[A-Z])|[\s_-]/gm).join("-").toLowerCase()||t,r.trimStringFields=t=>Object.entries(t).reduce((e,[o,c])=>(e[o]=x(c)?c.trim():c,e),t),r.typeOf=wr,r.uniqArr=Fr,r.uniqArrByReference=jr,r.unset=(t,e)=>Lt(t,e,"unset"),r.uuid=$r,r.validFilename=t=>t?!(/[<>:"/\\|?*\u0000-\u001F]/g.test(t)||/^(con|prn|aux|nul|com\d|lpt\d)$/i.test(t)||/^\.\.?$/.test(t)):!1,r.validate=i,r.wait=t=>new Promise(e=>setTimeout(()=>e(!0),t)),r.wordCaps=t=>x(t)?Tt(t).split(" ").map(e=>e&&ut(e)||"").join(" "):t})});var So={};fn(So,{PKInstance:()=>wo,Parkin:()=>wt});module.exports=hn(So);var zr=T(w()),L=(0,zr.deepFreeze)({ALIAS_REF:"$$",ALIAS_WORLD_KEY:"$alias",ALIAS_REF_AT_RUNTIME:"$$:",REGEX_VARIANT:"regex",WORLD_REF:"$",WORLD_KEY:"$world",WORLD_AT_RUNTIME:"$:",EXPRESSION_VARIANT:"expression",STEP_TYPES:["given","when","then","and","but"],HOOK_TYPES:["beforeAll","afterAll","beforeEach","afterEach"],FEATURE_META:["feature","perspective","desire","reason","comments"],LOG_JEST_SPEC_ENV:"PARKIN_LOG_JEST_SPEC",SPEC_RESULT_LOG:"------- PARKIN SPEC RESULT LOG -------"});var Ee=T(w());var xt=T(w());var X=(r,n,s)=>{let i=r.match(n)[s];return i?i.trim():" "},P=(r,n)=>{let s=r&&r.trim()&&r.trim().toLowerCase().replace(/[\s\/\\\(\)\+=_&%\$#@!\*~`\|\?:;"'<>,.{}]/g,"-");return s?`${s}-${r.length}`:`${n}-${n.length}`},Gr=r=>{let n=r.match.toString();return n[0]==="/"&&(n=n.substr(1)),n[0]==="^"&&(n=n.substr(1)),n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1)),n.charAt(n.length-1)==="$"&&(n=n.slice(0,-1)),n.replace(/\(\?:([^\|]+)+\|+([^\)]+)?\)/,"$1")},Jr=(r,n)=>n.reduce((s,i)=>!s||i.content===s.content?!1:(i.uuid===s.uuid&&(s.uuid=`${s.uuid}-${s.content.length}`),s),{...r}),ft=r=>r.trim().replace(/^("|')/,"").replace(/("|')$/,"");var _=T(w());var Kr=T(w()),st=/\w*\([^)]*?\)/,ht=/\s*\S*\/\S*\s*/,ct=/\s*{(.*?)}\s*/,Vr=(0,Kr.joinRegex)(ct,st,"g"),qt=/(.*)/,dt=/{|}/g,Yr=/"[^"]+"/,Qr=/'[^']+'/,Zr=/-?[0-9]+[.][0-9]+/,te=/-?[0-9]+/,re=/^["]?\$world\.\S+["]?/,ee=/^\$world\./,ne=/(\$:world|\$world)+\.[^"'\s]*/gm,oe=/^["]?\$\$\S+["]?/,se=/^\$\$/,ce=/(\$\$:\w+|\$\$\w+)[^"'\s]*/gm;var ie=r=>()=>{throw new Error(`Test method ${r} does not exist on the global scope.
Please ensure ${r} exists before calling the run method!
`)},ae=()=>{throw new Error("Runner class constructor requires an instance of the Steps class")};var ue=()=>{throw new Error("Runner class requires feature text when calling the run method")},le=r=>{throw new ReferenceError(r)},pe=()=>{throw new Error(`Cannot register param type "${name}". It already exists!`)},me=r=>{throw new Error("Assemble feature requires an object matching the feature model spec!",r)},fe=(r,n)=>{throw new Error(`Can not replace ${r} with value from $world, it does not exist on the world object`,n,r)},he=(r,n)=>{throw new Error([`Expected client hook type to be one of ', ${r}.`,`Found: ${n}`].join(`
`))},de=(r,n)=>{throw console.error(`Error replacing $world value in feature text. Current match was ${n}`),r},ge=(r,n)=>{throw console.error(`Error replacing $$alias ( $world.$alias ) in feature text. Current match was ${n}`),r};var{WORLD_KEY:dn,ALIAS_WORLD_KEY:gn,ALIAS_REF:xn}=L,J=(r,n)=>(s,i)=>{let u=s.match(re),l=s.match(oe);if(!(0,_.isObj)(i)||!u&&!l)return zt(r(s),n);let f=u?(0,_.get)(i,ft(s).replace(`${dn}.`,"")):(0,_.get)(i,ft(s).replace(`${xn}`,`${gn}.`));return(0,_.exists)(f)?zt(f,n):u?fe(s,i):zt(r(s),n)},zt=(r,n)=>typeof r===n?r:null,k={name:"",regex:"",type:"string",useForSnippets:!0,preferForRegexpMatch:!1,transformer:J(r=>r,"string")},U={any:{...k,name:"any",regex:qt},word:{...k,name:"word",regex:qt,transformer:J(r=>(0,_.isQuoted)(r)?void 0:(0,_.toStr)(r),k.type)},float:{...k,name:"float",type:"number",regex:Zr,transformer:J(r=>{let n=parseFloat(r);return(0,_.equalsNaN)(n)?void 0:n},"number")},int:{...k,name:"int",type:"number",regex:te,transformer:J(r=>{let n=parseInt(r);return(0,_.equalsNaN)(n)||r.includes(".")?void 0:n},"number")},string:{...k,name:"string",regex:(0,_.joinRegex)(Yr,Qr),transformer:J(r=>(0,_.isQuoted)(r)?ft(r):void 0,k.type)}},K=()=>U,gt=(r=_.noOpObj,n=r.name)=>U[n]?pe(n):(U[n]={...k,...r},U[n].transformer=J(U[n].transformer,U[n].type),U),xe=(r,n,s)=>r.map((i,u)=>{let l=n[u]||U.any;return(0,_.checkCall)(l.transformer,i,s)}).filter(_.exists);var V=(r,n)=>{let s=n.match(new RegExp(r.match));return s?{definition:r,match:s.slice(1,s.length).filter(Boolean)}:xt.noOpObj},Jt=r=>{let n=r.split(/(\(|\))/),[s,,i,,u]=n;return s===""&&u===""?r+"?":s===""?`(${i}|${i}${u})`:u===""?`(${s}|${s}${i})`:`(${s}${u}|${s}${i}${u})`},On=r=>{let n=r.input;return(0,xt.getWordEndingAt)(n,r.index)+r[0]},yn=r=>{let n=On(r);return Jt(n)},Kt=r=>{let n=K();return(n[r]||n.any).regex.source},Vt=r=>`(${r.trim().replace(/\//g,"|")})`,Rn=(r,n)=>{let[s,i]=n;switch(r){case"parameter":return new RegExp(Kt(i));case"optional":return new RegExp(yn(n));case"alternate":return new RegExp(Vt(s));default:return null}},Gt=(r,n="other")=>{let s=r[0],i=s.trimStart(),u=s.length-i.length;return{text:s.trim(),input:r.input,index:r.index+u,regex:Rn(n,r),type:n,...n==="parameter"&&{paramType:s.trim().replace(dt,"")}}},Ot=r=>{let n=[...r.matchAll(new RegExp(ct,"gi"))].map(l=>Gt(l,"parameter")),s=[...r.matchAll(new RegExp(st,"gi"))].map(l=>Gt(l,"optional")),i=[...r.matchAll(new RegExp(ht,"gi"))].map(l=>Gt(l,"alternate"));return[...n,...s,...i].sort((l,f)=>l.index-f.index)};var I=T(w()),Yt=Boolean(typeof window<"u"),Oe=Boolean(typeof global<"u"),_n=Boolean(typeof module=="object"),An=Boolean(typeof require=="function"),Qt=Boolean(Oe&&typeof global.jasmine<"u"),ye=()=>Qt?(0,I.checkCall)(()=>global.jasmine):{getEnv:()=>I.noOpObj},Re=()=>_n?(0,I.checkCall)(()=>module):{exports:{}},_e=()=>An?(0,I.checkCall)(()=>require):I.noOp,Ae=()=>{try{return Yt?(0,I.checkCall)(()=>window):Oe?(0,I.checkCall)(()=>global):I.noOpObj}catch{return I.noOpObj}};var Y=T(w());var bn=r=>Yt?r.replace(/[|\\[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"):r.replace(/[|\\[\]^$+*?.]/g,"\\$&"),be=(r,n,s)=>{if(!n.test(r))return r;let i=r;return r.replace(n,(...u)=>{let l=u[0].trim(),[f,...m]=i.split(l),y=(0,Y.isFunc)(s)?s(...u):s;i=`${f}${y}${m.join(l)}`}),i},En=r=>{let n=K(),s=[];return{regex:be(r,Vr,(u,...l)=>{let f=u.trim().replace(dt,""),m=u.match(ct),y=u.match(st);return m&&s.push(n[f]||n.any),m?Kt(f):y?Jt(u):u}),transformers:s}},$n=r=>{let n=[];return{regex:be(r,new RegExp(ht,"g"),Vt),altIndexes:n}},wn=r=>{let n=r;return r.startsWith("^")||(n="^"+n),r.endsWith("$")||(n+="$"),{regex:n}},Zt=(r,n,s)=>{let i=Ot(n),u=i.filter(f=>f.type==="parameter").length,l=i.reduce((f,m)=>{let{params:y,textIndex:b,wordMatchIndex:O}=f,A=r.substring(b),d=m.paramType==="word",v=A.match(m.regex),at={0:s[O],index:A.indexOf(s[O])},D=d?at:v;return D?(m.type==="parameter"&&D&&y.push(D[0]),{params:y,textIndex:b+(D&&D.index+D[0].length),wordMatchIndex:O+(d&&1)}):f},{params:[],textIndex:0,wordMatchIndex:0});return u===l.params.length?l.params:null},tr=(r,n)=>{let s=bn(r.match),{regex:i}=$n(s),{transformers:u,regex:l}=En(i),{regex:f}=wn(l);return{found:V({...r,match:f},n),escaped:s,regexAlts:i,transformers:u,regexAnchors:f,regexConverted:l}},yt=(r,n,s)=>{if(r.match===n)return{definition:r,match:[]};let{found:i,transformers:u}=tr(r,n);if(!i||!i.definition||!i.match)return Y.noOpObj;let l=Zt(n,r.match,i.match);if(!l)return Y.noOpObj;let f=xe(l,u,s);return f.length!==l.length?Y.noOpObj:{definition:r,match:f}};var{REGEX_VARIANT:Sn}=L,Rt=class{find=rr;regex=V;parts=Ot;types=K;extract=Zt;expression=yt;expressionFind=tr;register=gt},rr=(r,n,s)=>r.reduce((i,u)=>i.match||!u.match?i:u.variant!==Sn?yt(u,n,s):V(u,n,s),Ee.noOpObj);var N=T(w());var{REGEX_VARIANT:$e,EXPRESSION_VARIANT:Tn,STEP_TYPES:jn}=L,Fn=r=>{let n=r.variant===$e?r.match.toString():`"${r.match}"`;return`${(0,N.capitalize)(r.type)}(${n}, ${r.method.toString()})`},Ln=function(r,n,s,i,u=N.noOpObj){let l={type:n,meta:u,match:s,method:i,tokens:[],variant:s.toString().indexOf("/")===0?$e:Tn};l.name=Gr(l),l.uuid=P(`${n}-${l.name}`),l.content=Fn(l);let f=this.list(),m=Jr(l,f);return m&&this[r].push(m),m},Pn=(r,n,s)=>(...i)=>{let u=r[n](...i);return s[n].push(u),u},In=function(r){let n=this.types.map(i=>(0,N.capitalize)(i)),s=n.reduce((i,u)=>(i[u]=[],i),{});return(0,N.eitherArr)(r,[r]).map(i=>{Function(`return (global, require, module, ${n.join(",")}) => {
          return (function(global) { ${i} }).call(global, global)
        }`)()(Ae(),_e(),Re(),...n.map(u=>Pn(this,u,s)))}),s},Cn=r=>r.types.reduce((n,s)=>n.concat(r[`_${s}`]),[]),_t=class{types=jn;constructor(n){this._world=n||{};let s=this;this.types.map(i=>{let u=`_${i}`;this[u]=[],this[(0,N.capitalize)(i)]=(l,f,m)=>s.register(u,i,l,f,m)})}list=()=>Cn(this);typeList=()=>this.types.reduce((n,s)=>{let i=`_${s}`;return n[i]=[...this[i]],n},{});match=n=>{let s=this.list(),i=rr(s,n,this._world);return!i.match||!i.definition?!1:(i.match.push(this._world),i)};resolve=n=>{let s=this.match(n);return s?s.definition.method(...s.match):le(`Matching definition could not be found for step: "${n}"`)};register=(...n)=>(0,N.isStr)(n[0])?Ln.apply(this,n):In.apply(this,n);clear=()=>{this.types.map(n=>this[`_${n}`]=[])}};var Q=T(w());var{HOOK_TYPES:we}=L,At=class{types=we;instance=void 0;constructor(n,s){this._registeredHooks={},this.instance=s,this.types.map(i=>{this[i]=u=>{(0,Q.isFunc)(u)&&(this._registeredHooks[i]=this._registeredHooks[i]||[],this._registeredHooks[i].push(u))}})}getRegistered=n=>{let s=this.types.includes(n)?this._registeredHooks[n]||Q.noPropArr:he(we.join(", "),n);return s.length?async()=>s.reduce(async(i,u)=>(await i,await u(this.instance)),Promise.resolve()):Q.noOp}};var vn=/^\s*Given (.*)$/,Mn=/^\s*When(.*)$/,Xn=/^\s*Then (.*)$/,Nn=/^\s*And (.*)$/,Dn=/^\s*But (.*)$/,kn=/^\s*\* (.*)$/,Un=/^\s*?"""\s*?/;var Wn=/^\s*?```\s*?/;var Se=/^\s*?\|/;var Hn=[{regex:vn,type:"given"},{regex:Mn,type:"when"},{regex:Xn,type:"then"},{regex:Nn,type:"and"},{regex:Dn,type:"but"},{regex:kn,type:"and"}],Bn=(r,n,s,i)=>{if(!Se.test(s))return r;let u;return r.table={index:i,content:n.reduce((l,f)=>(u=u||!Se.test(f),!u&&l.push(f.split("|").reduce((m,y)=>{let b=y.trim();return b&&m.push(b),m},[])),l),[])},r},qn=(r,n,s,i)=>{let u=Un.test(s)&&'"""';if(u=u||Wn.test(s)&&"```",!u)return r;let l=s.split(u)[0],f=new Array(l.length).fill("\\s").join(""),m=new RegExp(`^${f}`);return r.doc={index:i,whiteSpace:l,type:u==='"""'?"quote":"tick",content:n.split(u).slice(1).shift().trim().split(`
`).reduce((y,b)=>(y.push(b.replace(m,"").trim()),y),[]).join(`
`)},r},zn=(r,n,s,i)=>{let u={type:r,index:i,step:n,uuid:P(`${r}-${n}`)},l=i+1,f=s[l],m=s.slice(l);return u=Bn(u,m,f,l),u=qn(u,m.join(`
`),f,l),u},Te=(r,n,s,i)=>Hn.reduce((u,l)=>{if(u)return u;let f=l.regex.test(s);return f&&r.steps.push(zn(l.type,X(s,l.regex,1),n,i)),f},!1);var ve=T(w());var Z=T(w());var{ALIAS_REF:Gn,WORLD_REF:Jn,ALIAS_WORLD_KEY:Kn,WORLD_AT_RUNTIME:je,ALIAS_REF_AT_RUNTIME:Fe}=L,Le=(r,n,s)=>{let i=(0,Z.get)(n,s);return(0,Z.isFunc)(i)?i(n,s):(0,Z.exists)(i)?i:r},Vn=(r,n)=>{let s;try{return r.replace(ce,i=>{s=i;let u=i.trim();return u.indexOf(Fe)===0?u.replace(Fe,`$${Gn}`):Le(i,n,u.replace(se,`${Kn}.`))})}catch(i){ge(i,s)}},Yn=(r,n)=>{let s;try{return r.replace(ne,i=>{s=i;let u=i.trim();return u.indexOf(je)===0?u.replace(je,Jn):Le(i,n,u.replace(ee,""))})}catch(i){de(i,s)}},Pe=(r,n)=>Yn(Vn(r,n),n);var Qn=/\r?\n/g,Ie=/^\s*@(.*)$/,Ce=/^\s*#(.*)$/,er=/^\s*Feature:(.*)$/,nr=/^\s*Rule:(.*)$/,Zn=/^\s*As (.*)$/,to=/^\s*I want (.*)$/,ro=/^\s*So that (.*)$/,eo=/^\s*In order (.*)$/,or=/^\s*Scenario:(.*)$/,sr=/^\s*Example:(.*)$/,Me=/^\s*Background:(.*)$/,no=[{regex:Zn,key:"perspective"},{regex:to,key:"desire"},{regex:ro,key:"reason"},{regex:eo,key:"reason"}],Xe=(r,n,s)=>({index:s,content:n,feature:r,tags:[],rules:[],reason:[],comments:[],scenarios:[],...r&&{uuid:P(r,s)}}),Ne=(r,n)=>({index:n,rule:r,tags:[],scenarios:[],...r&&{uuid:P(r,n)}}),De=(r,n)=>({index:n,scenario:r,tags:[],steps:[],...r&&{uuid:P(r,n)}}),ke=(r,n)=>({index:n,steps:[],background:r,...r&&{uuid:P(r,n)}}),oo=(r,n,s)=>{n&&r.reason.push({content:n,index:s})},so=(r,n,s)=>{let i=!1;return no.reduce((u,l)=>{if(u)return u;let f=l.regex.test(n);return!i&&f&&(i=!0),f&&(l.key==="reason"?oo(r,X(n,l.regex,0),s):r[l.key]={content:X(n,l.regex,0),index:s})},!1),i},co=(r,n,s,i)=>{if(!Ie.test(s))return!1;let u=r.background?n:r,l=X(s,Ie,0);return u.tags=(u.tags||[]).concat(l.split(" ")),!0},io=(r,n,s)=>{if(!Ce.test(n))return!1;let i=n.match(Ce)[0];return r.comments.push({content:i,index:s}),!0},ao=(r,n,s,i,u)=>{if(!er.test(s))return n;let l=X(s,er,1);if(!n.feature)return n.feature=l,n.index||(n.index=u),n.uuid||(n.uuid=P(n.feature,u)),!r.includes(n)&&r.push(n),n;let f=Xe(l,i,u);return r.push(f),f},uo=(r,n,s,i)=>{if(!nr.test(s))return n;let u=X(s,nr,1);return n.rule?n=Ne(u,i):n.rule=u,!n.index&&(n.index=i),!n.uuid&&(n.uuid=P(n.rule,i)),!r.rules.includes(n)&&r.rules.push(n),n},lo=(r,n,s,i,u)=>{let l=or.test(i);if(!l&&!sr.test(i))return s;let f=l&&X(i,or,1);f=f||X(i,sr,1),s.scenario?s=De(f,u):s.scenario=f,!s.index&&(s.index=u),!s.uuid&&(s.uuid=P(s.scenario,u));let m=n.uuid?n:r;return!m.scenarios.includes(s)&&m.scenarios.push(s),s},po=(r,n,s,i,u)=>{if(!Me.test(i))return s;let l=n.uuid?n:r,f=`${l.uuid}-background`;return s.background?s=ke(f,u):s.background=f||"",!s.index&&(s.index=u),!s.uuid&&(s.uuid=P(s.background,u)),l.background=s,s},mo=(r,n,s,i,u,l)=>or.test(l)||sr.test(l)?i:er.test(l)?n:nr.test(l)?s:Me.test(l)?u:r,bt=function(r,n){n=n||this&&this.world||ve.noOpObj;let s=[],u=Pe((r||"").toString(),n).split(Qn),l=Ne(!1),f=De(!1),m=ke(!1),y=Xe(!1,r),b=y;return u.reduce((O,A,d)=>(y=ao(O,y,A,r,d),io(y,A,d)||so(y,A,d)||(l=uo(y,l,A,d),f=lo(y,l,f,A,d),m=po(y,l,m,A,d),!b.feature&&Te(b,u,A,d))||(b=mo(b,y,l,f,m,A),co(b,y,A,d)),O),s)};var Ue=function(r){return this.steps.register([r])};var it=T(w());var{SPEC_RESULT_LOG:We,LOG_JEST_SPEC_ENV:fo}=L,Et=r=>{let n=new Date().getTime();(0,it.get)(process,`env.${fo}`)&&process.stdout.write([We,JSON.stringify({...r,timestamp:n}),We].join(""))},He=r=>{let n=(0,it.get)(r,"description"),s=n?n.startsWith("Scenario >")?"Scenario":n.startsWith("Background >")?"Background":n.startsWith("Rule >")?"Rule":"Feature":"Feature";return{type:s.toLowerCase(),...s!=="Feature"&&{description:n.replace(`${s} >`,`${s}:`)}}},W=(r,n)=>n?it.noOp:global[r]||ie(r),ho=r=>{let n=[],s=r.describe;return r.describe=(...i)=>{let u=s.apply(null,i);return n.push(u),u},{suiteStarted:i=>{Et({...i,...He(i),action:"start"})},specStarted:i=>{Et({...i,type:"step",action:"start"})},specDone:i=>{if(Et({...i,type:"step",action:"end"}),i.status!=="failed")return;let u=n.find(l=>l.children.find(f=>f.result===i));u&&u.children.map(l=>l.disable())},suiteDone:i=>{Et({...i,...He(i),action:"end"})}}},Be=r=>{if(!Qt)return;let n=ye().getEnv();n&&n.describe&&n.addReporter(ho(n,r))};var j=T(w()),cr=(r,n)=>`${(0,j.capitalize)(n)} > ${r}`,Ge=(r,n)=>(0,j.isStr)(r)?bt(r,n):(0,j.isObj)(r)?[r]:(0,j.isArr)(r)?r.reduce((s,i)=>s.concat(Ge(i,n)),[]):ue(),go=async(r,n,s)=>{W("test",s)(`${(0,j.capitalize)(n.type)} ${n.step}`,async()=>await r.resolve(n.step))},qe=(r,n,s,i)=>{let u=W("describe",i),l=[];return u(n,()=>{let f=r.steps.map(m=>go(s,m,i));Promise.all(f)}),l},Je=(r,n,s,i)=>(s&&qe(s,cr(n.scenario,"Background"),r,i),qe(n,cr(n.scenario,"Scenario"),r,i)),xo=(r,n,s,i)=>{let u=[];return describe(`Rule > ${n.rule}`,()=>{u=n.scenarios.map(l=>Je(r,l,s||n.background,i)),Promise.all(u)}),u},Oo=r=>(0,j.isStr)(r)&&r.match(/[@]\w*/g),ze=(r="",n=[],s={})=>{let{name:i,tags:u}=s,l=(0,j.isStr)(u)?Oo(u):(0,j.eitherArr)(u,[]),f=!i||r.includes(i),m=!l.length||l.every(y=>n.includes(y));return f&&m},yo=(r,n={})=>r.reduce((s,i)=>{if(ze(i.feature,i.tags,n))return s.push(i),s;let l=i.scenarios.filter(f=>ze(f.scenario,[...f.tags||[],...i.tags||[]],n));return l.length&&s.push({...i,scenarios:l}),s},[]),$t=class{constructor(n,s,i){!n&&ae(),!s&&throwMissingHooks(),this.steps=n,this.hooks=s,this._world=i}getFeatures=(n,s)=>{let i=Ge(n,this._world);return yo(i,s)};run=async(n,s=j.noOpObj)=>{let i=this.run.PARKIN_TEST_MODE;Be(i);let u=W("describe",i),l=W("beforeAll",i),f=W("afterAll",i),m=W("beforeEach",i),y=W("afterEach",i),b=this.getFeatures(n,s);if(!b.length)return!1;let O=await b.map(async A=>{let d=[];return l(this.hooks.getRegistered("beforeAll")),f(this.hooks.getRegistered("afterAll")),m(this.hooks.getRegistered("beforeEach")),y(this.hooks.getRegistered("afterEach")),u(cr(A.feature,"Feature"),()=>{d=A.rules.map(v=>xo(this.steps,v,A.background,i)),d.concat(A.scenarios.map(v=>Je(this.steps,v,A.background,i))),Promise.all(d)}),d});return await Promise.all(O),!0}};var S=T(w()),{FEATURE_META:Ro}=L,H=(r,n,s)=>{(0,S.exists)(s)?(0,S.exists)(r[s])?r.splice(s,0,n):r[s]=n:r.push(n)},Ke=(r,n,s="")=>{(0,S.isArr)(n)&&n.length&&H(r,`${s}${n.join(" ")}`)},_o=(r,n)=>{Ro.map(s=>{switch(s){case"feature":H(r,`Feature: ${n[s]}`,n.index);break;case"comments":(0,S.isArr)(n[s])&&n[s].map(i=>H(r,i.content,i.index));break;case"reason":(0,S.isArr)(n[s])&&n[s].map(i=>H(r,`  ${i.content}`,i.index));break;case"desire":case"perspective":n[s]&&H(r,`  ${n[s].content}`,n[s].index);break}})},Ao=(r,n)=>{(0,S.isArr)(n.steps)&&n.steps.length&&n.steps.map(s=>H(r,`    ${(0,S.capitalize)(s.type)} ${s.step}`,s.index))},bo=(r,n)=>{n.scenarios&&n.scenarios.map(s=>{Ke(r,s.tags,"  "),H(r,`  Scenario: ${s.scenario}`,s.index),Ao(r,s)})},Eo=(r,n,s)=>{let i=r[s+1],u=r[s-1],l=(0,S.exists)(i)?i:u;if(!l)return`${n}
`;let f=n.split("#").pop();return`${Array(l.length-l.trimStart().length).join(" ")} # ${f}
`},$o=r=>Array.from(r,(n,s)=>(0,S.exists)(n)?n.startsWith("#")?Eo(r,n,s):`${n}
`:`
`).join("").trim(),Ve=r=>(0,S.eitherArr)(r,[r]).map(n=>{let s=[];return!(0,S.isObj)(n)&&me(n),Ke(s,n.tags),_o(s,n),bo(s,n),$o(s)});var Ye={feature:Ve};var C=T(w()),wt=class{constructor(n,s){(0,C.isObj)(n)&&this.init(n,s)}#t=!1;init=(n=C.noOpObj,s)=>{if(this.#t)return console.warn("This instance of parkin has already been initialized!");(0,C.isObj)(n.$alias)||(n.$alias={}),this.#t=!0,this.world=n,this.steps=new _t(this.world),this.hooks=new At(this.world),this.runner=new $t(this.steps,this.hooks,this.world),this.run=this.runner.run,this.parse={feature:bt.bind(this),definition:Ue.bind(this)},this.assemble=Ye,this.paramTypes={register:gt},this.matcher=new Rt,(0,C.isObj)(s)&&this.registerSteps(s),this.steps.types.map(i=>{this[(0,C.capitalize)(i)]=(u,l,f)=>this.steps.register(`_${i}`,i,u,l,f)})};registerSteps=n=>{Object.entries(n).map((s,i)=>Object.entries(i).map((u,l)=>this.steps[(0,C.capitalize)(s)](u,...(0,C.eitherArr)(l,[l]))))}},wo=new wt;0&&(module.exports={PKInstance,Parkin});
//# sourceMappingURL=index.js.map
