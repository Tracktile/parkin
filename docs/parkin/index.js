var Dn=Object.create;var gt=Object.defineProperty;var In=Object.getOwnPropertyDescriptor;var vn=Object.getOwnPropertyNames;var Xn=Object.getPrototypeOf,Nn=Object.prototype.hasOwnProperty;var Wn=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),Bn=(e,n)=>{for(var o in n)gt(e,o,{get:n[o],enumerable:!0})},ir=(e,n,o,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of vn(n))!Nn.call(e,c)&&c!==o&&gt(e,c,{get:()=>n[c],enumerable:!(i=In(n,c))||i.enumerable});return e};var b=(e,n,o)=>(o=e!=null?Dn(Xn(e)):{},ir(n||!e||!e.__esModule?gt(o,"default",{value:e,enumerable:!0}):o,e)),Un=e=>ir(gt({},"__esModule",{value:!0}),e);var R=Wn((dt,ar)=>{(function(e,n){typeof dt=="object"&&typeof ar<"u"?n(dt):typeof define=="function"&&define.amd?define(["exports"],n):n((e=typeof globalThis<"u"?globalThis:e||self).jsutils={})})(dt,function(e){"use strict";let n={SHOULD_LOG:!0,SHOULD_THROW:!1,LOG_PREFIX:null},o=()=>!0,i=(t,r={},s={})=>{let{logs:a=n.SHOULD_LOG,throws:p=n.SHOULD_THROW,prefix:l=n.LOG_PREFIX}=s,f=Object.entries(t).map(([$,V])=>c($,V,r[$]||r.$default||o)),{success:h,cases:S}=f.reduce(($,V)=>u($,V,{logs:a,throws:p,prefix:l}),{success:!0,cases:{}});return[h,S]};i.setOptions=({logs:t,throws:r,prefix:s})=>{t!==void 0&&(n.SHOULD_LOG=t),r!==void 0&&(n.SHOULD_THROW=r),s!==void 0&&(n.LOG_PREFIX=s)},i.resetOptions=()=>{n.SHOULD_LOG=!0,n.SHOULD_THROW=!1,n.LOG_PREFIX=null};let c=(t,r,s)=>{let a=s(r),p=!s.name||s.name===t||s.name==="$default"?s.toString():s.name;return{success:a,key:t,value:r,validator:s,reason:a?null:[`Argument "${t}" with value `,r,` failed validator: ${p}.`]}},u=(t,r,{logs:s,throws:a,prefix:p})=>(!r.success&&g(r,s,a,p),{success:t.success&&r.success,cases:{...t.cases,[r.key]:r}}),g=(t,r,s,a)=>{let p=a?[a,...t.reason]:t.reason;if(s)throw new Error(p.join());r&&console.error(...p)},m=t=>Array.isArray(t),y=t=>{let r=new Map;for(let a=0;a<t.length;a++){var s;let p=t[a],l=(s=r.get(p))!==null&&s!==void 0?s:0;r.set(p,l+1)}return r},A=(t,r)=>{if(t.size!==r.size)return!1;for(let[s,a]of t)if(r.get(s)!==a)return!1;return!0},T=t=>typeof t=="object"&&!Array.isArray(t)&&t!==null,_=t=>m(t)?t:[t],d=t=>typeof t=="function",E=t=>(Object.freeze(t),Object.getOwnPropertyNames(t).map(r=>{t.hasOwnProperty(r)&&t[r]!==null&&(typeof t[r]=="object"||d(t[r]))&&!Object.isFrozen(t[r])&&E(t[r])}),t),z=Object.freeze({}),X=E({content:{}}),$n=E([]),ot=t=>t==t&&t!=null,be=(t,r,s)=>{for(let a=0;a<t.length;a++){let p=t[a];m(p)?be(p,r,s):s.exists&&!ot(p)||s.truthy&&!p||r.push(p)}return s.mutate?(Object.assign(t,r).splice(r.length),t):r},Oe=(t,r)=>be(t,[],T(r)?r:z),_e=(t,r)=>{if(m(r)){let[s,...a]=r;return s(t,...a)}return d(r)?r(t):(console.error("Pipeline expected either a function or an array (for function expressions). Found "+typeof r),t)},Xt=(t,...r)=>r.reduce((s,a)=>_e(s,a),t),x=t=>typeof t=="string",Ee=(t,r)=>{if(!x(t)||!d(r))return t;let s="";for(let a of t)s+=r(a);return s},we=t=>t===t.toLowerCase(),$e=t=>t===t.toUpperCase(),ke=(t,r,s=["-","_"," "])=>{if(!x(t))return t;let a=l=>s.some(f=>f===l),p="_";return Ee(t,l=>a(l)?(p=r,r):$e(l)&&we(p)&&!a(p)?(p=l,r+l):(p=l,l))},lt=(t,r=!0)=>{if(!x(t)||!t[0])return t;let s=r?t.slice(1).toLowerCase():t.slice(1);return`${t[0].toUpperCase()}${s}`},Pe=t=>{let r=t.indexOf(".")===0?t.slice(1):t;return r.indexOf(".")===r.length-1?r.slice(0,-1):r},Nt=t=>t&&Pe(t).replace(/[-_]/gm," ")||t,Fe=(t,r)=>t&&Nt(t).split(/[\s_-]/gm).reduce((s,a,p)=>a?s+=(p>0||r)&&lt(a)||a.toLowerCase():s,"")||t,G=t=>t==null?"":x(t)?t:JSON.stringify(t),kn=/[A-Z]/g,Pn=/^ms-/,Wt={},Fn=t=>"-"+t.toLowerCase(),J=t=>typeof t=="number"&&t!=t,w=t=>typeof t=="number"&&!J(t),Bt=t=>w(t)&&t>=0,Me=t=>x(t)&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")||t,M=t=>typeof t=="object"&&t!==null,Ut=(t,r,s,a)=>{let p=t;if(!M(t)||!t||!r)return s!=="set"&&a||void 0;let l=m(r)?Array.from(r):r.split("."),f=l.pop(),h,S;for(;h=l.shift();){let $=t[h];if(M($)||d($)?t=$:(s==="set"?t[h]={}:S=!0,t=t[h]),S)return a}return s==="get"?f in t?t[f]:a:s==="unset"?delete t[f]:(t[f]=a)&&p||p},st=(t,r,s)=>Ut(t,r,"get",s),Ce=(t,r,s="")=>{r=M(r)&&r||{};let a=Ce.regex||/\${(.*?)\}/g;return x(t)?t.replace(a,(p,l)=>{let f=(l||p.substr(2,p.length-3)).trim(),h=st(r,f,s);return d(h)?h(r,f,s):h}):console.error("template requires a string as the first argument")||t},Mn=['"',"'"],Ht=t=>{if(!x(t))return;let r="";for(let s of t)r=s+r;return r},je=(t,r,s)=>s.map(a=>t.indexOf(a,r)).sort().find(a=>a>=0),Le=(t,r,s=[" "])=>{let a=je(t,r,s);return t.substring(r,a===-1?t.length:a)},mt=t=>typeof t=="boolean",zt=t=>t==="false"||t==="true",De=t=>mt(t)?G(t):t&&t!=="false"&&t!=="0"?"true":"false",Ie=t=>Boolean(t||t===""||t===0),qt=t=>zt(t)?t==="true":De(t)==="true",it=t=>G(t).replace(/([^.\d])/gm,""),Gt=t=>w(t)?t:t&&!J(t)&&Number(it(t))||0,ve=t=>x(t)||w(t)||mt(t),Jt=(t,r)=>{let[s]=i({x:t,y:r},{$default:ve});return s?x(t)?t.localeCompare(r):t-r:null},Kt=t=>t,Xe=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),Vt=t=>{let r=function(...s){return t instanceof r||st(t.prototype,"constructor.name")?new t(...s):t.apply(t,s)};for(let s in t)t.hasOwnProperty(s)&&(r[s]=t[s]);return Object.defineProperty(r,"name",{value:t.name,configurable:!0}),r.toString=()=>t.toString(),r},I=(t,r=new WeakMap)=>{if(Object(t)!==t)return t;if(t instanceof Set)return new Set(t);if(r.has(t))return r.get(t);if(m(t))return t.map(a=>I(a));if(d(t))return Vt(t);let s=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t.constructor?null:Object.create(null);return s===null?Ne(t):(r.set(t,s),t instanceof Map?Array.from(t,([a,p])=>s.set(a,I(p,r))):Object.assign(s,...Object.keys(t).map(a=>({[a]:I(t[a],r)}))))},Ne=t=>{if(!t)return t;let r=Object.getPrototypeOf(t),s=Object.getOwnPropertyDescriptors(t);for(let[p,l]of Object.entries(s))l.value&&(s[p].value=I(l.value));let a=Object.create(r,s);return Object.isFrozen(t)&&Object.freeze(a),Object.isSealed(t)&&Object.seal(a),a},We=t=>t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,We),Be=t=>Object.prototype.toString.call(t).slice(8,-1),Ue=(t,...r)=>{if(!r.length)return null;for(let s of r){if(!m(s)){console.error(`Matching case must be an entry (a 2-element array). Found: ${Be(s)}`,s);break}let[a,p]=s;if(d(a)&&a(t)||a===t)return p}return null};Ue.default=()=>!0;let He=t=>T(t)?Object.keys(t).length===0:m(t)?t.length===0:x(t)?t.trim().length===0:!!w(t)&&t<1,Qt=(t,r)=>{let[s]=i({arr:t,comparator:r},{arr:m,$default:d});return s&&t.length?t.reduce((a,p)=>r(a,p)>0?a:p):null},ze=t=>m(t)?t.filter((r,s,a)=>a.indexOf(r)==s):t,qe=(t,r)=>{if(!r)return ze(t);let{unique:s}=t.reduce((a,p)=>{let l=r(p);return!a.set.has(l)&&a.unique.push(p),a.set.add(l),a},{unique:[],set:new Set});return s},Ge=(t,r=!0)=>M(t)?Object.keys(t).reduce((s,a)=>{let p=t[a];return p==null||(s[a]=r&&M(p)?Ge(p):p),s},T(t)&&{}||[]):console.error("cleanColl requires a collection as the first argument")||t,Yt=(t,r,s)=>Ut(t,r,"set",s),Je=Array.isArray,Ke=Object.keys,Cn=Object.prototype.hasOwnProperty,Zt=(t,r)=>{if(t===r)return!0;if(!t||!r||typeof t!="object"||typeof r!="object")return t!=t&&r!=r;let s=Je(t),a=Je(r),p,l,f;if(s&&a){if(l=t.length,l!=r.length)return!1;for(p=l;p--!=0;)if(!Zt(t[p],r[p]))return!1;return!0}if(s!=a)return!1;let h=t instanceof Date,S=r instanceof Date;if(h!=S)return!1;if(h&&S)return t.getTime()==r.getTime();let $=t instanceof RegExp,V=r instanceof RegExp;if($!=V)return!1;if($&&V)return t.toString()==r.toString();let re=Ke(t);if(l=re.length,l!==Ke(r).length)return!1;for(p=l;p--!=0;)if(!Cn.call(r,re[p]))return!1;for(p=l;p--!=0;)if(f=re[p],!Zt(t[f],r[f]))return!1;return!0},Ve=t=>t&&x(t)?zt(t)?qt(t):w(t)?Gt(t):(()=>{try{return JSON.parse(t)}catch{return t}})():t,te,at="dir",K="type",jn=["error","info","log","dir","warn"],Qe=(...t)=>{if(!t.length)return;let r=t.length===1?at:t.pop();(te||r==="error")&&(typeof t[0]=="string"&&(K==="type"?t[0]=`[ ${r.toUpperCase()} ] ${t[0]}`:K&&(t[0]=`${K} ${t[0]}`)),jn.indexOf(r)!==-1?console[r](...t):console[at](...t,r))},Ye=(t,r)=>{t&&Object.entries(t).map(([s,a])=>{r&&r.indexOf(s)!==-1||(typeof a=="object"&&Ye(a),t[s]=void 0,delete t[s])})},Ze=(...t)=>t.reduce((r,s)=>{let a=I(s);return m(a)?[...m(r)&&r||[],...a]:T(a)?Object.entries(a).reduce((p,[l,f])=>({...p,[l]:d(f)?Vt(f):M(f)&&l in p?Ze(p[l],f):I(f)}),r):r},m(t[0])&&[]||{}),tr=t=>m(t)&&t.length===2&&(w(t[0])||x(t[0])),er=(t,r)=>{if(!m(t)&&!T(t))return console.error(t,"Expected array or object for obj. Found "+typeof t),t;if(!d(r))return console.error("Expected function for cb. Found "+typeof r),t;let s=Object.entries(t),a=m(t)?[]:{};return s.reduce((p,[l,f])=>{let h=r(l,f);return tr(h)?Yt(p,h[0],h[1]):(console.error(`Callback function must return entry. Found: ${h}. Using current entry instead.`),Yt(p,l,f))},a)},pt=(t,r,s={})=>T(t)&&d(r)&&Object.entries(t).reduce((a,[p,l])=>r(p,l,a),s)||s,ee=t=>{if(!d(t))throw"Argument must be a function";return(...r)=>new Promise((s,a)=>d(r[r.length-1])?(r.pop(),r.push((...p)=>p&&p[0]?a(...p):s(...p)),t(...r)):s(t(...r)))},Ln=Array.from(["caller","callee","arguments","apply","bind","call","toString","__proto__","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","valueOf","toLocaleString"]).concat(Object.getOwnPropertyNames(Object.prototype)).reduce((t,r)=>(t[r]=!0,t),{}),rr=t=>{if(!t.__IS_PROMISIFIED__){for(let r of Object.getOwnPropertyNames(t))if(!(r.indexOf("Async")!==-1||t[`${r}Async`])&&!Ln[r])if(d(t[r]))t[`${r}Async`]=ee(t[r]);else{let s=Object.getOwnPropertyDescriptor(t,r).get;d(s)&&(t[`${r}Async`]=ee(s))}t.__IS_PROMISIFIED__=!0}return t},nr=t=>Boolean(t&&t instanceof RegExp),or=t=>nr(t)?t.source:x(t)?t:null,sr=t=>{let r={},s=t.split("?"),a=s[s.length-1];if(!a)return r;let p=a.split("&");return p.length&&p.map(l=>{let f=l.split("=");if(f.length<=1)return r;let h=[f.shift(),f.join("=")];if(h.length===2){let S=decodeURIComponent(h[1]).split(",");if(S&&S.length>1)r[h[0]]=S;else if(h[0]in r){let $=r[h[0]];r[h[0]]=m($)?$.push(decodeURIComponent(h[1])):[$,decodeURIComponent(h[1])]}else r[h[0]]=decodeURIComponent(h[1])}}),r};e.applyToCloneOf=(t,r)=>{let s;if(t||(s="object (Argument 1) in applyToCloneOf, must be defined!"),T(t)||(s="object (Argument 1) in applyToCloneOf, must be an object!"),r||(s="mutator (Argument 2) in applyToCloneOf, must be defined!"),d(r)||(s="mutator (Argument 2) arg in applyToCloneOf, must be a function!"),s)return console.warn(s)||t;let a=I(t);return r(a),a},e.applyToFunc=_e,e.areCountMapsEqual=A,e.areFrequencyEqual=(t,r)=>{let[s]=i({arr:t,otherArr:r},{$default:m});if(!s)return null;if(t===r)return!0;if(t.length!==r.length)return!1;let a=y(t),p=y(r);return A(a,p)},e.areSetEqual=(t,r)=>{let[s]=i({arr:t,otherArr:r},{$default:m});if(!s)return null;if(t===r)return!0;let[a,p]=t.length>r.length?[t,r]:[r,t],l=new Set(p);for(let f=0;f<a.length;f++){let h=a[f];if(!l.has(h))return!1}return!0},e.buildElementCountMap=y,e.buildPath=(...t)=>t.reduce((r,s)=>{let a=toStr(s);return`${r}${a&&"/"+a||""}`},"").replace(/([^:\/]|^)\/{2,}/g,"$1/"),e.camelCase=Fe,e.camelCasePath=t=>{let r=t.split(".").map((s,a)=>a>0?lt(s,!1):s);return r.length>1?r.join(""):t},e.capitalize=lt,e.checkCall=(t,...r)=>d(t)?t(...r):void 0,e.cleanColl=Ge,e.cleanStr=Nt,e.clearObj=Ye,e.cloneArr=t=>Array.from([...m(t)&&t||T(t)&&Object.entries(t)||[]]),e.cloneFunc=Vt,e.cloneJson=t=>{try{return JSON.parse(JSON.stringify(t))}catch(r){return Qe(r.message,"error"),null}},e.cloneObjWithPrototypeAndProperties=Ne,e.compareTo=Jt,e.complement=t=>{let[r]=i({predicate:t},{predicate:d});return r?(...s)=>!t(...s):null},e.containsStr=(t,r,s)=>(t=!x(t)&&G(t)||t,r=!x(r)&&G(r)||r,t.indexOf(r,s)!==-1),e.convertToStrBool=De,e.debounce=(t,r=250,s=!1)=>{let a;return function(...p){if(!d(t))return null;let l=this,f=s&&!a;return clearTimeout(a),a=setTimeout(()=>{a=null,!s&&t.apply(l,p)},r),f?d(t)&&t.apply(l,p):void 0}},e.deepClone=I,e.deepEqual=Zt,e.deepFreeze=E,e.deepMerge=Ze,e.delimitString=ke,e.doIt=(...t)=>{let r=t.slice(),s=r.shift(),a=r.shift(),p=r.pop();if(!w(s)||!d(p))return[];let l=new Array(s),f=[];for(let h=0;h<l.length;h++){let S=p.call(a,h,...r);if(S===!1)break;f.push(S)}return f},e.either=(t,r,s)=>d(s)?s(t,r)&&t||r:Ie(t)&&t||r,e.eitherArr=(t,r)=>m(t)?t:r,e.eitherFunc=(t,r)=>d(t)&&t||r,e.eitherObj=(t,r)=>T(t)&&t||r,e.eitherStr=(t,r)=>x(t)&&t||r,e.ensureArr=_,e.equalsNaN=J,e.everyEntry=(t,r)=>t?T(t)?d(r)?Xt(t,Object.entries,s=>s.every(([a,p])=>r(a,p))):(console.error(`Argument 'predicate' passed into everyEntry must a function. Found: ${r}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`everyEntry expects argument obj [${t}] to be defined.`),!1),e.exists=ot,e.filterObj=(t,r)=>t&&(T(t)?d(r)?pt(t,(s,a,p)=>(r(s,a)&&(p[s]=a),p),{}):(console.error(`Argument 'predicate' passed into filterObject must a function. Found: ${r}`),t):(console.error(`Object ${t} was not an object. It must be for filterObject`),t)),e.findExtrema=Qt,e.findMax=(t=[],r=Kt)=>Qt(t,(s,a)=>Jt(r(s),r(a))),e.findMin=(t=[],r=Kt)=>Qt(t,(s,a)=>Jt(r(a),r(s))),e.flatArr=Oe,e.flatMap=(t,r)=>{let[s]=i({arr:t,mapFn:r},{arr:m,mapFn:d});return s?t.reduce((a,p)=>{let l=r(p);return m(l)?l.map(f=>a.push(f)):a.push(l),a},[]):t},e.flatUnion=(...t)=>{let r=t.pop(),s={exists:!0},a=d(r)?r:t.push(r)&&void 0;return t.reduce((p,l)=>m(l)?qe(Oe([...p,...l],s),a):p,[])},e.get=st,e.getNearestDelimiterIndex=je,e.getNums=it,e.getRegexSource=or,e.getURLParam=t=>{var r,s,a;let[p]=i({paramKey:t},{paramKey:x});if(!p)return null;let l=typeof document<"u"?document:null,f=l==null||(r=l.location)===null||r===void 0?void 0:r.search;return x(f)&&(s=(a=sr(f))===null||a===void 0?void 0:a[t])!==null&&s!==void 0?s:null},e.getWordEndingAt=(t,r,s=[" "])=>{let a=Ht(t),p=t.length-r;return Ht(Le(a,p,s))},e.getWordStartingAt=Le,e.hasDomAccess=()=>{try{return!(typeof window>"u"||!window.document||!window.document.createElement)}catch{return!1}},e.hasOwn=Xe,e.hashString=(t,r)=>{if(!x(t)||t.length==0)return 0;t=t.split("").reverse().join("");let s=0;for(let a=0;a<t.length;a++)s=(s<<5)-s+t.charCodeAt(a),s=`${Math.abs(s&s)}`;return Bt(r)?s.slice(0,r):s},e.hyphenator=t=>{if(Wt.hasOwnProperty(t))return Wt[t];let r=t.replace(kn,Fn);return Wt[t]=Pn.test(r)?"-"+r:r},e.identity=Kt,e.isArr=m,e.isArrMap=t=>{if(!T(t))return!1;let r=Object.values(t);return qt(r.length&&r.every(m))},e.isBool=mt,e.isColl=M,e.isEmail=t=>!t||!x(t)?!1:Boolean(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(t)),e.isEmpty=He,e.isEmptyColl=t=>m(t)?t.length===0:M(t)&&Object.getOwnPropertyNames(t).length===0,e.isEntry=tr,e.isFloat=t=>w(t)&&t%1!=0,e.isFunc=d,e.isInt=t=>w(t)&&t%1==0,e.isLowerCase=we,e.isNegative=t=>w(t)&&t<0,e.isNonNegative=Bt,e.isNum=w,e.isObj=T,e.isOrderable=ve,e.isPhone=t=>!t||!x(t)?!1:Boolean(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(t))&&t.replace(/\D/g,"").length<11,e.isPositive=t=>w(t)&&t>0,e.isQuoted=(t,r=Mn)=>x(t)&&r.some(s=>t.startsWith(s)&&t.endsWith(s)),e.isRegex=nr,e.isSame=(t,r)=>t===r?t!==0||1/t==1/r:t!=t&&r!=r,e.isStr=x,e.isStrBool=zt,e.isUpperCase=$e,e.isUrl=t=>Boolean(/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(t)),e.isUuid=t=>!t||!x(t)?!1:Boolean(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(t)),e.isValidDate=t=>!isNaN((t instanceof Date&&t||new Date(t)).getTime()),e.isValidUrl=t=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-/]))?/.test(t),e.joinRegex=(...t)=>{let[r,s]=(p=>{if(m(p[0]))return[p[0],p[1]];let l=p[p.length-1],f=x(l)?l:void 0;return[f?p.splice(0,p.length-1):p,f]})(t),a=r.reduce((p,l)=>{let f=or(l);return f?p===""?f:`${p}|${f}`:p},"");return new RegExp(`(${a})`,s)},e.jsonEqual=(t,r)=>{try{return JSON.stringify(t)===JSON.stringify(r)}catch{return!1}},e.keyMap=(t,r)=>m(t)&&t.reduce((s,a)=>{if(!x(a))return s;let p=r&&a.toUpperCase()||a;return s[p]=p,s},{})||{},e.limbo=t=>t&&d(t.then)?t.then(r=>[null,r]).catch(r=>[r,void 0]):[new Error("A promise or thenable is required as the first argument!"),null],e.logData=Qe,e.mapColl=(t,r)=>d(r)&&M(t)?Object.keys(t).map(s=>r(s,t[s],t)):m(t)?[]:{},e.mapEntries=er,e.mapFind=(t,r,s=ot)=>{let[a]=i({coll:t,mapper:r,test:s},{coll:M,$default:d});if(a)return T(t)?((p,l,f)=>{let h=0;for(let S in p){if(!p.hasOwnProperty(S))continue;let $=l(p[S],S,h);if(f($,S,h))return $;h++}return null})(t,r,s):((p,l,f)=>{for(let h=0;h<p.length;h++){let S=l(p[h],h,h);if(f(S,h,h))return S}return null})(t,r,s)},e.mapKeys=(t,r)=>T(t)&&d(r)?er(t,(s,a)=>[r(s),a]):t,e.mapObj=(t,r)=>T(t)&&d(r)&&Object.entries(t).map(([s,a])=>r(s,a))||t,e.mapString=Ee,e.match=Ue,e.memorize=(t,r,s=1)=>{if(!d(t)||r&&!d(r))return console.error("Error: Expected a function",t,r);let a=function(){let p=a.cache,l=r?r.apply(this,arguments):arguments[0];if(Xe(p,l))return p[l];let f=t.apply(this,arguments);return w(s)&&Object.keys(p).length<s?p[l]=f:a.cache={[l]:f},f};return a.cache={},a.destroy=()=>{r=void 0,a.cache=void 0,a.destroy=void 0,a=void 0},a},e.mod=(t,r)=>(t%r+r)%r,e.noOp=()=>{},e.noOpObj=z,e.noPropArr=$n,e.noPropObj=X,e.nth=t=>{if(!w(t)&&(!(t=it(t))||(t=Gt(t),J(t))))return"";let r=t%100;if(r>=10&&r<=20)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},e.objToQuery=t=>{let r;return pt(t,(s,a,p)=>{if(!a)return p;let l=x(a)||w(a)||mt(a)?a:M(a)?m(a)?a.join(","):JSON.stringify(a):null;return l&&(p=r?`${p}&${encodeURIComponent(s)}=${encodeURIComponent(l)}`:`?${encodeURIComponent(s)}=${encodeURIComponent(l)}`,r=!0),p},"")},e.omitKeys=(t={},r=[])=>T(t)&&pt(t,(s,a,p)=>(r.indexOf(s)===-1&&(p[s]=t[s]),p),{})||{},e.omitRange=(t,r,s)=>{let[a]=i({arr:t,startIndex:r,count:s},{arr:m,$default:Bt});if(!a)return t;let p=[...t];return p.splice(r,s),p},e.parseErrorMessage=t=>x(t)&&!He(t)?t:T(t)?t.message:null,e.parseJSON=(t,r=!0)=>{try{return JSON.parse(t)}catch(s){return r&&console.error(s.message),null}},e.pickKeys=(t={},r=[])=>T(t)&&r.reduce((s,a)=>(a in t&&(s[a]=t[a]),s),{})||{},e.pipeline=Xt,e.plural=t=>t&&t.length&&t[t.length-1]!=="s"?t+"s":t,e.promisify=ee,e.promisifyAll=t=>{if(!T(t))return t;rr(t);let r=Object.getPrototypeOf(t);return r&&Object.getPrototypeOf(r)!==null&&rr(r),t},e.queryToObj=sr,e.randomArr=(t,r)=>{if(!m(t))return t;let s=r||1,a=[];for(let p=0;p<s;p++)a.push(t[Math.floor(Math.random()*t.length)]);return r?a:a[0]},e.randomizeArr=t=>!m(t)&&t||t.sort(()=>.5-Math.random()),e.reduceColl=(t,r,s)=>d(r)&&M(t)?Object.keys(t).reduce((a,p)=>r(p,t[p],t,a),s):m(t)?[]:{},e.reduceObj=pt,e.removeDot=Pe,e.repeat=(t,r,s=!1)=>{if(!r||r<=0)return[];if(!w(r))return console.error("Times argument must be a number"),[];let a=[];for(let p=0;p<r;p++){let l=d(t)?t():s?I(t):t;a.push(l)}return a},e.resetLogs=()=>{te=void 0,at="log",K="type"},e.reverseStr=Ht,e.runSeq=async(t=[],r={})=>{let[s]=i({asyncFns:t},{asyncFns:m});if(!s)return[];let{cloneResults:a=!1,returnOriginal:p=!0}=r,l=[];for(let f of t){let h=d(f)?await f(l.length,a?I(l):l):p?f:void 0;l.push(h)}return l},e.sanitize=Me,e.sanitizeCopy=t=>JSON.parse(Me(JSON.stringify(t))),e.set=Yt,e.setLogs=(t,r,s)=>{te=t,at=r||at||"log",K=s||K||"type"},e.shallowEqual=(t,r,s)=>{if(s&&(m(s)||x(s))&&(t=st(t,s),r=st(r,s)),t===r)return!0;if(!(t&&M(t)&&r&&M(r))||Object.keys(t).length!==Object.keys(r).length)return!1;for(let a in t)if(t[a]!==r[a])return!1;return!0},e.singular=t=>t&&t.length&&t[t.length-1]==="s"?t.slice(0,t.length-1):t,e.snakeCase=t=>ke(t,"_").toLowerCase(),e.softFalsy=Ie,e.someEntry=(t,r)=>t?T(t)?d(r)?Xt(t,Object.entries,s=>s.some(([a,p])=>r(a,p))):(console.error(`Argument 'predicate' passed into someEntry must a function. Found: ${r}`),!1):(console.error(`Argument obj ${t} must be an object.`),!1):(console.error(`someEntry expects argument obj [${t}] to be defined.`),!1),e.spaceJoin=(t,r)=>(r=m(r)?r:[r]).reduce((s,a)=>x(a)?`${s?s+" ":""}${a}`.trim():s,x(t)?t:""),e.splitByKeys=(t={},r)=>{if(!r)return[{},{...t}];let s=[{},{}],a=_(r);return T(t)?pt(t,(p,l,f)=>(ot(a.find(h=>ot(h)&&G(h)===p))?f[0][p]=t[p]:f[1][p]=t[p],f),s):s},e.strToType=Ve,e.styleCase=t=>{if(!x(t))return t;let r=Fe(t);return`${r[0].toLowerCase()}${r.slice(1)}`},e.template=Ce,e.throttle=(t,r=100)=>{let s=!1;return function(...a){if(!s)return s=!0,t.apply(this,a),setTimeout(()=>{s=!1},r)}},e.throttleLast=(t,r,s=100)=>{let a;return function(...p){a&&clearTimeout(a),a=setTimeout(()=>{t.apply(this,p),clearTimeout(a)},s),typeof r=="function"&&r()}},e.timedRun=async(t,...r)=>{let[s]=i({fn:t},{fn:d});if(!s)return[void 0,-1];let a=new Date;return[await t(...r),new Date-a]},e.toBool=qt,e.toFloat=t=>t&&!J(t)&&parseFloat(w(t)&&t||it(t))||0,e.toInt=t=>t&&!J(t)&&parseInt(w(t)&&t||it(t))||0,e.toNum=Gt,e.toObj=(t,r,s)=>m(t)?Object.keys(t).reduce((a,p)=>(a[p]=t[p],a),{}):x(str)?(r=r||"=",s=s||"&",str.split(s).reduce((a,p)=>{let l=p.split(r);return a[l[0].trim()]=Ve(l[1].trim()),a},{})):{},e.toStr=G,e.trainCase=t=>x(t)&&t.split(/(?=[A-Z])|[\s_-]/gm).join("-").toLowerCase()||t,e.trimStringFields=t=>Object.entries(t).reduce((r,[s,a])=>(r[s]=x(a)?a.trim():a,r),t),e.typeOf=Be,e.uniqArr=qe,e.uniqArrByReference=ze,e.unset=(t,r)=>Ut(t,r,"unset"),e.uuid=We,e.validFilename=t=>t?!(/[<>:"/\\|?*\u0000-\u001F]/g.test(t)||/^(con|prn|aux|nul|com\d|lpt\d)$/i.test(t)||/^\.\.?$/.test(t)):!1,e.validate=i,e.wait=t=>new Promise(r=>setTimeout(()=>r(!0),t)),e.wordCaps=t=>x(t)?Nt(t).split(" ").map(r=>r&&lt(r)||"").join(" "):t})});var Yo={};Bn(Yo,{PKInstance:()=>Qo,Parkin:()=>vt});module.exports=Un(Yo);var ne=(c=>(c.beforeAll="beforeAll",c.afterAll="afterAll",c.beforeEach="beforeEach",c.afterEach="afterEach",c))(ne||{}),ft=(u=>(u.given="given",u.when="when",u.then="then",u.and="and",u.but="but",u))(ft||{});var pr=b(R()),C=(0,pr.deepFreeze)({ALIAS_REF:"$$",ALIAS_WORLD_KEY:"$alias",ALIAS_REF_AT_RUNTIME:"$$:",REGEX_VARIANT:"regex",WORLD_REF:"$",WORLD_KEY:"$world",WORLD_AT_RUNTIME:"$:",EXPRESSION_VARIANT:"expression",HOOK_TYPES:Object.keys(ne),STEP_TYPES:Object.keys(ft),FEATURE_META:["feature","perspective","desire","reason","comments"],LOG_JEST_SPEC_ENV:"PARKIN_LOG_JEST_SPEC",SPEC_RESULT_LOG:"------- PARKIN SPEC RESULT LOG -------"});var Pr=b(R());var Ot=b(R());var j=(e,n,o)=>{let i=e.match(n)[o];return i?i.trim():" "},k=(e,n=1)=>{let o=e&&e.trim()&&e.trim().toLowerCase().replace(/[\s\/\\\(\)\+=_&%\$#@!\*~`\|\?:;"'<>,.{}]/g,"-");return o?`${o}-${e.length}`:`${n}-${n}`},cr=e=>{let n=e.match.toString();return n[0]==="/"&&(n=n.substring(1)),n[0]==="^"&&(n=n.substring(1)),n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1)),n.charAt(n.length-1)==="$"&&(n=n.slice(0,-1)),n.replace(/\(\?:([^\|]+)+\|+([^\)]+)?\)/,"$1")},ur=(e,n)=>n.reduce((o,i)=>!o||i.content===o.content?!1:(i.uuid===o.uuid&&(o.uuid=`${o.uuid}-${o.content.length}`),o),{...e}),ht=e=>e.trim().replace(/^("|')/,"").replace(/("|')$/,""),N=e=>{let n=e.replace(/^\s+/g,""),o=e.length-n.length;return new Array(o).fill(" ").join("")};var O=b(R());var lr=b(R()),ct=/\w*\([^)]*?\)/,Tt=/\s*\S*\/\S*\s*/,q=/\s*{(.*?)}\s*/,mr=(0,lr.joinRegex)(q,ct,"g"),oe=/(.*)/,xt=/{|}/g,yt=/"[^"]+"/,At=/'[^']+'/,Rt=/-?[0-9]+[.][0-9]+/,St=/-?[0-9]+/,gr=/^["]?\$world\.\S+["]?/,fr=/^\$world\./,dr=/(\$:world|\$world)+\.[^"'\s]*/gm,hr=/^["]?\$\$\S+["]?/,Tr=/^\$\$/,xr=/(\$\$:\w+|\$\$\w+)[^"'\s]*/gm;var yr=e=>()=>{throw new Error(`Test method ${e} does not exist on the global scope.
Please ensure ${e} exists before calling the run method!
`)},Ar=()=>{throw new Error("Runner class constructor requires an instance of the Steps class")};var Rr=()=>{throw new Error("Runner class requires feature text when calling the run method")},Sr=e=>{throw new ReferenceError(e)},br=e=>{throw new Error(`Cannot register param type "${e}". It already exists!`)},Or=e=>{throw new Error("Assemble feature requires an object matching the feature model spec!")},_r=e=>{throw new Error(`Can not replace ${e} with value from $world, it does not exist on the world object`)},Er=(e,n)=>{throw new Error([`Expected client hook type to be one of ', ${e}.`,`Found: ${n}`].join(`
`))},wr=(e,n)=>{throw console.error(`Error replacing $world value in feature text. Current match was ${n}`),e},$r=(e,n)=>{throw console.error(`Error replacing $$alias ( $world.$alias ) in feature text. Current match was ${n}`),e};var{WORLD_KEY:Hn,ALIAS_WORLD_KEY:zn,ALIAS_REF:qn}=C,Q=(e,n)=>(o,i)=>{let c=o.match(gr),u=o.match(hr);if(!(0,O.isObj)(i)||!c&&!u)return se(e(o),n);let g=c?(0,O.get)(i,ht(o).replace(`${Hn}.`,"")):(0,O.get)(i,ht(o).replace(`${qn}`,`${zn}.`));return(0,O.exists)(g)?se(g,n):c?_r(o,i):se(e(o),n)},se=(e,n)=>typeof e===n?e:null,W={name:"",regex:"",type:"string",useForSnippets:!0,preferForRegexpMatch:!1,transformer:Q(e=>e,"string")},B={any:{...W,name:"any",regex:oe},word:{...W,name:"word",regex:oe,transformer:Q(e=>(0,O.isQuoted)(e)?void 0:(0,O.toStr)(e),W.type)},float:{...W,name:"float",type:"number",regex:Rt,transformer:Q(e=>{let n=parseFloat(e);return(0,O.equalsNaN)(n)?void 0:n},"number")},int:{...W,name:"int",type:"number",regex:St,transformer:Q(e=>{let n=parseInt(e);return(0,O.equalsNaN)(n)||e.includes(".")?void 0:n},"number")},string:{...W,name:"string",regex:(0,O.joinRegex)(yt,At),transformer:Q(e=>(0,O.isQuoted)(e)?ht(e):void 0,W.type)}},Y=()=>B,bt=(e=O.noOpObj,n=e.name)=>B[n]?br(n):(B[n]={...W,...e},B[n].transformer=Q(B[n].transformer,B[n].type),B),kr=(e,n,o)=>e.map((i,c)=>{let u=n[c]||B.any;return(0,O.checkCall)(u.transformer,i,o)}).filter(O.exists);var Z=(e,n)=>{let o=n.match(new RegExp(e.match));return o?{definition:e,match:o.slice(1,o.length).filter(Boolean)}:Ot.noOpObj},ae=e=>{let n=e.split(/(\(|\))/),[o,,i,,c]=n;return o===""&&c===""?e+"?":o===""?`(${i}|${i}${c})`:c===""?`(${o}|${o}${i})`:`(${o}${c}|${o}${i}${c})`},Gn=e=>{let n=e.input;return(0,Ot.getWordEndingAt)(n,e.index)+e[0]},Jn=e=>{let n=Gn(e);return ae(n)},pe=e=>{let n=Y();return(n[e]||n.any).regex.source},ce=e=>`(${e.trim().replace(/\//g,"|")})`,Kn=(e,n)=>{let[o,i]=n;switch(e){case"parameter":return new RegExp(pe(i));case"optional":return new RegExp(Jn(n));case"alternate":return new RegExp(ce(o));default:return null}},ie=(e,n="other")=>{let o=e[0],i=o.trimStart(),c=o.length-i.length;return{text:o.trim(),input:e.input,index:e.index+c,regex:Kn(n,e),type:n,...n==="parameter"&&{paramType:o.trim().replace(xt,"")}}},tt=e=>{let n=[...e.matchAll(new RegExp(q,"gi"))].map(u=>ie(u,"parameter")),o=[...e.matchAll(new RegExp(ct,"gi"))].map(u=>ie(u,"optional")),i=[...e.matchAll(new RegExp(Tt,"gi"))].map(u=>ie(u,"alternate"));return[...n,...o,...i].sort((u,g)=>u.index-g.index)};var Vn=(0,Pr.joinRegex)(St,Rt,q,yt,At,"g"),Fr=(e,n)=>{let o=tt(n.match),i=[],c,u=0;for(;(c=Vn.exec(e))!==null;){let[g,m,...y]=c,A=y.pop(),T=o[u],_=g.trimStart(),d=g.length-_.length;i.push({match:g.trim(),defIndex:T==null?void 0:T.index,index:c.index+d,type:A||(T==null?void 0:T.paramType)||"any"}),u++}return i};var vr=b(R());var L=b(R()),ue=Boolean(typeof window<"u"),Mr=Boolean(typeof globalThis<"u"),Qn=Boolean(typeof module=="object"),Yn=Boolean(typeof require=="function"),le=Boolean(Mr&&typeof globalThis.jasmine<"u"),Cr=()=>le?(0,L.checkCall)(()=>globalThis.jasmine):{getEnv:()=>L.noOpObj},jr=()=>Qn?(0,L.checkCall)(()=>module):{exports:{}},Lr=()=>Yn?(0,L.checkCall)(()=>require):L.noOp,Dr=()=>{try{return ue?(0,L.checkCall)(()=>window):Mr?(0,L.checkCall)(()=>globalThis):L.noOpObj}catch{return L.noOpObj}};var et=b(R());var Zn=e=>ue?e.replace(/[|\\[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"):e.replace(/[|\\[\]^$+*?.]/g,"\\$&"),Ir=(e,n,o)=>{if(!n.test(e))return e;let i=e;return e.replace(n,(...c)=>{let u=c[0].trim(),[g,...m]=i.split(u),y=(0,et.isFunc)(o)?o(...c):o;i=`${g}${y}${m.join(u)}`}),i},to=e=>{let n=Y(),o=[];return{regex:Ir(e,mr,(c,...u)=>{let g=c.trim().replace(xt,""),m=c.match(q),y=c.match(ct);return m&&o.push(n[g]||n.any),m?pe(g):y?ae(c):c}),transformers:o}},eo=e=>{let n=[];return{regex:Ir(e,new RegExp(Tt,"g"),ce),altIndexes:n}},ro=e=>{let n=e;return e.startsWith("^")||(n="^"+n),e.endsWith("$")||(n+="$"),{regex:n}},me=(e,n,o)=>{let i=tt(n),c=i.filter(g=>g.type==="parameter").length,u=i.reduce((g,m)=>{let{params:y,textIndex:A,wordMatchIndex:T}=g,_=e.substring(A),d=m.paramType==="word",E=_.match(m.regex),z={0:o[T],index:_.indexOf(o[T])},X=d?z:E;return X?(m.type==="parameter"&&X&&y.push(X[0]),{params:y,textIndex:A+(X&&X.index+X[0].length),wordMatchIndex:T+(d&&1)}):g},{params:[],textIndex:0,wordMatchIndex:0});return c===u.params.length?u.params:null},ge=(e,n)=>{let o=Zn(e.match),{regex:i}=eo(o),{transformers:c,regex:u}=to(i),{regex:g}=ro(u);return{found:Z({...e,match:g},n),escaped:o,regexAlts:i,transformers:c,regexAnchors:g,regexConverted:u}},_t=(e,n,o)=>{if(e.match===n)return{definition:e,match:[]};let{found:i,transformers:c}=ge(e,n);if(!i||!i.definition||!i.match)return et.noOpObj;let u=me(n,e.match,i.match);if(!u)return et.noOpObj;let g=kr(u,c,o);return g.length!==u.length?et.noOpObj:{definition:e,match:g}};var{REGEX_VARIANT:no}=C,Et=class{find=fe;regex=Z;parts=tt;types=Y;stepTokens=Fr;extract=me;expression=_t;expressionFind=ge;register=bt},fe=(e,n,o)=>e.reduce((i,c)=>i.match||!c.match?i:c.variant!==no?_t(c,n,o):Z(c,n),vr.noOpObj);var v=b(R());var{REGEX_VARIANT:Xr,EXPRESSION_VARIANT:oo,STEP_TYPES:so}=C,io=e=>{let n=e.variant===Xr?e.match.toString():`"${e.match}"`;return`${(0,v.capitalize)(e.type)}(${n}, ${e.method.toString()})`},ao=function(e,n,o,i,c=v.noOpObj){let u={type:n,meta:c,match:o,method:i,tokens:[],variant:o.toString().indexOf("/")===0?Xr:oo};u.name=cr(u),u.uuid=k(`${n}-${u.name}`),u.content=io(u);let g=this.list(),m=ur(u,g);return m&&this[e].push(m),m},po=(e,n,o)=>(...i)=>{let c=e[n](...i);return o[n].push(c),c},co=function(e){let n=this.types.map(i=>(0,v.capitalize)(i)),o=n.reduce((i,c)=>(i[c]=[],i),{});return(0,v.eitherArr)(e,[e]).map(i=>{Function(`return (global, require, module, ${n.join(",")}) => {
          return (function(global) { ${i} }).call(global, global)
        }`)()(Dr(),Lr(),jr(),...n.map(c=>po(this,c,o)))}),o},uo=e=>e.types.reduce((n,o)=>n.concat(e[`_${o}`]),[]),wt=class{_world;types=so;constructor(n={$alias:{}}){this._world=n;let o=this;this.types.map(i=>{let c=`_${i}`;this[c]=[],this[(0,v.capitalize)(i)]=(u,g,m)=>o.register(c,i,u,g,m)})}list=()=>uo(this);typeList=()=>this.types.reduce((n,o)=>{let i=`_${o}`;return n[o]=[...this[i]],n},{});match=n=>{let o=this.list(),i=fe(o,n,this._world);return!i.match||!i.definition?!1:(i.match.push(this._world),i)};resolve=n=>{let o=this.match(n);return o?o.definition.method(...o.match):Sr(`Matching definition could not be found for step: "${n}"`)};register=(...n)=>(0,v.isStr)(n[0])?ao.apply(this,n):co.apply(this,n);clear=()=>{this.types.map(n=>this[`_${n}`]=[])}};var rt=b(R());var{HOOK_TYPES:Nr}=C,$t=class{types=Nr;instance=void 0;_registeredHooks={};constructor(n,o){this.instance=o,this.types.map(i=>{this[i]=c=>{(0,rt.isFunc)(c)&&(this._registeredHooks[i]=this._registeredHooks[i]||[],this._registeredHooks[i].push(c))}})}getRegistered=n=>{let o=this.types.includes(n)?this._registeredHooks[n]||rt.noPropArr:Er(Nr.join(", "),n);if(o)return o.length?async()=>o.reduce(async(i,c)=>(await i,await c(this.instance)),Promise.resolve()):rt.noOp}};var lo=/^\s*Given (.*)$/,mo=/^\s*When(.*)$/,go=/^\s*Then (.*)$/,fo=/^\s*And (.*)$/,ho=/^\s*But (.*)$/,To=/^\s*\* (.*)$/,xo=/^\s*?"""\s*?/;var yo=/^\s*?```\s*?/;var Wr=/^\s*?\|/;var Ao=[{regex:lo,type:"given"},{regex:mo,type:"when"},{regex:go,type:"then"},{regex:fo,type:"and"},{regex:ho,type:"but"},{regex:To,type:"and"}],Ro=(e,n,o,i)=>{if(!Wr.test(o))return e;let c;return e.table={index:i,content:n.reduce((u,g)=>(c=c||!Wr.test(g),!c&&u.push(g.split("|").reduce((m,y)=>{let A=y.trim();return A&&m.push(A),m},[])),u),[])},e},So=(e,n,o,i)=>{let c=xo.test(o)&&'"""';if(c=c||yo.test(o)&&"```",!c)return e;let u=o.split(c)[0],g=new Array(u.length).fill("\\s").join(""),m=new RegExp(`^${g}`);return e.doc={index:i,whiteSpace:u,type:c==='"""'?"quote":"tick",content:n.split(c).slice(1).shift().trim().split(`
`).reduce((y,A)=>(y.push(A.replace(m,"").trim()),y),[]).join(`
`)},e},bo=(e,n,o,i,c)=>{let u={type:e,index:c,step:n,whitespace:N(i),uuid:k(`${e}-${n}`)},g=c+1,m=o[g],y=o.slice(g);return u=Ro(u,y,m,g),u=So(u,y.join(`
`),m,g),u},Br=(e,n,o,i)=>{let c=e;return Ao.reduce((u,g)=>{if(u)return u;let m=g.regex.test(o);return m&&c.steps.push(bo(g.type,j(o,g.regex,1),n,o,i)),m},!1)};var ln=b(R());var nt=b(R());var{ALIAS_REF:Oo,WORLD_REF:_o,ALIAS_WORLD_KEY:Eo,WORLD_AT_RUNTIME:Ur,ALIAS_REF_AT_RUNTIME:Hr}=C,zr=(e,n,o)=>{let i=(0,nt.get)(n,o);return(0,nt.isFunc)(i)?i(n,o):(0,nt.exists)(i)?i:e},wo=(e,n)=>{let o;try{return e.replace(xr,i=>{o=i;let c=i.trim();return c.indexOf(Hr)===0?c.replace(Hr,`$${Oo}`):zr(i,n,c.replace(Tr,`${Eo}.`))})}catch(i){$r(i,o)}},$o=(e,n)=>{let o;try{return e.replace(dr,i=>{o=i;let c=i.trim();return c.indexOf(Ur)===0?c.replace(Ur,_o):zr(i,n,c.replace(fr,""))})}catch(i){wr(i,o)}},qr=(e,n)=>$o(wo(e,n),n);var ko=/^\s*Feature:(.*)$/,Po=/^\s*Rule:(.*)$/,Fo=/^\s*Scenario:(.*)$/,Mo=/^\s*Example:(.*)$/,Co=/^\s*Background:(.*)$/,Gr=(e,n,o,i,c,u)=>Fo.test(u)||Mo.test(u)?i:ko.test(u)?n:Po.test(u)?o:Co.test(u)?c:e;var Jr=/^\s*Rule:(.*)$/,de=(e,n)=>({index:n,rule:e,tags:[],scenarios:[],...e&&{uuid:k(e,n)}}),Kr=(e,n,o,i)=>{if(!Jr.test(o))return n;let c=j(o,Jr,1);return n.rule?n=de(c,i):n.rule=c,!n.index&&(n.index=i),!n.uuid&&(n.uuid=k(n.rule,i)),n.whitespace=N(o),!e.rules.includes(n)&&e.rules.push(n),n};var Vr=(e,n,o,i)=>{e.errors=e.errors||[],e.errors.push({type:n,index:o,content:i||`Failed to parse ${n}`})};var Qr=/^\s*Feature:(.*)$/,jo=/\s*Feature:(.*)/,he=(e,n,o)=>({index:o,content:n,feature:e,tags:[],rules:[],empty:[],reason:[],comments:[],scenarios:[],...e&&{uuid:k(e,o)}}),Yr=(e,n,o,i,c)=>{var y,A;if(!Boolean(n.feature||jo.test(i))||(y=n==null?void 0:n.errors)!=null&&y.length)return!((A=n==null?void 0:n.errors)!=null&&A.length)&&Vr(n,"feature",c,"Could not find Feature text in file"),!e.includes(n)&&e.push(n),n;if(!Qr.test(o))return n;let g=j(o,Qr,1);if(!n.feature)return n.feature=g,n.index||(n.index=c),n.uuid||(n.uuid=k(n.feature,c)),!e.includes(n)&&e.push(n),n;let m=he(g,i,c);return e.push(m),m};var Zr=/^\s*Scenario:(.*)$/,tn=/^\s*Example:(.*)$/,Te=(e,n)=>({index:n,scenario:e,tags:[],steps:[],...e&&{uuid:k(e,n)}}),en=(e,n,o,i,c)=>{let u=Zr.test(i),g=tn.test(i);if(!u&&!g)return o;let m=u?j(i,Zr,1):j(i,tn,1);o.scenario?o=Te(m,c):o.scenario=m,!o.index&&(o.index=c),!o.uuid&&(o.uuid=k(o.scenario,c)),o.whitespace=N(i),u||(o.alias="Example");let y=n.uuid&&o.whitespace>n.whitespace?n:e;return!y.scenarios.includes(o)&&y.scenarios.push(o),o};var Lo=/^\s*Background:(.*)$/,xe=(e,n)=>({index:n,steps:[],background:e,...e&&{uuid:k(e,n)}}),rn=(e,n,o,i,c)=>{if(!Lo.test(i))return o;let u=n.uuid?n:e,g=`${u.uuid}-background`;return o.background?o=xe(g,c):o.background=g||"",!o.index&&(o.index=c),!o.uuid&&(o.uuid=k(o.background,c)),o.whitespace=N(i),u.background=o,o};var sn=b(R());var nn=/^\s*@(.*)$/,Do=/^\s*As (.*)$/,on=/^\s*#(.*)$/,Io=/^\s*I want (.*)$/,vo=/^\s*So that (.*)$/,Xo=/^\s*In order (.*)$/,No=[{regex:Do,key:"perspective"},{regex:Io,key:"desire"},{regex:vo,key:"reason"},{regex:Xo,key:"reason"}],Wo=(e,n,o)=>{if(!n)return;let i=(0,sn.eitherArr)(e.reason,[e.reason]);i.push({content:n,index:o}),e.reason=i},an=(e,n,o)=>{let i=!1;return No.reduce((c,u)=>{if(c)return c;let g=u.regex.test(n);return!i&&g&&(i=!0),g&&(u.key==="reason"?Wo(e,j(n,u.regex,0),o):e[u.key]={content:j(n,u.regex,0),index:o})},!1),i},pn=(e,n,o)=>{if(!nn.test(o))return!1;let i=e!=null&&e.background?n:e,c=j(o,nn,0);return i.tags=(i.tags||[]).concat(c.split(" ")),!0},cn=(e,n,o)=>{if(!on.test(n))return!1;let i=n.match(on)[0];return e.comments.push({content:i,index:o}),!0},un=(e,n,o)=>n.trim().length?!1:(e.empty.push({content:n,index:o}),!0);var Bo=/\r?\n/g,Pt=function(e,n){n=n||this&&this.world||ln.noOpObj;let o=[],c=qr((e||"").toString(),n).split(Bo),u=!1,g=de(!1),m=Te(!1),y=xe(!1),A=he(!1,e),T=A;return c.reduce((_,d,E)=>{var z;return u||(A=Yr(_,A,d,e,E),(z=A==null?void 0:A.errors)!=null&&z.length&&(u=!0),u||un(A,d,E)||cn(A,d,E)||an(A,d,E))||(g=Kr(A,g,d,E),m=en(A,g,m,d,E),y=rn(A,g,y,d,E),!(T!=null&&T.feature)&&Br(T,c,d,E))||(T=Gr(T,A,g,m,y,d),pn(T,A,d)),_},o)};var mn=function(e){return this.steps.register([e])};var ut=b(R());var{SPEC_RESULT_LOG:gn,LOG_JEST_SPEC_ENV:Uo}=C;var Ft=e=>{let n=new Date().getTime();(0,ut.get)(process,`env.${Uo}`)&&process.stdout.write([gn,JSON.stringify({...e,timestamp:n}),gn].join(""))},fn=e=>{let n=(0,ut.get)(e,"description"),o=n?n.startsWith("Scenario >")?"Scenario":n.startsWith("Background >")?"Background":n.startsWith("Rule >")?"Rule":"Feature":"Feature";return{type:o.toLowerCase(),...o!=="Feature"&&{description:n.replace(`${o} >`,`${o}:`)}}},U=(e,n)=>n?ut.noOp:globalThis[e]||yr(e),Ho=e=>{let n=[],o=e.describe;return e.describe=(...i)=>{let c=o.apply(null,i);return n.push(c),c},{suiteStarted:i=>{Ft({...i,...fn(i),action:"start"})},specStarted:i=>{Ft({...i,type:"step",action:"start"})},specDone:i=>{if(Ft({...i,type:"step",action:"end"}),i.status!=="failed")return;let c=n.find(u=>u.children.find(g=>g.result===i));c&&c.children.map(u=>u.disable())},suiteDone:i=>{Ft({...i,...fn(i),action:"end"})}}},dn=e=>{var o;if(!le)return;let n=Cr().getEnv();n&&n.describe&&((o=n==null?void 0:n.addReporter)==null||o.call(n,Ho(n)))};var F=b(R()),ye=(e,n)=>`${(0,F.capitalize)(n)} > ${e}`,Tn=(e,n)=>(0,F.isStr)(e)?Pt(e,n):(0,F.isObj)(e)?[e]:(0,F.isArr)(e)?e.reduce((o,i)=>o.concat(Tn(i,n)),[]):Rr(),zo=async(e,n,o)=>{U("test",o)(`${(0,F.capitalize)(n.type)} ${n.step}`,async()=>await e.resolve(n.step))},xn=(e,n,o,i)=>{let c=U("describe",i),u=[];return c(n,()=>{let g=e.steps.map(m=>zo(o,m,i));Promise.all(g)}),u},yn=(e,n,o,i)=>{let c=[];return o&&c.push(...An(e,n.scenario,o,i)),c.concat(xn(n,ye(n.scenario,"Scenario"),e,i))},An=(e,n,o,i)=>xn(o,ye(n,"Background"),e,i),qo=(e,n,o,i)=>{let c=[];return describe(`Rule > ${n.rule}`,()=>{o&&c.push(...c.concat(An((void 0).steps,n.rule,o,i))),c.push(...n.scenarios.map(u=>yn(e,u,n.background,i))),Promise.all(c)}),c},Go=e=>(0,F.isStr)(e)&&e.match(/[@]\w*/g),hn=(e="",n=[],o={})=>{let{name:i,tags:c}=o,u=(0,F.isStr)(c)?Go(c):(0,F.eitherArr)(c,[]),g=!i||e.includes(i),m=!u.length||u.every(y=>n.includes(y));return g&&m},Jo=(e,n={})=>e.reduce((o,i)=>{if(hn(i.feature,i.tags,n))return o.push(i),o;let u=i.scenarios.filter(g=>hn(g.scenario,[...g.tags||[],...i.tags||[]],n));return u.length&&o.push({...i,scenarios:u}),o},[]),Mt=class{constructor(n,o,i){!n&&Ar(),!o&&throwMissingHooks(),this.steps=n,this.hooks=o,this._world=i}getFeatures=(n,o)=>{let i=Tn(n,this._world);return Jo(i,o)};run=async(n,o=F.noOpObj)=>{let i=this.run.PARKIN_TEST_MODE;dn(i);let c=U("describe",i),u=U("beforeAll",i),g=U("afterAll",i),m=U("beforeEach",i),y=U("afterEach",i),A=this.getFeatures(n,o);if(!A.length)return!1;let T=await A.map(async _=>{let d=[];return u(this.hooks.getRegistered("beforeAll")),g(this.hooks.getRegistered("afterAll")),m(this.hooks.getRegistered("beforeEach")),y(this.hooks.getRegistered("afterEach")),c(ye(_.feature,"Feature"),()=>{d.push(..._.rules.map(E=>qo(this.steps,E,_.background,i))),d.push(..._.scenarios.map(E=>yn(this.steps,E,_.background,i))),Promise.all(d)}),d});return await Promise.all(T),!0}};var Ae=b(R()),P=(e,n,o)=>{(0,Ae.exists)(o)?(0,Ae.exists)(e[o])?e.splice(o,0,n):e[o]=n:e.push(n)};var Re=b(R()),{FEATURE_META:Ko}=C,Rn=(e,n)=>{Ko.map(o=>{switch(o){case"feature":P(e,`${"Feature"}: ${n[o]}`,n.index);break;case"comments":let i=n[o];i&&(0,Re.eitherArr)(i,[i]).map(u=>P(e,u.content,u.index));break;case"reason":case"desire":case"perspective":let c=n[o];c&&(0,Re.eitherArr)(c,[c]).map(u=>P(e,`  ${u.content}`,u.index));break}})};var Sn=b(R()),H=(e,n,o="")=>{(0,Sn.isArr)(n)&&n.length&&P(e,`${o}${n.join(" ")}`)};var bn=(e,n)=>{var o,i;(o=n==null?void 0:n.empty)!=null&&o.length&&((i=n==null?void 0:n.empty)==null||i.forEach(c=>P(e,c.content,c.index)))};var Ct=b(R()),jt=(e,n)=>{(0,Ct.isArr)(n.steps)&&n.steps.length&&n.steps.map(o=>{P(e,`${o.whitespace||"    "}${(0,Ct.capitalize)(o.type)} ${o.step}`,o.index)})};var Lt=(e,n)=>{n.scenarios&&n.scenarios.map(o=>{let i=o.whitespace||"  ",c=o.alias||"Scenario";H(e,o.tags,i),P(e,`${i}${c}: ${o.scenario}`,o.index),jt(e,o)})};var Dt=(e,n)=>{let{background:o}=n;if(!o)return;let i=o.whitespace||"  ";H(e,o.tags,i),P(e,`${i}${"Background"}:`,o.index),jt(e,o)};var On=(e,n)=>{n.rules&&n.rules.map(o=>{let i=o.whitespace||"  ";H(e,o.tags,i),P(e,`${i}${"Rule"}: ${o.rule}`,o.index),Dt(e,o),Lt(e,o)})};var Se=b(R()),Vo=(e,n,o)=>{let i=e[o+1],c=e[o-1],u=(0,Se.exists)(i)?i:c;if(!u)return`${n}
`;let g=n.split("#").pop();return`${Array(u.length-u.trimStart().length).join(" ")} # ${g}
`},_n=e=>Array.from(e,(n,o)=>(0,Se.exists)(n)?n.startsWith("#")?Vo(e,n,o):`${n}
`:`
`).join("").trim();var It=b(R());var En=e=>(0,It.eitherArr)(e,[e]).map(n=>{let o=[];return!(0,It.isObj)(n)&&Or(n),H(o,n.tags),Rn(o,n),bn(o,n),Dt(o,n),On(o,n),Lt(o,n),_n(o)});var wn={feature:En};var D=b(R()),vt=class{#t=!1;steps;hooks;parse;runner;run;matcher;world;assemble;paramTypes;Given;When;Then;And;But;constructor(n,o){(0,D.isObj)(n)&&this.init(n,o)}init=(n=D.noOpObj,o,i=!0)=>{if(this.#t)return i&&console.warn("This instance of parkin has already been initialized!");(0,D.isObj)(n.$alias)||(n.$alias={}),this.#t=!0,this.world=n,this.steps=new wt(this.world),this.hooks=new $t(this.world,this),this.runner=new Mt(this.steps,this.hooks,this.world),this.run=this.runner.run,this.parse={feature:Pt.bind(this),definition:mn.bind(this)},this.assemble=wn,this.paramTypes={register:bt},this.matcher=new Et,(0,D.isObj)(o)&&this.registerSteps(o),this.steps.types.map(c=>{this[(0,D.capitalize)(c)]=(u,g,m)=>this.steps.register(`_${c}`,c,u,g,m)})};registerSteps=n=>{Object.entries(n).map(([o,i])=>Object.entries(i).map(([c,u])=>this.steps[(0,D.capitalize)(o)](c,...(0,D.eitherArr)(u,[u]))))}},Qo=new vt;0&&(module.exports={PKInstance,Parkin});
//# sourceMappingURL=index.js.map
