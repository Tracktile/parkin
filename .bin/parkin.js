#! /usr/bin/env node
var Fn=Object.create;var sr=Object.defineProperty;var jn=Object.getOwnPropertyDescriptor;var Mn=Object.getOwnPropertyNames;var Pn=Object.getPrototypeOf,Cn=Object.prototype.hasOwnProperty;var Dn=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var Bn=(t,n,o,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let p of Mn(n))!Cn.call(t,p)&&p!==o&&sr(t,p,{get:()=>n[p],enumerable:!(i=jn(n,p))||i.enumerable});return t};var w=(t,n,o)=>(o=t!=null?Fn(Pn(t)):{},Bn(n||!t||!t.__esModule?sr(o,"default",{value:t,enumerable:!0}):o,t));var b=Dn((me,ar)=>{(function(t,n){typeof me=="object"&&typeof ar<"u"?n(me):typeof define=="function"&&define.amd?define(["exports"],n):n((t=typeof globalThis<"u"?globalThis:t||self).jsutils={})})(me,function(t){"use strict";let n={SHOULD_LOG:!0,SHOULD_THROW:!1,LOG_PREFIX:null},o=()=>!0,i=(e,r={},s={})=>{let{logs:a=n.SHOULD_LOG,throws:c=n.SHOULD_THROW,prefix:l=n.LOG_PREFIX}=s,g=Object.entries(e).map(([$,V])=>p($,V,r[$]||r.$default||o)),{success:f,cases:R}=g.reduce(($,V)=>u($,V,{logs:a,throws:c,prefix:l}),{success:!0,cases:{}});return[f,R]};i.setOptions=({logs:e,throws:r,prefix:s})=>{e!==void 0&&(n.SHOULD_LOG=e),r!==void 0&&(n.SHOULD_THROW=r),s!==void 0&&(n.LOG_PREFIX=s)},i.resetOptions=()=>{n.SHOULD_LOG=!0,n.SHOULD_THROW=!1,n.LOG_PREFIX=null};let p=(e,r,s)=>{let a=s(r),c=!s.name||s.name===e||s.name==="$default"?s.toString():s.name;return{success:a,key:e,value:r,validator:s,reason:a?null:[`Argument "${e}" with value `,r,` failed validator: ${c}.`]}},u=(e,r,{logs:s,throws:a,prefix:c})=>(!r.success&&h(r,s,a,c),{success:e.success&&r.success,cases:{...e.cases,[r.key]:r}}),h=(e,r,s,a)=>{let c=a?[a,...e.reason]:e.reason;if(s)throw new Error(c.join());r&&console.error(...c)},d=e=>Array.isArray(e),y=e=>{let r=new Map;for(let a=0;a<e.length;a++){var s;let c=e[a],l=(s=r.get(c))!==null&&s!==void 0?s:0;r.set(c,l+1)}return r},S=(e,r)=>{if(e.size!==r.size)return!1;for(let[s,a]of e)if(r.get(s)!==a)return!1;return!0},T=e=>typeof e=="object"&&!Array.isArray(e)&&e!==null,A=e=>d(e)?e:[e],m=e=>typeof e=="function",C=e=>(Object.freeze(e),Object.getOwnPropertyNames(e).map(r=>{e.hasOwnProperty(r)&&e[r]!==null&&(typeof e[r]=="object"||m(e[r]))&&!Object.isFrozen(e[r])&&C(e[r])}),e),le=Object.freeze({}),L=C({content:{}}),Rn=C([]),ne=e=>e==e&&e!=null,At=(e,r,s)=>{for(let a=0;a<e.length;a++){let c=e[a];d(c)?At(c,r,s):s.exists&&!ne(c)||s.truthy&&!c||r.push(c)}return s.mutate?(Object.assign(e,r).splice(r.length),e):r},wt=(e,r)=>At(e,[],T(r)?r:le),Rt=(e,r)=>{if(d(r)){let[s,...a]=r;return s(e,...a)}return m(r)?r(e):(console.error("Pipeline expected either a function or an array (for function expressions). Found "+typeof r),e)},Be=(e,...r)=>r.reduce((s,a)=>Rt(s,a),e),x=e=>typeof e=="string",kt=(e,r)=>{if(!x(e)||!m(r))return e;let s="";for(let a of e)s+=r(a);return s},Ot=e=>e===e.toLowerCase(),$t=e=>e===e.toUpperCase(),_t=(e,r,s=["-","_"," "])=>{if(!x(e))return e;let a=l=>s.some(g=>g===l),c="_";return kt(e,l=>a(l)?(c=r,r):$t(l)&&Ot(c)&&!a(c)?(c=l,r+l):(c=l,l))},de=(e,r=!0)=>{if(!x(e)||!e[0])return e;let s=r?e.slice(1).toLowerCase():e.slice(1);return`${e[0].toUpperCase()}${s}`},vt=e=>{let r=e.indexOf(".")===0?e.slice(1):e;return r.indexOf(".")===r.length-1?r.slice(0,-1):r},Le=e=>e&&vt(e).replace(/[-_]/gm," ")||e,It=(e,r)=>e&&Le(e).split(/[\s_-]/gm).reduce((s,a,c)=>a?s+=(c>0||r)&&de(a)||a.toLowerCase():s,"")||e,q=e=>e==null?"":x(e)?e:JSON.stringify(e),kn=/[A-Z]/g,On=/^ms-/,We={},$n=e=>"-"+e.toLowerCase(),z=e=>typeof e=="number"&&e!=e,O=e=>typeof e=="number"&&!z(e),Ne=e=>O(e)&&e>=0,Et=e=>x(e)&&e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")||e,E=e=>typeof e=="object"&&e!==null,Xe=(e,r,s,a)=>{let c=e;if(!E(e)||!e||!r)return s!=="set"&&a||void 0;let l=d(r)?Array.from(r):r.split("."),g=l.pop(),f,R;for(;f=l.shift();){let $=e[f];if(E($)||m($)?e=$:(s==="set"?e[f]={}:R=!0,e=e[f]),R)return a}return s==="get"?g in e?e[g]:a:s==="unset"?delete e[g]:(e[g]=a)&&c||c},oe=(e,r,s)=>Xe(e,r,"get",s),Ft=(e,r,s="")=>{r=E(r)&&r||{};let a=Ft.regex||/\${(.*?)\}/g;return x(e)?e.replace(a,(c,l)=>{let g=(l||c.substr(2,c.length-3)).trim(),f=oe(r,g,s);return m(f)?f(r,g,s):f}):console.error("template requires a string as the first argument")||e},_n=['"',"'"],Ge=e=>{if(!x(e))return;let r="";for(let s of e)r=s+r;return r},jt=(e,r,s)=>s.map(a=>e.indexOf(a,r)).sort().find(a=>a>=0),Mt=(e,r,s=[" "])=>{let a=jt(e,r,s);return e.substring(r,a===-1?e.length:a)},he=e=>typeof e=="boolean",He=e=>e==="false"||e==="true",Pt=e=>he(e)?q(e):e&&e!=="false"&&e!=="0"?"true":"false",Ct=e=>Boolean(e||e===""||e===0),Ue=e=>He(e)?e==="true":Pt(e)==="true",se=e=>q(e).replace(/([^.\d])/gm,""),qe=e=>O(e)?e:e&&!z(e)&&Number(se(e))||0,Dt=e=>x(e)||O(e)||he(e),ze=(e,r)=>{let[s]=i({x:e,y:r},{$default:Dt});return s?x(e)?e.localeCompare(r):e-r:null},Je=e=>e,Bt=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),Ve=e=>{let r=function(...s){return e instanceof r||oe(e.prototype,"constructor.name")?new e(...s):e.apply(e,s)};for(let s in e)e.hasOwnProperty(s)&&(r[s]=e[s]);return Object.defineProperty(r,"name",{value:e.name,configurable:!0}),r.toString=()=>e.toString(),r},D=(e,r=new WeakMap)=>{if(Object(e)!==e)return e;if(e instanceof Set)return new Set(e);if(r.has(e))return r.get(e);if(d(e))return e.map(a=>D(a));if(m(e))return Ve(e);let s=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e.constructor?null:Object.create(null);return s===null?Lt(e):(r.set(e,s),e instanceof Map?Array.from(e,([a,c])=>s.set(a,D(c,r))):Object.assign(s,...Object.keys(e).map(a=>({[a]:D(e[a],r)}))))},Lt=e=>{if(!e)return e;let r=Object.getPrototypeOf(e),s=Object.getOwnPropertyDescriptors(e);for(let[c,l]of Object.entries(s))l.value&&(s[c].value=D(l.value));let a=Object.create(r,s);return Object.isFrozen(e)&&Object.freeze(a),Object.isSealed(e)&&Object.seal(a),a},Wt=e=>e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,Wt),Nt=e=>Object.prototype.toString.call(e).slice(8,-1),Xt=(e,...r)=>{if(!r.length)return null;for(let s of r){if(!d(s)){console.error(`Matching case must be an entry (a 2-element array). Found: ${Nt(s)}`,s);break}let[a,c]=s;if(m(a)&&a(e)||a===e)return c}return null};Xt.default=()=>!0;let Gt=e=>T(e)?Object.keys(e).length===0:d(e)?e.length===0:x(e)?e.trim().length===0:!!O(e)&&e<1,Qe=(e,r)=>{let[s]=i({arr:e,comparator:r},{arr:d,$default:m});return s&&e.length?e.reduce((a,c)=>r(a,c)>0?a:c):null},Ht=e=>d(e)?e.filter((r,s,a)=>a.indexOf(r)==s):e,Ut=(e,r)=>{if(!r)return Ht(e);let{unique:s}=e.reduce((a,c)=>{let l=r(c);return!a.set.has(l)&&a.unique.push(c),a.set.add(l),a},{unique:[],set:new Set});return s},qt=(e,r=!0)=>E(e)?Object.keys(e).reduce((s,a)=>{let c=e[a];return c==null||(s[a]=r&&E(c)?qt(c):c),s},T(e)&&{}||[]):console.error("cleanColl requires a collection as the first argument")||e,Ye=(e,r,s)=>Xe(e,r,"set",s),zt=Array.isArray,Jt=Object.keys,vn=Object.prototype.hasOwnProperty,Ze=(e,r)=>{if(e===r)return!0;if(!e||!r||typeof e!="object"||typeof r!="object")return e!=e&&r!=r;let s=zt(e),a=zt(r),c,l,g;if(s&&a){if(l=e.length,l!=r.length)return!1;for(c=l;c--!=0;)if(!Ze(e[c],r[c]))return!1;return!0}if(s!=a)return!1;let f=e instanceof Date,R=r instanceof Date;if(f!=R)return!1;if(f&&R)return e.getTime()==r.getTime();let $=e instanceof RegExp,V=r instanceof RegExp;if($!=V)return!1;if($&&V)return e.toString()==r.toString();let tt=Jt(e);if(l=tt.length,l!==Jt(r).length)return!1;for(c=l;c--!=0;)if(!vn.call(r,tt[c]))return!1;for(c=l;c--!=0;)if(g=tt[c],!Ze(e[g],r[g]))return!1;return!0},Vt=e=>e&&x(e)?He(e)?Ue(e):O(e)?qe(e):(()=>{try{return JSON.parse(e)}catch{return e}})():e,Ke,ae="dir",J="type",In=["error","info","log","dir","warn"],Qt=(...e)=>{if(!e.length)return;let r=e.length===1?ae:e.pop();(Ke||r==="error")&&(typeof e[0]=="string"&&(J==="type"?e[0]=`[ ${r.toUpperCase()} ] ${e[0]}`:J&&(e[0]=`${J} ${e[0]}`)),In.indexOf(r)!==-1?console[r](...e):console[ae](...e,r))},Yt=(e,r)=>{e&&Object.entries(e).map(([s,a])=>{r&&r.indexOf(s)!==-1||(typeof a=="object"&&Yt(a),e[s]=void 0,delete e[s])})},Zt=(...e)=>e.reduce((r,s)=>{let a=D(s);return d(a)?[...d(r)&&r||[],...a]:T(a)?Object.entries(a).reduce((c,[l,g])=>({...c,[l]:m(g)?Ve(g):E(g)&&l in c?Zt(c[l],g):D(g)}),r):r},d(e[0])&&[]||{}),Kt=e=>d(e)&&e.length===2&&(O(e[0])||x(e[0])),er=(e,r)=>{if(!d(e)&&!T(e))return console.error(e,"Expected array or object for obj. Found "+typeof e),e;if(!m(r))return console.error("Expected function for cb. Found "+typeof r),e;let s=Object.entries(e),a=d(e)?[]:{};return s.reduce((c,[l,g])=>{let f=r(l,g);return Kt(f)?Ye(c,f[0],f[1]):(console.error(`Callback function must return entry. Found: ${f}. Using current entry instead.`),Ye(c,l,g))},a)},ie=(e,r,s={})=>T(e)&&m(r)&&Object.entries(e).reduce((a,[c,l])=>r(c,l,a),s)||s,et=e=>{if(!m(e))throw"Argument must be a function";return(...r)=>new Promise((s,a)=>m(r[r.length-1])?(r.pop(),r.push((...c)=>c&&c[0]?a(...c):s(...c)),e(...r)):s(e(...r)))},En=Array.from(["caller","callee","arguments","apply","bind","call","toString","__proto__","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","valueOf","toLocaleString"]).concat(Object.getOwnPropertyNames(Object.prototype)).reduce((e,r)=>(e[r]=!0,e),{}),tr=e=>{if(!e.__IS_PROMISIFIED__){for(let r of Object.getOwnPropertyNames(e))if(!(r.indexOf("Async")!==-1||e[`${r}Async`])&&!En[r])if(m(e[r]))e[`${r}Async`]=et(e[r]);else{let s=Object.getOwnPropertyDescriptor(e,r).get;m(s)&&(e[`${r}Async`]=et(s))}e.__IS_PROMISIFIED__=!0}return e},rr=e=>Boolean(e&&e instanceof RegExp),nr=e=>rr(e)?e.source:x(e)?e:null,or=e=>{let r={},s=e.split("?"),a=s[s.length-1];if(!a)return r;let c=a.split("&");return c.length&&c.map(l=>{let g=l.split("=");if(g.length<=1)return r;let f=[g.shift(),g.join("=")];if(f.length===2){let R=decodeURIComponent(f[1]).split(",");if(R&&R.length>1)r[f[0]]=R;else if(f[0]in r){let $=r[f[0]];r[f[0]]=d($)?$.push(decodeURIComponent(f[1])):[$,decodeURIComponent(f[1])]}else r[f[0]]=decodeURIComponent(f[1])}}),r};t.applyToCloneOf=(e,r)=>{let s;if(e||(s="object (Argument 1) in applyToCloneOf, must be defined!"),T(e)||(s="object (Argument 1) in applyToCloneOf, must be an object!"),r||(s="mutator (Argument 2) in applyToCloneOf, must be defined!"),m(r)||(s="mutator (Argument 2) arg in applyToCloneOf, must be a function!"),s)return console.warn(s)||e;let a=D(e);return r(a),a},t.applyToFunc=Rt,t.areCountMapsEqual=S,t.areFrequencyEqual=(e,r)=>{let[s]=i({arr:e,otherArr:r},{$default:d});if(!s)return null;if(e===r)return!0;if(e.length!==r.length)return!1;let a=y(e),c=y(r);return S(a,c)},t.areSetEqual=(e,r)=>{let[s]=i({arr:e,otherArr:r},{$default:d});if(!s)return null;if(e===r)return!0;let[a,c]=e.length>r.length?[e,r]:[r,e],l=new Set(c);for(let g=0;g<a.length;g++){let f=a[g];if(!l.has(f))return!1}return!0},t.buildElementCountMap=y,t.buildPath=(...e)=>e.reduce((r,s)=>{let a=toStr(s);return`${r}${a&&"/"+a||""}`},"").replace(/([^:\/]|^)\/{2,}/g,"$1/"),t.camelCase=It,t.camelCasePath=e=>{let r=e.split(".").map((s,a)=>a>0?de(s,!1):s);return r.length>1?r.join(""):e},t.capitalize=de,t.checkCall=(e,...r)=>m(e)?e(...r):void 0,t.cleanColl=qt,t.cleanStr=Le,t.clearObj=Yt,t.cloneArr=e=>Array.from([...d(e)&&e||T(e)&&Object.entries(e)||[]]),t.cloneFunc=Ve,t.cloneJson=e=>{try{return JSON.parse(JSON.stringify(e))}catch(r){return Qt(r.message,"error"),null}},t.cloneObjWithPrototypeAndProperties=Lt,t.compareTo=ze,t.complement=e=>{let[r]=i({predicate:e},{predicate:m});return r?(...s)=>!e(...s):null},t.containsStr=(e,r,s)=>(e=!x(e)&&q(e)||e,r=!x(r)&&q(r)||r,e.indexOf(r,s)!==-1),t.convertToStrBool=Pt,t.debounce=(e,r=250,s=!1)=>{let a;return function(...c){if(!m(e))return null;let l=this,g=s&&!a;return clearTimeout(a),a=setTimeout(()=>{a=null,!s&&e.apply(l,c)},r),g?m(e)&&e.apply(l,c):void 0}},t.deepClone=D,t.deepEqual=Ze,t.deepFreeze=C,t.deepMerge=Zt,t.delimitString=_t,t.doIt=(...e)=>{let r=e.slice(),s=r.shift(),a=r.shift(),c=r.pop();if(!O(s)||!m(c))return[];let l=new Array(s),g=[];for(let f=0;f<l.length;f++){let R=c.call(a,f,...r);if(R===!1)break;g.push(R)}return g},t.either=(e,r,s)=>m(s)?s(e,r)&&e||r:Ct(e)&&e||r,t.eitherArr=(e,r)=>d(e)?e:r,t.eitherFunc=(e,r)=>m(e)&&e||r,t.eitherObj=(e,r)=>T(e)&&e||r,t.eitherStr=(e,r)=>x(e)&&e||r,t.ensureArr=A,t.equalsNaN=z,t.everyEntry=(e,r)=>e?T(e)?m(r)?Be(e,Object.entries,s=>s.every(([a,c])=>r(a,c))):(console.error(`Argument 'predicate' passed into everyEntry must a function. Found: ${r}`),!1):(console.error(`Argument obj ${e} must be an object.`),!1):(console.error(`everyEntry expects argument obj [${e}] to be defined.`),!1),t.exists=ne,t.filterObj=(e,r)=>e&&(T(e)?m(r)?ie(e,(s,a,c)=>(r(s,a)&&(c[s]=a),c),{}):(console.error(`Argument 'predicate' passed into filterObject must a function. Found: ${r}`),e):(console.error(`Object ${e} was not an object. It must be for filterObject`),e)),t.findExtrema=Qe,t.findMax=(e=[],r=Je)=>Qe(e,(s,a)=>ze(r(s),r(a))),t.findMin=(e=[],r=Je)=>Qe(e,(s,a)=>ze(r(a),r(s))),t.flatArr=wt,t.flatMap=(e,r)=>{let[s]=i({arr:e,mapFn:r},{arr:d,mapFn:m});return s?e.reduce((a,c)=>{let l=r(c);return d(l)?l.map(g=>a.push(g)):a.push(l),a},[]):e},t.flatUnion=(...e)=>{let r=e.pop(),s={exists:!0},a=m(r)?r:e.push(r)&&void 0;return e.reduce((c,l)=>d(l)?Ut(wt([...c,...l],s),a):c,[])},t.get=oe,t.getNearestDelimiterIndex=jt,t.getNums=se,t.getRegexSource=nr,t.getURLParam=e=>{var r,s,a;let[c]=i({paramKey:e},{paramKey:x});if(!c)return null;let l=typeof document<"u"?document:null,g=l==null||(r=l.location)===null||r===void 0?void 0:r.search;return x(g)&&(s=(a=or(g))===null||a===void 0?void 0:a[e])!==null&&s!==void 0?s:null},t.getWordEndingAt=(e,r,s=[" "])=>{let a=Ge(e),c=e.length-r;return Ge(Mt(a,c,s))},t.getWordStartingAt=Mt,t.hasDomAccess=()=>{try{return!(typeof window>"u"||!window.document||!window.document.createElement)}catch{return!1}},t.hasOwn=Bt,t.hashString=(e,r)=>{if(!x(e)||e.length==0)return 0;e=e.split("").reverse().join("");let s=0;for(let a=0;a<e.length;a++)s=(s<<5)-s+e.charCodeAt(a),s=`${Math.abs(s&s)}`;return Ne(r)?s.slice(0,r):s},t.hyphenator=e=>{if(We.hasOwnProperty(e))return We[e];let r=e.replace(kn,$n);return We[e]=On.test(r)?"-"+r:r},t.identity=Je,t.isArr=d,t.isArrMap=e=>{if(!T(e))return!1;let r=Object.values(e);return Ue(r.length&&r.every(d))},t.isBool=he,t.isColl=E,t.isEmail=e=>!e||!x(e)?!1:Boolean(/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)),t.isEmpty=Gt,t.isEmptyColl=e=>d(e)?e.length===0:E(e)&&Object.getOwnPropertyNames(e).length===0,t.isEntry=Kt,t.isFloat=e=>O(e)&&e%1!=0,t.isFunc=m,t.isInt=e=>O(e)&&e%1==0,t.isLowerCase=Ot,t.isNegative=e=>O(e)&&e<0,t.isNonNegative=Ne,t.isNum=O,t.isObj=T,t.isOrderable=Dt,t.isPhone=e=>!e||!x(e)?!1:Boolean(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(e))&&e.replace(/\D/g,"").length<11,t.isPositive=e=>O(e)&&e>0,t.isQuoted=(e,r=_n)=>x(e)&&r.some(s=>e.startsWith(s)&&e.endsWith(s)),t.isRegex=rr,t.isSame=(e,r)=>e===r?e!==0||1/e==1/r:e!=e&&r!=r,t.isStr=x,t.isStrBool=He,t.isUpperCase=$t,t.isUrl=e=>Boolean(/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/.test(e)),t.isUuid=e=>!e||!x(e)?!1:Boolean(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(e)),t.isValidDate=e=>!isNaN((e instanceof Date&&e||new Date(e)).getTime()),t.isValidUrl=e=>/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-/]))?/.test(e),t.joinRegex=(...e)=>{let[r,s]=(c=>{if(d(c[0]))return[c[0],c[1]];let l=c[c.length-1],g=x(l)?l:void 0;return[g?c.splice(0,c.length-1):c,g]})(e),a=r.reduce((c,l)=>{let g=nr(l);return g?c===""?g:`${c}|${g}`:c},"");return new RegExp(`(${a})`,s)},t.jsonEqual=(e,r)=>{try{return JSON.stringify(e)===JSON.stringify(r)}catch{return!1}},t.keyMap=(e,r)=>d(e)&&e.reduce((s,a)=>{if(!x(a))return s;let c=r&&a.toUpperCase()||a;return s[c]=c,s},{})||{},t.limbo=e=>e&&m(e.then)?e.then(r=>[null,r]).catch(r=>[r,void 0]):[new Error("A promise or thenable is required as the first argument!"),null],t.logData=Qt,t.mapColl=(e,r)=>m(r)&&E(e)?Object.keys(e).map(s=>r(s,e[s],e)):d(e)?[]:{},t.mapEntries=er,t.mapFind=(e,r,s=ne)=>{let[a]=i({coll:e,mapper:r,test:s},{coll:E,$default:m});if(a)return T(e)?((c,l,g)=>{let f=0;for(let R in c){if(!c.hasOwnProperty(R))continue;let $=l(c[R],R,f);if(g($,R,f))return $;f++}return null})(e,r,s):((c,l,g)=>{for(let f=0;f<c.length;f++){let R=l(c[f],f,f);if(g(R,f,f))return R}return null})(e,r,s)},t.mapKeys=(e,r)=>T(e)&&m(r)?er(e,(s,a)=>[r(s),a]):e,t.mapObj=(e,r)=>T(e)&&m(r)&&Object.entries(e).map(([s,a])=>r(s,a))||e,t.mapString=kt,t.match=Xt,t.memorize=(e,r,s=1)=>{if(!m(e)||r&&!m(r))return console.error("Error: Expected a function",e,r);let a=function(){let c=a.cache,l=r?r.apply(this,arguments):arguments[0];if(Bt(c,l))return c[l];let g=e.apply(this,arguments);return O(s)&&Object.keys(c).length<s?c[l]=g:a.cache={[l]:g},g};return a.cache={},a.destroy=()=>{r=void 0,a.cache=void 0,a.destroy=void 0,a=void 0},a},t.mod=(e,r)=>(e%r+r)%r,t.noOp=()=>{},t.noOpObj=le,t.noPropArr=Rn,t.noPropObj=L,t.nth=e=>{if(!O(e)&&(!(e=se(e))||(e=qe(e),z(e))))return"";let r=e%100;if(r>=10&&r<=20)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},t.objToQuery=e=>{let r;return ie(e,(s,a,c)=>{if(!a)return c;let l=x(a)||O(a)||he(a)?a:E(a)?d(a)?a.join(","):JSON.stringify(a):null;return l&&(c=r?`${c}&${encodeURIComponent(s)}=${encodeURIComponent(l)}`:`?${encodeURIComponent(s)}=${encodeURIComponent(l)}`,r=!0),c},"")},t.omitKeys=(e={},r=[])=>T(e)&&ie(e,(s,a,c)=>(r.indexOf(s)===-1&&(c[s]=e[s]),c),{})||{},t.omitRange=(e,r,s)=>{let[a]=i({arr:e,startIndex:r,count:s},{arr:d,$default:Ne});if(!a)return e;let c=[...e];return c.splice(r,s),c},t.parseErrorMessage=e=>x(e)&&!Gt(e)?e:T(e)?e.message:null,t.parseJSON=(e,r=!0)=>{try{return JSON.parse(e)}catch(s){return r&&console.error(s.message),null}},t.pickKeys=(e={},r=[])=>T(e)&&r.reduce((s,a)=>(a in e&&(s[a]=e[a]),s),{})||{},t.pipeline=Be,t.plural=e=>e&&e.length&&e[e.length-1]!=="s"?e+"s":e,t.promisify=et,t.promisifyAll=e=>{if(!T(e))return e;tr(e);let r=Object.getPrototypeOf(e);return r&&Object.getPrototypeOf(r)!==null&&tr(r),e},t.queryToObj=or,t.randomArr=(e,r)=>{if(!d(e))return e;let s=r||1,a=[];for(let c=0;c<s;c++)a.push(e[Math.floor(Math.random()*e.length)]);return r?a:a[0]},t.randomizeArr=e=>!d(e)&&e||e.sort(()=>.5-Math.random()),t.reduceColl=(e,r,s)=>m(r)&&E(e)?Object.keys(e).reduce((a,c)=>r(c,e[c],e,a),s):d(e)?[]:{},t.reduceObj=ie,t.removeDot=vt,t.repeat=(e,r,s=!1)=>{if(!r||r<=0)return[];if(!O(r))return console.error("Times argument must be a number"),[];let a=[];for(let c=0;c<r;c++){let l=m(e)?e():s?D(e):e;a.push(l)}return a},t.resetLogs=()=>{Ke=void 0,ae="log",J="type"},t.reverseStr=Ge,t.runSeq=async(e=[],r={})=>{let[s]=i({asyncFns:e},{asyncFns:d});if(!s)return[];let{cloneResults:a=!1,returnOriginal:c=!0}=r,l=[];for(let g of e){let f=m(g)?await g(l.length,a?D(l):l):c?g:void 0;l.push(f)}return l},t.sanitize=Et,t.sanitizeCopy=e=>JSON.parse(Et(JSON.stringify(e))),t.set=Ye,t.setLogs=(e,r,s)=>{Ke=e,ae=r||ae||"log",J=s||J||"type"},t.shallowEqual=(e,r,s)=>{if(s&&(d(s)||x(s))&&(e=oe(e,s),r=oe(r,s)),e===r)return!0;if(!(e&&E(e)&&r&&E(r))||Object.keys(e).length!==Object.keys(r).length)return!1;for(let a in e)if(e[a]!==r[a])return!1;return!0},t.singular=e=>e&&e.length&&e[e.length-1]==="s"?e.slice(0,e.length-1):e,t.snakeCase=e=>_t(e,"_").toLowerCase(),t.softFalsy=Ct,t.someEntry=(e,r)=>e?T(e)?m(r)?Be(e,Object.entries,s=>s.some(([a,c])=>r(a,c))):(console.error(`Argument 'predicate' passed into someEntry must a function. Found: ${r}`),!1):(console.error(`Argument obj ${e} must be an object.`),!1):(console.error(`someEntry expects argument obj [${e}] to be defined.`),!1),t.spaceJoin=(e,r)=>(r=d(r)?r:[r]).reduce((s,a)=>x(a)?`${s?s+" ":""}${a}`.trim():s,x(e)?e:""),t.splitByKeys=(e={},r)=>{if(!r)return[{},{...e}];let s=[{},{}],a=A(r);return T(e)?ie(e,(c,l,g)=>(ne(a.find(f=>ne(f)&&q(f)===c))?g[0][c]=e[c]:g[1][c]=e[c],g),s):s},t.strToType=Vt,t.styleCase=e=>{if(!x(e))return e;let r=It(e);return`${r[0].toLowerCase()}${r.slice(1)}`},t.template=Ft,t.throttle=(e,r=100)=>{let s=!1;return function(...a){if(!s)return s=!0,e.apply(this,a),setTimeout(()=>{s=!1},r)}},t.throttleLast=(e,r,s=100)=>{let a;return function(...c){a&&clearTimeout(a),a=setTimeout(()=>{e.apply(this,c),clearTimeout(a)},s),typeof r=="function"&&r()}},t.timedRun=async(e,...r)=>{let[s]=i({fn:e},{fn:m});if(!s)return[void 0,-1];let a=new Date;return[await e(...r),new Date-a]},t.toBool=Ue,t.toFloat=e=>e&&!z(e)&&parseFloat(O(e)&&e||se(e))||0,t.toInt=e=>e&&!z(e)&&parseInt(O(e)&&e||se(e))||0,t.toNum=qe,t.toObj=(e,r,s)=>d(e)?Object.keys(e).reduce((a,c)=>(a[c]=e[c],a),{}):x(str)?(r=r||"=",s=s||"&",str.split(s).reduce((a,c)=>{let l=c.split(r);return a[l[0].trim()]=Vt(l[1].trim()),a},{})):{},t.toStr=q,t.trainCase=e=>x(e)&&e.split(/(?=[A-Z])|[\s_-]/gm).join("-").toLowerCase()||e,t.trimStringFields=e=>Object.entries(e).reduce((r,[s,a])=>(r[s]=x(a)?a.trim():a,r),e),t.typeOf=Nt,t.uniqArr=Ut,t.uniqArrByReference=Ht,t.unset=(e,r)=>Xe(e,r,"unset"),t.uuid=Wt,t.validFilename=e=>e?!(/[<>:"/\\|?*\u0000-\u001F]/g.test(e)||/^(con|prn|aux|nul|com\d|lpt\d)$/i.test(e)||/^\.\.?$/.test(e)):!1,t.validate=i,t.wait=e=>new Promise(r=>setTimeout(()=>r(!0),e)),t.wordCaps=e=>x(e)?Le(e).split(" ").map(r=>r&&de(r)||"").join(" "):e})});var rt=(p=>(p.beforeAll="beforeAll",p.afterAll="afterAll",p.beforeEach="beforeEach",p.afterEach="afterEach",p))(rt||{}),ge=(u=>(u.given="given",u.when="when",u.then="then",u.and="and",u.but="but",u))(ge||{});var ir=w(b()),_=(0,ir.deepFreeze)({ALIAS_REF:"$$",ALIAS_WORLD_KEY:"$alias",ALIAS_REF_AT_RUNTIME:"$$:",REGEX_VARIANT:"regex",WORLD_REF:"$",WORLD_KEY:"$world",WORLD_AT_RUNTIME:"$:",EXPRESSION_VARIANT:"expression",HOOK_TYPES:Object.keys(rt),STEP_TYPES:Object.keys(ge),FEATURE_META:["feature","perspective","desire","reason","comments"],LOG_JEST_SPEC_ENV:"PARKIN_LOG_JEST_SPEC",SPEC_RESULT_LOG:"------- PARKIN SPEC RESULT LOG -------"});var vr=w(b());var Re=w(b());var j=(t,n,o)=>{let i=t.match(n)[o];return i?i.trim():" "},v=(t,n=1)=>{let o=t&&t.trim()&&t.trim().toLowerCase().replace(/[\s\/\\\(\)\+=_&%\$#@!\*~`\|\?:;"'<>,.{}]/g,"-");return o?`${o}-${t.length}`:`${n}-${n}`},cr=t=>{let n=t.match.toString();return n[0]==="/"&&(n=n.substring(1)),n[0]==="^"&&(n=n.substring(1)),n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1)),n.charAt(n.length-1)==="$"&&(n=n.slice(0,-1)),n.replace(/\(\?:([^\|]+)+\|+([^\)]+)?\)/,"$1")},pr=(t,n)=>n.reduce((o,i)=>!o||i.content===o.content?!1:(i.uuid===o.uuid&&(o.uuid=`${o.uuid}-${o.content.length}`),o),{...t}),fe=t=>t.trim().replace(/^("|')/,"").replace(/("|')$/,""),W=t=>{let n=t.replace(/^\s+/g,""),o=t.length-n.length;return new Array(o).fill(" ").join("")};var k=w(b());var ur=w(b()),ce=/\w*\([^)]*?\)/,Te=/\s*\S*\/\S*\s*/,U=/\s*{(.*?)}\s*/,lr=(0,ur.joinRegex)(U,ce,"g"),nt=/(.*)/,xe=/{|}/g,ye=/"[^"]+"/,be=/'[^']+'/,Se=/-?[0-9]+[.][0-9]+/,Ae=/-?[0-9]+/,dr=/^["]?\$world\.\S+["]?/,hr=/^\$world\./,gr=/(\$:world|\$world)+\.[^"'\s]*/gm,mr=/^["]?\$\$\S+["]?/,fr=/^\$\$/,Tr=/(\$\$:\w+|\$\$\w+)[^"'\s]*/gm;var xr=t=>()=>{throw new Error(`Test method ${t} does not exist on the global scope.
Please ensure ${t} exists before calling the run method!
`)},yr=()=>{throw new Error("Runner class constructor requires an instance of the Steps class")};var br=()=>{throw new Error("Runner class requires feature text when calling the run method")},Sr=t=>{throw new ReferenceError(t)},Ar=t=>{throw new Error(`Cannot register param type "${t}". It already exists!`)},wr=t=>{throw new Error("Assemble feature requires an object matching the feature model spec!")},Rr=t=>{throw new Error(`Can not replace ${t} with value from $world, it does not exist on the world object`)},kr=(t,n)=>{throw new Error([`Expected client hook type to be one of ', ${t}.`,`Found: ${n}`].join(`
`))},Or=(t,n)=>{throw console.error(`Error replacing $world value in feature text. Current match was ${n}`),t},$r=(t,n)=>{throw console.error(`Error replacing $$alias ( $world.$alias ) in feature text. Current match was ${n}`),t};var{WORLD_KEY:Ln,ALIAS_WORLD_KEY:Wn,ALIAS_REF:Nn}=_,Q=(t,n)=>(o,i)=>{let p=o.match(dr),u=o.match(mr);if(!(0,k.isObj)(i)||!p&&!u)return ot(t(o),n);let h=p?(0,k.get)(i,fe(o).replace(`${Ln}.`,"")):(0,k.get)(i,fe(o).replace(`${Nn}`,`${Wn}.`));return(0,k.exists)(h)?ot(h,n):p?Rr(o,i):ot(t(o),n)},ot=(t,n)=>typeof t===n?t:null,N={name:"",regex:"",type:"string",useForSnippets:!0,preferForRegexpMatch:!1,transformer:Q(t=>t,"string")},X={any:{...N,name:"any",regex:nt},word:{...N,name:"word",regex:nt,transformer:Q(t=>(0,k.isQuoted)(t)?void 0:(0,k.toStr)(t),N.type)},float:{...N,name:"float",type:"number",regex:Se,transformer:Q(t=>{let n=parseFloat(t);return(0,k.equalsNaN)(n)?void 0:n},"number")},int:{...N,name:"int",type:"number",regex:Ae,transformer:Q(t=>{let n=parseInt(t);return(0,k.equalsNaN)(n)||t.includes(".")?void 0:n},"number")},string:{...N,name:"string",regex:(0,k.joinRegex)(ye,be),transformer:Q(t=>(0,k.isQuoted)(t)?fe(t):void 0,N.type)}},Y=()=>X,we=(t=k.noOpObj,n=t.name)=>X[n]?Ar(n):(X[n]={...N,...t},X[n].transformer=Q(X[n].transformer,X[n].type),X),_r=(t,n,o)=>t.map((i,p)=>{let u=n[p]||X.any;return(0,k.checkCall)(u.transformer,i,o)}).filter(k.exists);var Z=(t,n)=>{let o=n.match(new RegExp(t.match));return o?{definition:t,match:o.slice(1,o.length).filter(Boolean)}:Re.noOpObj},at=t=>{let n=t.split(/(\(|\))/),[o,,i,,p]=n;return o===""&&p===""?t+"?":o===""?`(${i}|${i}${p})`:p===""?`(${o}|${o}${i})`:`(${o}${p}|${o}${i}${p})`},Xn=t=>{let n=t.input;return(0,Re.getWordEndingAt)(n,t.index)+t[0]},Gn=t=>{let n=Xn(t);return at(n)},it=t=>{let n=Y();return(n[t]||n.any).regex.source},ct=t=>`(${t.trim().replace(/\//g,"|")})`,Hn=(t,n)=>{let[o,i]=n;switch(t){case"parameter":return new RegExp(it(i));case"optional":return new RegExp(Gn(n));case"alternate":return new RegExp(ct(o));default:return null}},st=(t,n="other")=>{let o=t[0],i=o.trimStart(),p=o.length-i.length;return{text:o.trim(),input:t.input,index:t.index+p,regex:Hn(n,t),type:n,...n==="parameter"&&{paramType:o.trim().replace(xe,"")}}},K=t=>{let n=[...t.matchAll(new RegExp(U,"gi"))].map(u=>st(u,"parameter")),o=[...t.matchAll(new RegExp(ce,"gi"))].map(u=>st(u,"optional")),i=[...t.matchAll(new RegExp(Te,"gi"))].map(u=>st(u,"alternate"));return[...n,...o,...i].sort((u,h)=>u.index-h.index)};var Un=(0,vr.joinRegex)(Ae,Se,U,ye,be,"g"),Ir=(t,n)=>{let o=K(n.match),i=[],p,u=0;for(;(p=Un.exec(t))!==null;){let[h,d,...y]=p,S=y.pop(),T=o[u],A=h.trimStart(),m=h.length-A.length;i.push({match:h.trim(),defIndex:T==null?void 0:T.index,index:p.index+m,type:S||(T==null?void 0:T.paramType)||"any"}),u++}return i};var Cr=w(b());var M=w(b()),pt=Boolean(typeof window<"u"),Er=Boolean(typeof global<"u"),qn=Boolean(typeof module=="object"),zn=Boolean(typeof require=="function"),ke=Boolean(Er&&typeof global.jasmine<"u"),Oe=()=>ke?(0,M.checkCall)(()=>global.jasmine):{getEnv:()=>M.noOpObj},Fr=()=>qn?(0,M.checkCall)(()=>module):{exports:{}},jr=()=>zn?(0,M.checkCall)(()=>require):M.noOp,Mr=()=>{try{return pt?(0,M.checkCall)(()=>window):Er?(0,M.checkCall)(()=>global):M.noOpObj}catch{return M.noOpObj}};var ee=w(b());var Jn=t=>pt?t.replace(/[|\\[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"):t.replace(/[|\\[\]^$+*?.]/g,"\\$&"),Pr=(t,n,o)=>{if(!n.test(t))return t;let i=t;return t.replace(n,(...p)=>{let u=p[0].trim(),[h,...d]=i.split(u),y=(0,ee.isFunc)(o)?o(...p):o;i=`${h}${y}${d.join(u)}`}),i},Vn=t=>{let n=Y(),o=[];return{regex:Pr(t,lr,(p,...u)=>{let h=p.trim().replace(xe,""),d=p.match(U),y=p.match(ce);return d&&o.push(n[h]||n.any),d?it(h):y?at(p):p}),transformers:o}},Qn=t=>{let n=[];return{regex:Pr(t,new RegExp(Te,"g"),ct),altIndexes:n}},Yn=t=>{let n=t;return t.startsWith("^")||(n="^"+n),t.endsWith("$")||(n+="$"),{regex:n}},ut=(t,n,o)=>{let i=K(n),p=i.filter(h=>h.type==="parameter").length,u=i.reduce((h,d)=>{let{params:y,textIndex:S,wordMatchIndex:T}=h,A=t.substring(S),m=d.paramType==="word",C=A.match(d.regex),le={0:o[T],index:A.indexOf(o[T])},L=m?le:C;return L?(d.type==="parameter"&&L&&y.push(L[0]),{params:y,textIndex:S+(L&&L.index+L[0].length),wordMatchIndex:T+(m&&1)}):h},{params:[],textIndex:0,wordMatchIndex:0});return p===u.params.length?u.params:null},lt=(t,n)=>{let o=Jn(t.match),{regex:i}=Qn(o),{transformers:p,regex:u}=Vn(i),{regex:h}=Yn(u);return{found:Z({...t,match:h},n),escaped:o,regexAlts:i,transformers:p,regexAnchors:h,regexConverted:u}},$e=(t,n,o)=>{if(t.match===n)return{definition:t,match:[]};let{found:i,transformers:p}=lt(t,n);if(!i||!i.definition||!i.match)return ee.noOpObj;let u=ut(n,t.match,i.match);if(!u)return ee.noOpObj;let h=_r(u,p,o);return h.length!==u.length?ee.noOpObj:{definition:t,match:h}};var{REGEX_VARIANT:Zn}=_,_e=class{constructor(){this.find=dt;this.regex=Z;this.parts=K;this.types=Y;this.stepTokens=Ir;this.extract=ut;this.expression=$e;this.expressionFind=lt;this.register=we}},dt=(t,n,o)=>t.reduce((i,p)=>i.match||!p.match?i:p.variant!==Zn?$e(p,n,o):Z(p,n),Cr.noOpObj);var B=w(b());var{REGEX_VARIANT:Dr,EXPRESSION_VARIANT:Kn,STEP_TYPES:eo}=_,to=t=>{let n=t.variant===Dr?t.match.toString():`"${t.match}"`;return`${(0,B.capitalize)(t.type)}(${n}, ${t.method.toString()})`},ro=function(t,n,o,i,p=B.noOpObj){let u={type:n,meta:p,match:o,method:i,tokens:[],variant:o.toString().indexOf("/")===0?Dr:Kn};u.name=cr(u),u.uuid=v(`${n}-${u.name}`),u.content=to(u);let h=this.list(),d=pr(u,h);return d&&this[t].push(d),d},no=(t,n,o)=>(...i)=>{let p=t[n](...i);return o[n].push(p),p},oo=function(t){let n=this.types.map(i=>(0,B.capitalize)(i)),o=n.reduce((i,p)=>(i[p]=[],i),{});return(0,B.eitherArr)(t,[t]).map(i=>{Function(`return (global, require, module, ${n.join(",")}) => {
          return (function(global) { ${i} }).call(global, global)
        }`)()(Mr(),jr(),Fr(),...n.map(p=>no(this,p,o)))}),o},so=t=>t.types.reduce((n,o)=>n.concat(t[`_${o}`]),[]),ve=class{constructor(n={$alias:{}}){this.types=eo;this.list=()=>so(this);this.typeList=()=>this.types.reduce((n,o)=>{let i=`_${o}`;return n[i]=[...this[i]],n},{});this.match=n=>{let o=this.list(),i=dt(o,n,this._world);return!i.match||!i.definition?!1:(i.match.push(this._world),i)};this.resolve=n=>{let o=this.match(n);return o?o.definition.method(...o.match):Sr(`Matching definition could not be found for step: "${n}"`)};this.register=(...n)=>(0,B.isStr)(n[0])?ro.apply(this,n):oo.apply(this,n);this.clear=()=>{this.types.map(n=>this[`_${n}`]=[])};this._world=n;let o=this;this.types.map(i=>{let p=`_${i}`;this[p]=[],this[(0,B.capitalize)(i)]=(u,h,d)=>o.register(p,i,u,h,d)})}};var te=w(b());var{HOOK_TYPES:Br}=_,Ie=class{constructor(n,o){this.types=Br;this.instance=void 0;this._registeredHooks={};this.getRegistered=n=>{let o=this.types.includes(n)?this._registeredHooks[n]||te.noPropArr:kr(Br.join(", "),n);if(o)return o.length?async()=>o.reduce(async(i,p)=>(await i,await p(this.instance)),Promise.resolve()):te.noOp};this.instance=o,this.types.map(i=>{this[i]=p=>{(0,te.isFunc)(p)&&(this._registeredHooks[i]=this._registeredHooks[i]||[],this._registeredHooks[i].push(p))}})}};var ao=/^\s*Given (.*)$/,io=/^\s*When(.*)$/,co=/^\s*Then (.*)$/,po=/^\s*And (.*)$/,uo=/^\s*But (.*)$/,lo=/^\s*\* (.*)$/,ho=/^\s*?"""\s*?/;var go=/^\s*?```\s*?/;var Lr=/^\s*?\|/;var mo=[{regex:ao,type:"given"},{regex:io,type:"when"},{regex:co,type:"then"},{regex:po,type:"and"},{regex:uo,type:"but"},{regex:lo,type:"and"}],fo=(t,n,o,i)=>{if(!Lr.test(o))return t;let p;return t.table={index:i,content:n.reduce((u,h)=>(p=p||!Lr.test(h),!p&&u.push(h.split("|").reduce((d,y)=>{let S=y.trim();return S&&d.push(S),d},[])),u),[])},t},To=(t,n,o,i)=>{let p=ho.test(o)&&'"""';if(p=p||go.test(o)&&"```",!p)return t;let u=o.split(p)[0],h=new Array(u.length).fill("\\s").join(""),d=new RegExp(`^${h}`);return t.doc={index:i,whiteSpace:u,type:p==='"""'?"quote":"tick",content:n.split(p).slice(1).shift().trim().split(`
`).reduce((y,S)=>(y.push(S.replace(d,"").trim()),y),[]).join(`
`)},t},xo=(t,n,o,i,p)=>{let u={type:t,index:p,step:n,whitespace:W(i),uuid:v(`${t}-${n}`)},h=p+1,d=o[h],y=o.slice(h);return u=fo(u,y,d,h),u=To(u,y.join(`
`),d,h),u},Wr=(t,n,o,i)=>{let p=t;return mo.reduce((u,h)=>{if(u)return u;let d=h.regex.test(o);return d&&p.steps.push(xo(h.type,j(o,h.regex,1),n,o,i)),d},!1)};var an=w(b());var re=w(b());var{ALIAS_REF:yo,WORLD_REF:bo,ALIAS_WORLD_KEY:So,WORLD_AT_RUNTIME:Nr,ALIAS_REF_AT_RUNTIME:Xr}=_,Gr=(t,n,o)=>{let i=(0,re.get)(n,o);return(0,re.isFunc)(i)?i(n,o):(0,re.exists)(i)?i:t},Ao=(t,n)=>{let o;try{return t.replace(Tr,i=>{o=i;let p=i.trim();return p.indexOf(Xr)===0?p.replace(Xr,`$${yo}`):Gr(i,n,p.replace(fr,`${So}.`))})}catch(i){$r(i,o)}},wo=(t,n)=>{let o;try{return t.replace(gr,i=>{o=i;let p=i.trim();return p.indexOf(Nr)===0?p.replace(Nr,bo):Gr(i,n,p.replace(hr,""))})}catch(i){Or(i,o)}},Hr=(t,n)=>wo(Ao(t,n),n);var Ro=/^\s*Feature:(.*)$/,ko=/^\s*Rule:(.*)$/,Oo=/^\s*Scenario:(.*)$/,$o=/^\s*Example:(.*)$/,_o=/^\s*Background:(.*)$/,Ur=(t,n,o,i,p,u)=>Oo.test(u)||$o.test(u)?i:Ro.test(u)?n:ko.test(u)?o:_o.test(u)?p:t;var qr=/^\s*Rule:(.*)$/,ht=(t,n)=>({index:n,rule:t,tags:[],scenarios:[],...t&&{uuid:v(t,n)}}),zr=(t,n,o,i)=>{if(!qr.test(o))return n;let p=j(o,qr,1);return n.rule?n=ht(p,i):n.rule=p,!n.index&&(n.index=i),!n.uuid&&(n.uuid=v(n.rule,i)),n.whitespace=W(o),!t.rules.includes(n)&&t.rules.push(n),n};var Jr=/^\s*Feature:(.*)$/,gt=(t,n,o)=>({index:o,content:n,feature:t,tags:[],rules:[],reason:[],comments:[],scenarios:[],...t&&{uuid:v(t,o)}}),Vr=(t,n,o,i,p)=>{if(!Jr.test(o))return n;let u=j(o,Jr,1);if(!n.feature)return n.feature=u,n.index||(n.index=p),n.uuid||(n.uuid=v(n.feature,p)),!t.includes(n)&&t.push(n),n;let h=gt(u,i,p);return t.push(h),h};var Qr=/^\s*Scenario:(.*)$/,Yr=/^\s*Example:(.*)$/,mt=(t,n)=>({index:n,scenario:t,tags:[],steps:[],...t&&{uuid:v(t,n)}}),Zr=(t,n,o,i,p)=>{let u=Qr.test(i);if(!u&&!Yr.test(i))return o;let h=u&&j(i,Qr,1);h=h||j(i,Yr,1),o.scenario?o=mt(h,p):o.scenario=h,!o.index&&(o.index=p),!o.uuid&&(o.uuid=v(o.scenario,p)),o.whitespace=W(i);let d=n.uuid?n:t;return!d.scenarios.includes(o)&&d.scenarios.push(o),o};var tn=w(b());var Kr=/^\s*@(.*)$/,vo=/^\s*As (.*)$/,en=/^\s*#(.*)$/,Io=/^\s*I want (.*)$/,Eo=/^\s*So that (.*)$/,Fo=/^\s*In order (.*)$/,jo=[{regex:vo,key:"perspective"},{regex:Io,key:"desire"},{regex:Eo,key:"reason"},{regex:Fo,key:"reason"}],Mo=(t,n,o)=>{if(!n)return;let i=(0,tn.eitherArr)(t.reason,[t.reason]);i.push({content:n,index:o}),t.reason=i},rn=(t,n,o)=>{let i=!1;return jo.reduce((p,u)=>{if(p)return p;let h=u.regex.test(n);return!i&&h&&(i=!0),h&&(u.key==="reason"?Mo(t,j(n,u.regex,0),o):t[u.key]={content:j(n,u.regex,0),index:o})},!1),i},nn=(t,n,o)=>{if(!Kr.test(o))return!1;let i=t!=null&&t.background?n:t,p=j(o,Kr,0);return i.tags=(i.tags||[]).concat(p.split(" ")),!0},on=(t,n,o)=>{if(!en.test(n))return!1;let i=n.match(en)[0];return t.comments.push({content:i,index:o}),!0};var Po=/^\s*Background:(.*)$/,ft=(t,n)=>({index:n,steps:[],background:t,...t&&{uuid:v(t,n)}}),sn=(t,n,o,i,p)=>{if(!Po.test(i))return o;let u=n.uuid?n:t,h=`${u.uuid}-background`;return o.background?o=ft(h,p):o.background=h||"",!o.index&&(o.index=p),!o.uuid&&(o.uuid=v(o.background,p)),o.whitespace=W(i),u.background=o,o};var Co=/\r?\n/g,Ee=function(t,n){n=n||this&&this.world||an.noOpObj;let o=[],p=Hr((t||"").toString(),n).split(Co),u=ht(!1),h=mt(!1),d=ft(!1),y=gt(!1,t),S=y;return p.reduce((T,A,m)=>(y=Vr(T,y,A,t,m),on(y,A,m)||rn(y,A,m)||(u=zr(y,u,A,m),h=Zr(y,u,h,A,m),d=sn(y,u,d,A,m),!(S!=null&&S.feature)&&Wr(S,p,A,m))||(S=Ur(S,y,u,h,d,A),nn(S,y,A)),T),o)};var cn=function(t){return this.steps.register([t])};var pe=w(b());var{SPEC_RESULT_LOG:pn,LOG_JEST_SPEC_ENV:Do}=_;var Fe=t=>{let n=new Date().getTime();(0,pe.get)(process,`env.${Do}`)&&process.stdout.write([pn,JSON.stringify({...t,timestamp:n}),pn].join(""))},un=t=>{let n=(0,pe.get)(t,"description"),o=n?n.startsWith("Scenario >")?"Scenario":n.startsWith("Background >")?"Background":n.startsWith("Rule >")?"Rule":"Feature":"Feature";return{type:o.toLowerCase(),...o!=="Feature"&&{description:n.replace(`${o} >`,`${o}:`)}}},G=(t,n)=>n?pe.noOp:global[t]||xr(t),Bo=t=>{let n=[],o=t.describe;return t.describe=(...i)=>{let p=o.apply(null,i);return n.push(p),p},{suiteStarted:i=>{Fe({...i,...un(i),action:"start"})},specStarted:i=>{Fe({...i,type:"step",action:"start"})},specDone:i=>{if(Fe({...i,type:"step",action:"end"}),i.status!=="failed")return;let p=n.find(u=>u.children.find(h=>h.result===i));p&&p.children.map(u=>u.disable())},suiteDone:i=>{Fe({...i,...un(i),action:"end"})}}},ln=t=>{var o;if(!ke)return;let n=Oe().getEnv();n&&n.describe&&((o=n==null?void 0:n.addReporter)==null||o.call(n,Bo(n)))};var I=w(b()),Tt=(t,n)=>`${(0,I.capitalize)(n)} > ${t}`,gn=(t,n)=>(0,I.isStr)(t)?Ee(t,n):(0,I.isObj)(t)?[t]:(0,I.isArr)(t)?t.reduce((o,i)=>o.concat(gn(i,n)),[]):br(),Lo=async(t,n,o)=>{G("test",o)(`${(0,I.capitalize)(n.type)} ${n.step}`,async()=>await t.resolve(n.step))},dn=(t,n,o,i)=>{let p=G("describe",i),u=[];return p(n,()=>{let h=t.steps.map(d=>Lo(o,d,i));Promise.all(h)}),u},mn=(t,n,o,i)=>(o&&dn(o,Tt(n.scenario,"Background"),t,i),dn(n,Tt(n.scenario,"Scenario"),t,i)),Wo=(t,n,o,i)=>{let p=[];return describe(`Rule > ${n.rule}`,()=>{p=n.scenarios.map(u=>mn(t,u,o||n.background,i)),Promise.all(p)}),p},No=t=>(0,I.isStr)(t)&&t.match(/[@]\w*/g),hn=(t="",n=[],o={})=>{let{name:i,tags:p}=o,u=(0,I.isStr)(p)?No(p):(0,I.eitherArr)(p,[]),h=!i||t.includes(i),d=!u.length||u.every(y=>n.includes(y));return h&&d},Xo=(t,n={})=>t.reduce((o,i)=>{if(hn(i.feature,i.tags,n))return o.push(i),o;let u=i.scenarios.filter(h=>hn(h.scenario,[...h.tags||[],...i.tags||[]],n));return u.length&&o.push({...i,scenarios:u}),o},[]),je=class{constructor(n,o,i){!n&&yr(),!o&&throwMissingHooks(),this.steps=n,this.hooks=o,this._world=i}getFeatures=(n,o)=>{let i=gn(n,this._world);return Xo(i,o)};run=async(n,o=I.noOpObj)=>{let i=this.run.PARKIN_TEST_MODE;ln(i);let p=G("describe",i),u=G("beforeAll",i),h=G("afterAll",i),d=G("beforeEach",i),y=G("afterEach",i),S=this.getFeatures(n,o);if(!S.length)return!1;let T=await S.map(async A=>{let m=[];return u(this.hooks.getRegistered("beforeAll")),h(this.hooks.getRegistered("afterAll")),d(this.hooks.getRegistered("beforeEach")),y(this.hooks.getRegistered("afterEach")),p(Tt(A.feature,"Feature"),()=>{m=A.rules.map(C=>Wo(this.steps,C,A.background,i)),m.concat(A.scenarios.map(C=>mn(this.steps,C,A.background,i))),Promise.all(m)}),m});return await Promise.all(T),!0}};var xt=w(b()),F=(t,n,o)=>{(0,xt.exists)(o)?(0,xt.exists)(t[o])?t.splice(o,0,n):t[o]=n:t.push(n)};var yt=w(b()),{FEATURE_META:Go}=_,fn=(t,n)=>{Go.map(o=>{switch(o){case"feature":F(t,`Feature: ${n[o]}`,n.index);break;case"comments":let i=n[o];i&&(0,yt.eitherArr)(i,[i]).map(u=>F(t,u.content,u.index));break;case"reason":case"desire":case"perspective":let p=n[o];p&&(0,yt.eitherArr)(p,[p]).map(u=>F(t,`  ${u.content}`,u.index));break}})};var Tn=w(b()),H=(t,n,o="")=>{(0,Tn.isArr)(n)&&n.length&&F(t,`${o}${n.join(" ")}`)};var Me=w(b()),Pe=(t,n)=>{(0,Me.isArr)(n.steps)&&n.steps.length&&n.steps.map(o=>F(t,`    ${(0,Me.capitalize)(o.type)} ${o.step}`,o.index))};var Ce=(t,n)=>{n.scenarios&&n.scenarios.map(o=>{H(t,o.tags,"  "),F(t,`  Scenario: ${o.scenario}`,o.index),Pe(t,o)})};var xn=(t,n)=>{n.rules&&n.rules.map(o=>{H(t,o.tags,"  "),F(t,`  Rule: ${o.rule}`,o.index),Ce(t,o)})};var bt=w(b()),Ho=(t,n,o)=>{let i=t[o+1],p=t[o-1],u=(0,bt.exists)(i)?i:p;if(!u)return`${n}
`;let h=n.split("#").pop();return`${Array(u.length-u.trimStart().length).join(" ")} # ${h}
`},yn=t=>Array.from(t,(n,o)=>(0,bt.exists)(n)?n.startsWith("#")?Ho(t,n,o):`${n}
`:`
`).join("").trim();var bn=(t,n)=>{let{background:o}=n;o&&(H(t,o.tags,"  "),F(t,`  Background: ${o.background}`,o.index),Pe(t,o))};var De=w(b());var Sn=t=>(0,De.eitherArr)(t,[t]).map(n=>{let o=[];return!(0,De.isObj)(n)&&wr(n),H(o,n.tags),fn(o,n),bn(o,n),xn(o,n),Ce(o,n),yn(o)});var An={feature:Sn};var P=w(b()),ue=class{constructor(n,o){(0,P.isObj)(n)&&this.init(n,o)}#e=!1;init=(n=P.noOpObj,o)=>{if(this.#e)return console.warn("This instance of parkin has already been initialized!");(0,P.isObj)(n.$alias)||(n.$alias={}),this.#e=!0,this.world=n,this.steps=new ve(this.world),this.hooks=new Ie(this.world),this.runner=new je(this.steps,this.hooks,this.world),this.run=this.runner.run,this.parse={feature:Ee.bind(this),definition:cn.bind(this)},this.assemble=An,this.paramTypes={register:we},this.matcher=new _e,(0,P.isObj)(o)&&this.registerSteps(o),this.steps.types.map(i=>{this[(0,P.capitalize)(i)]=(p,u,h)=>this.steps.register(`_${i}`,i,p,u,h)})};registerSteps=n=>{Object.entries(n).map((o,i)=>Object.entries(i).map((p,u)=>this.steps[(0,P.capitalize)(o)](p,...(0,P.eitherArr)(u,[u]))))}},Ti=new ue;var St=w(b());var wn=`@rules @background
Feature: Full set of functionality in feature files
  # This is a test comment
  Background:
    Given that background exists
    Then the background steps should be called before each rules scenario

  Rule: This is Rule 1
    Example: Run scenario after the first rule
      Given that this Feature has a background
      Then this rules scenario's steps should be run after the background's steps

    Scenario: Run second rule scenario after a second background
      Given that a second scenario exists
      Then the rules second scenario's steps should be run after a second background's steps

  Scenario: Scenario after rule
    Given that a scenario exists after the rule
    Then it should not be part of the rule

`;var Uo=Oe().getEnv(),zi=Uo.describe;var{HOOK_TYPES:xc}=_;(()=>{let n=new ue({}).parse.feature(wn)[0]})();
//# sourceMappingURL=parkin.js.map
